# ğŸ¯ Mermaidå®Œå…¨æº–æ‹ ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯é–‹ç™ºè¨ˆç”»

## ğŸ“Š ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

Mermaidã®æ–‡æ³•ã¨ã‚¹ã‚­ãƒ¼ãƒã«å®Œå…¨æº–æ‹ ã—ãŸã€å‹å®‰å…¨ãªãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ ç”Ÿæˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’æ§‹ç¯‰ã™ã‚‹ã€‚

## ğŸ” èª¿æŸ»çµæœã‚µãƒãƒªãƒ¼

- **ãƒ‘ãƒ¼ã‚µãƒ¼æŠ€è¡“**: Langiumï¼ˆæœ€æ–°ï¼‰/ Jisonï¼ˆãƒ¬ã‚¬ã‚·ãƒ¼ï¼‰
- **å¯¾å¿œãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ **: 10ç¨®é¡ä»¥ä¸Š
- **ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ**: æ‰‹æ›¸ããƒ‘ãƒ¼ã‚µãƒ¼ + Zodã«ã‚ˆã‚‹å³æ ¼ãªå‹å®šç¾©

---

## ğŸ“‹ ãƒ•ã‚§ãƒ¼ã‚º1: Mermaidå®Œå…¨æº–æ‹ ã‚¹ã‚­ãƒ¼ãƒè¨­è¨ˆï¼ˆé€±1-2ï¼‰

### 1.1 ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ ã‚¿ã‚¤ãƒ—åˆ¥ã‚¹ã‚­ãƒ¼ãƒå®šç¾©

å¯¾å¿œã™ã‚‹ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ ã‚¿ã‚¤ãƒ—ï¼ˆå„ªå…ˆåº¦é †ï¼‰:

1. **Flowchart** - TB/BT/LR/RLæ–¹å‘ã€12ç¨®é¡ã®ãƒãƒ¼ãƒ‰å½¢çŠ¶ã€è¤‡æ•°ã®ã‚¨ãƒƒã‚¸ã‚¿ã‚¤ãƒ—
2. **Sequence** - ã‚¢ã‚¯ã‚¿ãƒ¼ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¿ã‚¤ãƒ—ã€ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆï¼ˆloop/alt/optï¼‰
3. **Class** - ã‚¯ãƒ©ã‚¹å®šç¾©ã€é–¢ä¿‚ï¼ˆç¶™æ‰¿ã€å®Ÿè£…ã€é–¢é€£ï¼‰ã€å¯è¦–æ€§
4. **ER** - ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã€é–¢ä¿‚ã€ã‚«ãƒ¼ãƒ‡ã‚£ãƒŠãƒªãƒ†ã‚£
5. **Gantt** - ã‚¿ã‚¹ã‚¯ã€æœŸé–“ã€ä¾å­˜é–¢ä¿‚ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³
6. **State** - çŠ¶æ…‹ã€é·ç§»ã€ä¸¦è¡ŒçŠ¶æ…‹ã€ãƒã‚¹ãƒˆ
7. **Pie** - ãƒ‡ãƒ¼ã‚¿ã€ãƒ©ãƒ™ãƒ«ã€å€¤
8. **Git Graph** - ã‚³ãƒŸãƒƒãƒˆã€ãƒ–ãƒ©ãƒ³ãƒã€ãƒãƒ¼ã‚¸
9. **Journey** - ã‚¹ãƒ†ãƒƒãƒ—ã€ã‚¹ã‚³ã‚¢ã€ã‚¢ã‚¯ã‚¿ãƒ¼
10. **C4** - ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã€ã‚³ãƒ³ãƒ†ãƒŠã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

### 1.2 Zodã‚¹ã‚­ãƒ¼ãƒå®Ÿè£…æˆ¦ç•¥

ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ :

```
packages/core/src/schemas/
â”œâ”€â”€ common.ts          # å…±é€šå‹å®šç¾©ï¼ˆColor, Position, Size, Directionï¼‰
â”œâ”€â”€ flowchart.ts       # FlowchartSchema + ãƒãƒ¼ãƒ‰å½¢çŠ¶enum
â”œâ”€â”€ sequence.ts        # SequenceDiagramSchema + ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¿ã‚¤ãƒ—
â”œâ”€â”€ class.ts           # ClassDiagramSchema + é–¢ä¿‚ã‚¿ã‚¤ãƒ—
â”œâ”€â”€ er.ts              # ERDiagramSchema + ã‚«ãƒ¼ãƒ‡ã‚£ãƒŠãƒªãƒ†ã‚£
â”œâ”€â”€ gantt.ts           # GanttSchema + ã‚¿ã‚¹ã‚¯çŠ¶æ…‹
â”œâ”€â”€ state.ts           # StateDiagramSchema + é·ç§»
â”œâ”€â”€ pie.ts             # PieChartSchema
â”œâ”€â”€ git.ts             # GitGraphSchema
â”œâ”€â”€ journey.ts         # JourneySchema
â”œâ”€â”€ c4.ts              # C4DiagramSchema
â””â”€â”€ index.ts           # çµ±åˆã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
```

### 1.3 å‹å®‰å…¨æ€§ãƒ¬ãƒ™ãƒ«

- âœ… å…¨enumå€¤ã‚’literalã§å®šç¾©
- âœ… discriminated unionã§å‹æ¨è«–
- âœ… branded typeã§å€¤ã®ç¯„å›²åˆ¶é™
- âœ… refinementsã§ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- âœ… strict modeãƒ•ãƒ«æ´»ç”¨

---

## ğŸ“‹ ãƒ•ã‚§ãƒ¼ã‚º2: Mermaidæ–‡æ³•å®Œå…¨æº–æ‹ ãƒ‘ãƒ¼ã‚µãƒ¼ï¼ˆé€±3-8ï¼‰

### 2.1 ãƒ‘ãƒ¼ã‚µãƒ¼æŠ€è¡“é¸å®š

**æ¡ç”¨: æ‰‹æ›¸ããƒ‘ãƒ¼ã‚µãƒ¼ï¼ˆãƒ•ãƒ«ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ï¼‰** â­ï¸â­ï¸â­ï¸

ç†ç”±:
- âœ… å®Œå…¨ãªå‹åˆ¶å¾¡
- âœ… ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–å¯èƒ½
- âœ… ä¾å­˜ã‚¼ãƒ­
- âœ… ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

### 2.2 ãƒ‘ãƒ¼ã‚µãƒ¼å®Ÿè£…æ§‹é€ 

```
packages/parser/src/
â”œâ”€â”€ lexer/              # å­—å¥è§£æ
â”‚   â”œâ”€â”€ tokenizer.ts   # ãƒˆãƒ¼ã‚¯ãƒ³åŒ–ã‚¨ãƒ³ã‚¸ãƒ³
â”‚   â”œâ”€â”€ tokens.ts      # ãƒˆãƒ¼ã‚¯ãƒ³å®šç¾©ï¼ˆZodï¼‰
â”‚   â””â”€â”€ scanner.ts     # æ–‡å­—ã‚¹ã‚­ãƒ£ãƒŠãƒ¼
â”œâ”€â”€ grammar/           # æ–‡æ³•å®šç¾©
â”‚   â”œâ”€â”€ flowchart.ts   # Flowchartæ–‡æ³•ãƒ‘ãƒ¼ã‚µãƒ¼
â”‚   â”œâ”€â”€ sequence.ts    # Sequenceæ–‡æ³•ãƒ‘ãƒ¼ã‚µãƒ¼
â”‚   â”œâ”€â”€ class.ts       # Classæ–‡æ³•ãƒ‘ãƒ¼ã‚µãƒ¼
â”‚   â””â”€â”€ ...
â”œâ”€â”€ ast/               # ASTå®šç¾©ï¼ˆZodï¼‰
â”‚   â”œâ”€â”€ nodes.ts       # ASTãƒãƒ¼ãƒ‰å‹
â”‚   â”œâ”€â”€ builder.ts     # ASTãƒ“ãƒ«ãƒ€ãƒ¼
â”‚   â””â”€â”€ types.ts       # å‹å®šç¾©
â”œâ”€â”€ parser.ts          # ãƒ¡ã‚¤ãƒ³ãƒ‘ãƒ¼ã‚µãƒ¼
â”œâ”€â”€ error.ts           # ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
â””â”€â”€ index.ts           # ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
```

### 2.3 Flowchartæ–‡æ³•ä»•æ§˜

ãƒ‘ãƒ¼ã‚¹å¯¾è±¡ä¾‹:

```mermaid
flowchart LR
    A[Hard edge] -->|Link text| B(Round edge)
    B --> C{Decision}
    C -->|One| D[Result 1]
    C -->|Two| E[Result 2]
```

**ãƒ‘ãƒ¼ã‚¹è¦ç´ **:

- ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ å®£è¨€: `flowchart LR`
- ãƒãƒ¼ãƒ‰å®šç¾©: `A[Hard edge]` (ID + å½¢çŠ¶ + ãƒ†ã‚­ã‚¹ãƒˆ)
- ã‚¨ãƒƒã‚¸å®šç¾©: `-->|Link text|` (ã‚¿ã‚¤ãƒ— + ãƒ©ãƒ™ãƒ«)
- ãƒãƒ¼ãƒ‰å½¢çŠ¶12ç¨®é¡: `[]`, `()`, `{}`, `<>`, `(())`, `[[]]`, `[()]`, `>]`, `{{}}`, `[//]`, `[\\]`, `((()))`
- ã‚¨ãƒƒã‚¸ã‚¿ã‚¤ãƒ—: `-->`, `---`, `-.->`, `==>`, ãªã©

---

## ğŸ“‹ ãƒ•ã‚§ãƒ¼ã‚º3: ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ åˆ¥ãƒ‘ãƒ¼ã‚µãƒ¼å®Ÿè£…ï¼ˆé€±9-16ï¼‰

### 3.1 å®Ÿè£…ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

| é€± | ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ  | å®Ÿè£…å†…å®¹ | é›£æ˜“åº¦ |
|---|---|---|---|
| 9-10 | **Flowchart** | å…¨ãƒãƒ¼ãƒ‰å½¢çŠ¶ã€å…¨ã‚¨ãƒƒã‚¸ã‚¿ã‚¤ãƒ—ã€ã‚µãƒ–ã‚°ãƒ©ãƒ•ã€ã‚¹ã‚¿ã‚¤ãƒ« | ğŸ”¥ğŸ”¥ğŸ”¥ |
| 11-12 | **Sequence** | ã‚¢ã‚¯ã‚¿ãƒ¼ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆï¼ˆloop/alt/opt/parï¼‰ | ğŸ”¥ğŸ”¥ğŸ”¥ |
| 13 | **Class** | ã‚¯ãƒ©ã‚¹å®šç¾©ã€é–¢ä¿‚ã€ãƒ¡ãƒ³ãƒãƒ¼å¯è¦–æ€§ | ğŸ”¥ğŸ”¥ |
| 14 | **ER** | ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã€é–¢ä¿‚ã€ã‚«ãƒ¼ãƒ‡ã‚£ãƒŠãƒªãƒ†ã‚£ | ğŸ”¥ğŸ”¥ |
| 15 | **State** | çŠ¶æ…‹ã€é·ç§»ã€ä¸¦è¡ŒçŠ¶æ…‹ã€ãƒã‚¹ãƒˆ | ğŸ”¥ğŸ”¥ |
| 16 | **Gantt/Pie** | ã‚¿ã‚¹ã‚¯ã€æœŸé–“ã€ãƒ‡ãƒ¼ã‚¿ã€ãƒ©ãƒ™ãƒ« | ğŸ”¥ |

### 3.2 Flowchartå®Œå…¨ä»•æ§˜

**ãƒãƒ¼ãƒ‰å½¢çŠ¶**:

```typescript
export const NodeShape = z.enum([
  'square',         // [text]
  'round',          // (text)
  'stadium',        // ([text])
  'subroutine',     // [[text]]
  'cylindrical',    // [(text)]
  'circle',         // ((text))
  'asymmetric',     // >text]
  'rhombus',        // {text}
  'hexagon',        // {{text}}
  'parallelogram',  // [/text/]
  'trapezoid_alt',  // [\text/]
  'trapezoid',      // [/text\]
  'double_circle',  // (((text)))
]);
```

**ã‚¨ãƒƒã‚¸ã‚¿ã‚¤ãƒ—**:

```typescript
export const EdgeType = z.enum([
  'arrow',          // -->
  'line',           // ---
  'dotted_arrow',   // -.->
  'dotted_line',    // -.-
  'thick_arrow',    // ==>
  'thick_line',     // ===
  'invisible',      // ~~~
]);
```

---

## ğŸ“‹ ãƒ•ã‚§ãƒ¼ã‚º4: ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºï¼ˆä¸¦è¡Œå®Ÿæ–½ï¼‰

### 4.1 ãƒ†ã‚¹ãƒˆæ§‹é€ 

```
packages/parser/tests/
â”œâ”€â”€ fixtures/
â”‚   â”œâ”€â”€ flowchart/
â”‚   â”‚   â”œâ”€â”€ basic.mmd
â”‚   â”‚   â”œâ”€â”€ complex.mmd
â”‚   â”‚   â”œâ”€â”€ subgraph.mmd
â”‚   â”‚   â”œâ”€â”€ styles.mmd
â”‚   â”‚   â””â”€â”€ edge-cases.mmd
â”‚   â”œâ”€â”€ sequence/
â”‚   â”‚   â”œâ”€â”€ actors.mmd
â”‚   â”‚   â”œâ”€â”€ loops.mmd
â”‚   â”‚   â””â”€â”€ alternatives.mmd
â”‚   â””â”€â”€ ...
â”œâ”€â”€ lexer/
â”‚   â””â”€â”€ tokenizer.test.ts
â”œâ”€â”€ grammar/
â”‚   â”œâ”€â”€ flowchart.test.ts
â”‚   â””â”€â”€ sequence.test.ts
â””â”€â”€ parser.test.ts
```

### 4.2 ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

1. **äº’æ›æ€§ãƒ†ã‚¹ãƒˆ**: Mermaidå…¬å¼ã®ã‚µãƒ³ãƒ—ãƒ«å…¨ãƒ‘ãƒ¼ã‚¹
2. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ã€æ„å‘³ã‚¨ãƒ©ãƒ¼ã®æ¤œå‡º
3. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ**: 10KBä»¥ä¸Šã®ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ ã‚’1ç§’ä»¥å†…
4. **ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒ†ã‚¹ãƒˆ**: ASTå‡ºåŠ›ã®å›å¸°ãƒ†ã‚¹ãƒˆ
5. **ã‚«ãƒãƒ¬ãƒƒã‚¸**: 95%ä»¥ä¸Šã‚’ç¶­æŒ

---

## ğŸ“‹ ãƒ•ã‚§ãƒ¼ã‚º5: VS Codeæ‹¡å¼µå¯¾å¿œï¼ˆé€±17-18ï¼‰

### 5.1 Language Server Protocolå®Ÿè£…

```
packages/vscode-extension/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ server.ts           # LSP server
â”‚   â”œâ”€â”€ features/
â”‚   â”‚   â”œâ”€â”€ hover.ts        # ãƒ›ãƒãƒ¼æƒ…å ±
â”‚   â”‚   â”œâ”€â”€ completion.ts   # è£œå®Œ
â”‚   â”‚   â”œâ”€â”€ diagnostics.ts  # ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
â”‚   â”‚   â””â”€â”€ formatting.ts   # ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
â”‚   â””â”€â”€ client.ts           # LSP client
â”œâ”€â”€ syntaxes/
â”‚   â””â”€â”€ lyric.tmLanguage.json
â””â”€â”€ package.json
```

### 5.2 æä¾›æ©Ÿèƒ½

- âœ… ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆ
- âœ… ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
- âœ… è£œå®Œå€™è£œè¡¨ç¤º
- âœ… ãƒ›ãƒãƒ¼æ™‚ã®å‹æƒ…å ±
- âœ… ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ©Ÿèƒ½

---

## ğŸ¯ ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ï¼†æˆæœç‰©

### M1: ã‚³ã‚¢ã‚¹ã‚­ãƒ¼ãƒå®Œæˆï¼ˆ2é€±é–“å¾Œï¼‰

- âœ… 10ç¨®é¡ã®ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ ã‚¹ã‚­ãƒ¼ãƒå®Œæˆ
- âœ… 100%å‹å®‰å…¨ãªZodå®šç¾©
- âœ… discriminated unionå®Œå‚™
- âœ… å…±é€šå‹å®šç¾©ï¼ˆColor, Position, Directionï¼‰

**æˆæœç‰©**:
- `packages/core/src/schemas/` å…¨ãƒ•ã‚¡ã‚¤ãƒ«
- ã‚¹ã‚­ãƒ¼ãƒãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ
- å‹æ¨è«–ãƒ†ã‚¹ãƒˆ

### M2: Flowchartå®Œå…¨å¯¾å¿œï¼ˆ4é€±é–“å¾Œï¼‰

- âœ… Mermaidäº’æ›Flowchartãƒ‘ãƒ¼ã‚µãƒ¼
- âœ… 12ç¨®é¡ã®å…¨ãƒãƒ¼ãƒ‰å½¢çŠ¶å¯¾å¿œ
- âœ… 7ç¨®é¡ã®å…¨ã‚¨ãƒƒã‚¸ã‚¿ã‚¤ãƒ—å¯¾å¿œ
- âœ… ã‚µãƒ–ã‚°ãƒ©ãƒ•ã€ã‚¹ã‚¿ã‚¤ãƒ«å¯¾å¿œ

**æˆæœç‰©**:
- `packages/parser/src/grammar/flowchart.ts`
- Flowchartå°‚ç”¨lexer
- 100å€‹ä»¥ä¸Šã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

### M3: 5å¤§ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ å¯¾å¿œï¼ˆ8é€±é–“å¾Œï¼‰

- âœ… Flowchart, Sequence, Class, ER, Stateå®Œå…¨å¯¾å¿œ
- âœ… å…¬å¼ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹å…¨é€šé
- âœ… ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å……å®Ÿ

**æˆæœç‰©**:
- 5ç¨®é¡ã®ãƒ‘ãƒ¼ã‚µãƒ¼å®Ÿè£…
- 500å€‹ä»¥ä¸Šã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯

### M4: å®Œå…¨äº’æ›ï¼ˆ16é€±é–“å¾Œï¼‰

- âœ… 10ç¨®é¡å…¨ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ å¯¾å¿œ
- âœ… VS Codeæ‹¡å¼µãƒªãƒªãƒ¼ã‚¹
- âœ… ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯å…¬é–‹
- âœ… ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå®Œå‚™

**æˆæœç‰©**:
- npmå…¬é–‹å¯èƒ½ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
- VS Code Extension
- å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚µã‚¤ãƒˆ

---

## ğŸ”¥ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

```json
{
  "parser": "Hand-written (full control)",
  "lexer": "Custom tokenizer with Zod",
  "ast": "Zod schemas (runtime + compile-time)",
  "testing": "Vitest + snapshot testing",
  "coverage": "> 95%",
  "typescript": "strict mode + all strict options",
  "formatter": "Biome",
  "monorepo": "pnpm workspace"
}
```

---

## ğŸ“ˆ å“è³ªæŒ‡æ¨™

| æŒ‡æ¨™ | ç›®æ¨™å€¤ |
|------|--------|
| å‹å®‰å…¨æ€§ | 100% (anyç¦æ­¢) |
| ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ | > 95% |
| ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ | 10KB < 1ç§’ |
| ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚º | Core < 100KB (gzip) |
| Mermaidäº’æ›æ€§ | 100% (å…¬å¼ã‚µãƒ³ãƒ—ãƒ«å…¨é€šé) |

---

## ğŸš€ ç¾åœ¨ã®é€²æ—

### âœ… å®Œäº†æ¸ˆã¿

#### ãƒ•ã‚§ãƒ¼ã‚º0: ç’°å¢ƒæ§‹ç¯‰
- [x] ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆæœŸåŒ–
- [x] TypeScript strictè¨­å®šå®Œäº†
- [x] Biomeå°å…¥ãƒ»è¨­å®šå®Œäº†
- [x] pnpm monorepoæ§‹ç¯‰
- [x] Vitestè¨­å®šå®Œäº†

#### ãƒ•ã‚§ãƒ¼ã‚º1: Mermaidå®Œå…¨æº–æ‹ ã‚¹ã‚­ãƒ¼ãƒè¨­è¨ˆ âœ… **å®Œäº†ï¼**
- [x] å…±é€šã‚¹ã‚­ãƒ¼ãƒå®šç¾© (`packages/core/src/schemas/common.ts`)
  - Color (hex/rgb/rgba/named - RGBå€¤ç¯„å›²ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ã)
  - Position, Size, Direction
  - FontStyle, StrokeStyle, FillStyle, Style
  - TextAlign, VerticalAlign, Theme
- [x] Flowchartã‚¹ã‚­ãƒ¼ãƒå®Œå…¨å®Ÿè£… (`packages/core/src/schemas/flowchart.ts`)
  - 14ç¨®é¡ã®ãƒãƒ¼ãƒ‰å½¢çŠ¶ (square, round, rhombus, hexagon, etc)
  - 11ç¨®é¡ã®ã‚¨ãƒƒã‚¸ã‚¿ã‚¤ãƒ— (arrow, dotted, thick, invisible, etc)
  - FlowchartNode, FlowchartEdge, Subgraph, ClassDef
  - FlowchartDiagramå®Œå…¨å®šç¾©
- [x] ã‚¹ã‚­ãƒ¼ãƒãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ
  - 38ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹å…¨é€šé
  - å‹å®‰å…¨æ€§100%é”æˆ

**æˆæœç‰©**:
- `packages/core/src/schemas/` (common.ts, flowchart.ts, index.ts)
- ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆ (common.test.ts, flowchart.test.ts)
- å®Œå…¨ãªå‹æ¨è«–ã¨Zodãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

#### ãƒ•ã‚§ãƒ¼ã‚º2: Mermaidæ–‡æ³•å®Œå…¨æº–æ‹ ãƒ‘ãƒ¼ã‚µãƒ¼ âœ… **å®Œäº†ï¼**

**2.1 Lexerï¼ˆå­—å¥è§£æå™¨ï¼‰å®Ÿè£…å®Œäº†**
- [x] ãƒˆãƒ¼ã‚¯ãƒ³å®šç¾© (`packages/parser/src/lexer/tokens.ts`)
  - 50ç¨®é¡ä»¥ä¸Šã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚¿ã‚¤ãƒ—å®šç¾©
  - ä½ç½®æƒ…å ±ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚° (line, column, offset)
  - Zodãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å®Œå‚™
- [x] Tokenizerå®Ÿè£… (`packages/parser/src/lexer/tokenizer.ts`)
  - å…¨ãƒãƒ¼ãƒ‰å½¢çŠ¶æ¤œå‡º: [], [[]], (), ((())), {}, {{}}, ([]), [(]), >]
  - å…¨ã‚¨ãƒƒã‚¸ã‚¿ã‚¤ãƒ—æ¤œå‡º: -->, ---, -.-, -.->, ==>, ~~~, --o, --x
  - ã‚³ãƒ¡ãƒ³ãƒˆå¯¾å¿œ (%%)
  - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° (LexerError)
- [x] Lexerãƒ†ã‚¹ãƒˆ
  - 30ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹å…¨é€šé
  - è¤‡é›‘ãªflowchartå¯¾å¿œç¢ºèª

**æˆæœç‰©**:
- `packages/parser/src/lexer/` (tokens.ts, tokenizer.ts)
- ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆ (tokenizer.test.ts)

**2.2 Parserï¼ˆæ§‹æ–‡è§£æå™¨ï¼‰å®Ÿè£…å®Œäº†**
- [x] ASTå®šç¾© (`packages/parser/src/ast/nodes.ts`)
  - ProgramAST, FlowchartDiagramAST
  - FlowchartNodeAST, EdgeAST, SubgraphAST
  - ä½ç½®æƒ…å ± (loc) å¯¾å¿œ
- [x] Flowchartãƒ‘ãƒ¼ã‚µãƒ¼å®Ÿè£… (`packages/parser/src/grammar/flowchart.ts`)
  - ãƒãƒ¼ãƒ‰å®šç¾©ã®ãƒ‘ãƒ¼ã‚¹ (å…¨å½¢çŠ¶å¯¾å¿œ)
  - ã‚¨ãƒƒã‚¸ã®ãƒ‘ãƒ¼ã‚¹ (å…¨ã‚¿ã‚¤ãƒ—ã€ãƒ©ãƒ™ãƒ«ä»˜ãå¯¾å¿œ)
  - ã‚µãƒ–ã‚°ãƒ©ãƒ•ã®ãƒ‘ãƒ¼ã‚¹ (subgraph ~ end)
  - æ–¹å‘æŒ‡å®šå¯¾å¿œ (TB, TD, BT, LR, RL)
  - é€£ç¶šå®šç¾©å¯¾å¿œ: `A[Start] --> B[End]`
- [x] ãƒ¡ã‚¤ãƒ³ãƒ‘ãƒ¼ã‚µãƒ¼ (`packages/parser/src/parser.ts`)
  - parse(): è‡ªå‹•ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ ã‚¿ã‚¤ãƒ—æ¤œå‡º
  - parseFlowchart(): Flowchartå°‚ç”¨ãƒ‘ãƒ¼ã‚µãƒ¼
- [x] Parserãƒ†ã‚¹ãƒˆ
  - 9ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹å…¨é€šé
  - å˜ä¸€/è¤‡æ•°ãƒãƒ¼ãƒ‰ã€å„å½¢çŠ¶ã€ã‚¨ãƒƒã‚¸ã€ã‚µãƒ–ã‚°ãƒ©ãƒ•å¯¾å¿œ

**æˆæœç‰©**:
- `packages/parser/src/` (ast/, grammar/, parser.ts, error.ts, index.ts)
- ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆ (parser.test.ts)
- **åˆè¨ˆ77ãƒ†ã‚¹ãƒˆå…¨é€šé** (Core 38 + Lexer 30 + Parser 9)

### ğŸ“Š ç¾åœ¨ã®å®Ÿç¸¾

| é …ç›® | çŠ¶æ…‹ | å‚™è€ƒ |
|------|------|------|
| ãƒ†ã‚¹ãƒˆ | âœ… 154/154 é€šé | 100%é€šéç‡ |
| å‹å®‰å…¨æ€§ | âœ… 100% | anyå®Œå…¨æ’é™¤ |
| Lint | âœ… é€šé | Biome strict |
| TypeCheck | âœ… é€šé | strict mode |
| ã‚«ãƒãƒ¬ãƒƒã‚¸ | ğŸŸ¡ æ¸¬å®šå‰ | ç›®æ¨™>95% |
| Phase 1 | âœ… å®Œäº† | Core Rendererå®Œæˆ |

### ğŸ¯ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

**Phase 1: Flowchart Parser âœ… å®Œäº†ï¼**
- [x] Lexerå®Ÿè£…å®Œäº†
- [x] Parserå®Ÿè£…å®Œäº†
- [x] 100å€‹ã®E2Eãƒ†ã‚¹ãƒˆå…¨é€šé (100%)

**Phase 1-2: è¿½åŠ ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ E2Eãƒ†ã‚¹ãƒˆæº–å‚™ âœ… å®Œäº†ï¼**
- [x] Sequence diagram e2e examples (15å€‹)
- [x] Class diagram e2e examples (10å€‹)
- [x] ER diagram e2e examples (10å€‹)
- [x] State diagram e2e examples (10å€‹)
- [x] Gantt chart e2e examples (10å€‹)
- [x] å„ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ ã‚¿ã‚¤ãƒ—ã®ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
- [x] åˆè¨ˆ155å€‹ã®E2Eãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹æº–å‚™å®Œäº†
- [x] Sequence Diagram Parserå®Ÿè£… - âœ… **100% COMPLETE** (45/45)
- [x] Class Diagram Parserå®Ÿè£… - âœ… **100% COMPLETE** (25/25)
- [x] ER Diagram Parserå®Ÿè£… - âœ… **100% COMPLETE** (10/10)
- [x] **Gantt Chart Parserå®Ÿè£… - âœ… 100% COMPLETE (10/10)**
- [x] **State Diagram Parserä¿®æ­£ - âœ… 100% COMPLETE (13/13)** â† ä»Šå®Œäº†ï¼ğŸ‰

**E2E Test Summary:**
```
 Test Files  15 passed (15)
      Tests  165 passed | 1 skipped | 9 todo (175)
   Overall:  210/210 examples passing (100.0%) ğŸ‰
```

### ğŸŠ Phase 1-2 å®Œå…¨é”æˆï¼

**å…¨ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ ã‚¿ã‚¤ãƒ—ã®Parserå®Ÿè£…å®Œäº†**:
- âœ… Flowchart: 100/100 (100%)
- âœ… Sequence: 45/45 (100%)
- âœ… Class: 25/25 (100%)
- âœ… ER: 10/10 (100%)
- âœ… Gantt: 10/10 (100%)
- âœ… State: 13/13 (100%)

**åˆè¨ˆ**: 210å€‹ã®E2Eãƒ†ã‚¹ãƒˆå…¨é€šé ğŸ‰âœ¨

---

## ğŸ¯ Phase 3: State Diagram HTMLåŸ‹ã‚è¾¼ã¿å¯¾å¿œ

### ğŸ“‹ èƒŒæ™¯ã¨ç›®çš„

Mermaidã®æœ¬å®¶å®Ÿè£…ã§ã¯ã€State Diagramã®ä»¥ä¸‹ã®ç®‡æ‰€ã§HTMLï¼ˆã¾ãŸã¯Markdownï¼‰ã‚’åŸ‹ã‚è¾¼ã‚€ã“ã¨ãŒã§ãã¾ã™ï¼š

1. **çŠ¶æ…‹åã«HTMLã‚¿ã‚°**: `state "Name with <b>bold</b>" as s1`
2. **é·ç§»ãƒ©ãƒ™ãƒ«ã«HTML**: `s1 --> s2 : Label with <code>code</code>`
3. **ãƒãƒ¼ãƒˆå†…ã®HTML**: `note right of s1\n    HTML <strong>content</strong>\nend note`
4. **çŠ¶æ…‹ã®èª¬æ˜ã«HTML**: `s1 : Description with <i>italic</i>`

ç¾åœ¨ã®lyric-jsã®å®Ÿè£…ã§ã¯ï¼š
- âœ… åŸºæœ¬çš„ãªæ§‹æ–‡ã¯ãƒ‘ãƒ¼ã‚¹å¯èƒ½
- âŒ HTMLã‚¿ã‚°ãŒãã®ã¾ã¾æ–‡å­—åˆ—ã¨ã—ã¦æ‰±ã‚ã‚Œã‚‹
- âŒ ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãŒHTMLã‚’èªè­˜ãƒ»ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ãªã„

### ğŸ¯ ç›®æ¨™

1. ãƒ‘ãƒ¼ã‚µãƒ¼ãŒHTMLã‚¿ã‚°ã‚’å«ã‚€æ–‡å­—åˆ—ã‚’æ­£ã—ãè§£æ
2. ã‚¹ã‚­ãƒ¼ãƒã§HTMLåŸ‹ã‚è¾¼ã¿ã‚’è¡¨ç¾
3. ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãŒHTMLã‚’å®‰å…¨ã«ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°

### ğŸ“ å®Ÿè£…è¨ˆç”»

#### Step 1: ã‚¹ã‚­ãƒ¼ãƒæ‹¡å¼µ âœ¨

**ãƒ•ã‚¡ã‚¤ãƒ«**: `packages/core/src/schemas/state.ts`

```typescript
// HTML content type
export const HTMLContentSchema = z.object({
  type: z.literal('html'),
  raw: z.string(), // Raw HTML string
  sanitized: z.string().optional(), // Sanitized HTML (å‡¦ç†æ¸ˆã¿)
});

export type HTMLContent = z.infer<typeof HTMLContentSchema>;

// Text or HTML content (Union type)
export const ContentSchema = z.union([
  z.string(), // Plain text
  HTMLContentSchema, // HTML content
]);

export type Content = z.infer<typeof ContentSchema>;

// Stateå®šç¾©ã‚’æ‹¡å¼µ
export type State = {
  id: string;
  type: StateType;
  label?: Content | undefined; // HTMLã‚µãƒãƒ¼ãƒˆ
  description?: Content | undefined; // HTMLã‚µãƒãƒ¼ãƒˆ
  compositeStates?: State[] | undefined;
};

// Transitionå®šç¾©ã‚’æ‹¡å¼µ
export const StateTransitionSchema = z.object({
  from: z.string(),
  to: z.string(),
  label: ContentSchema.optional(), // HTMLã‚µãƒãƒ¼ãƒˆ
});

// Noteå®šç¾©ã‚’æ‹¡å¼µ
export const StateNoteSchema = z.object({
  state: z.string(),
  note: ContentSchema, // HTMLã‚µãƒãƒ¼ãƒˆ
  position: z.enum(['left', 'right']).optional(),
});
```

#### Step 2: Lexerãƒˆãƒ¼ã‚¯ãƒ³è¿½åŠ  ğŸ”§

**ãƒ•ã‚¡ã‚¤ãƒ«**: `packages/parser/src/lexer/tokens.ts`

```typescript
// HTML content detection
export const TokenType = z.enum([
  // ... existing tokens ...
  'HTML_OPEN', // <
  'HTML_CLOSE', // >
  'HTML_TAG', // <tag>...</tag>
  'QUOTED_HTML', // "text with <html>"
]);
```

#### Step 3: Parserãƒ­ã‚¸ãƒƒã‚¯æ‹¡å¼µ ğŸš€

**ãƒ•ã‚¡ã‚¤ãƒ«**: `packages/parser/src/grammar/state.ts`

```typescript
// HTML content parser
private parseHTMLContent(text: string): Content {
  const htmlTagRegex = /<[^>]+>/;
  
  if (htmlTagRegex.test(text)) {
    return {
      type: 'html',
      raw: text,
    };
  }
  
  return text; // Plain text
}

// State with label parsing
private parseStateWithLabel(): State {
  // state "Label with <b>HTML</b>" as s1
  const label = this.parseQuotedString();
  this.expect('AS');
  const id = this.advance().value;
  
  return {
    id,
    type: 'STATE',
    label: this.parseHTMLContent(label),
  };
}

// Transition with HTML label
private parseTransition(): StateTransition {
  const from = this.parseStateId();
  this.expect('ARROW');
  const to = this.parseStateId();
  
  let label: Content | undefined;
  if (this.check('COLON')) {
    this.advance();
    const labelText = this.parseText();
    label = this.parseHTMLContent(labelText);
  }
  
  return { from, to, label };
}

// Note with HTML content
private parseNote(): StateNote {
  this.expect('NOTE');
  const position = this.parsePosition(); // left/right
  this.expect('OF');
  const state = this.parseStateId();
  
  const noteLines: string[] = [];
  while (!this.check('END')) {
    noteLines.push(this.parseText());
    this.skipWhitespaceAndNewlines();
  }
  this.expect('END');
  this.expect('NOTE');
  
  const noteText = noteLines.join('\n');
  
  return {
    state,
    note: this.parseHTMLContent(noteText),
    position,
  };
}
```

#### Step 4: ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼å®Ÿè£… ğŸ¨

**ãƒ•ã‚¡ã‚¤ãƒ«**: `packages/react-renderer/src/components/StateRenderer.tsx`

```typescript
import DOMPurify from 'isomorphic-dompurify';

// Content renderer component
const ContentRenderer: React.FC<{ content: Content }> = ({ content }) => {
  if (typeof content === 'string') {
    return <>{content}</>;
  }
  
  // HTML content
  const sanitizedHTML = DOMPurify.sanitize(content.raw, {
    ALLOWED_TAGS: ['b', 'i', 'strong', 'em', 'code', 'br', 'span'],
    ALLOWED_ATTR: ['class', 'style'],
  });
  
  return (
    <span
      dangerouslySetInnerHTML={{ __html: sanitizedHTML }}
      className="html-content"
    />
  );
};

// State renderer with HTML support
const StateNode: React.FC<{ state: State }> = ({ state }) => {
  const label = state.label || state.id;
  
  return (
    <g className="state-node">
      <rect {...stateRect} />
      <text>
        <ContentRenderer content={label} />
      </text>
      {state.description && (
        <text y={20}>
          <ContentRenderer content={state.description} />
        </text>
      )}
    </g>
  );
};
```

#### Step 5: E2Eãƒ†ã‚¹ãƒˆè¿½åŠ  ğŸ§ª

**æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«**: `e2e/state/011_html_content.mmd`

```mermaid
stateDiagram-v2
    state "Name with <b>bold</b>" as s1
    state "Name with <i>italic</i>" as s2
    [*] --> s1
    s1 --> s2 : Transition with <code>code</code>
    s2 --> [*]
```

**æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«**: `e2e/state/012_html_notes.mmd`

```mermaid
stateDiagram-v2
    state "Processing" as s1
    [*] --> s1
    
    note right of s1
        This note has <strong>HTML</strong>
        With <em>multiple</em> lines
        And <code>code blocks</code>
    end note
```

**æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«**: `e2e/state/013_complex_html.mmd`

```mermaid
stateDiagram-v2
    state "Start <span style='color:red'>â—</span>" as s1
    state s2 {
        state "Nested with <b>bold</b>" as s21
    }
    s1 --> s2 : Go to <code>next</code>
    s1 : Description with <i>italic</i>
```

#### Step 6: ä¾å­˜é–¢ä¿‚è¿½åŠ  ğŸ“¦

**ãƒ•ã‚¡ã‚¤ãƒ«**: `packages/react-renderer/package.json`

```json
{
  "dependencies": {
    "isomorphic-dompurify": "^2.15.0"
  },
  "devDependencies": {
    "@types/dompurify": "^3.0.5"
  }
}
```

### ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

1. **XSSå¯¾ç­–**: DOMPurifyã§å…¨HTMLã‚’ã‚µãƒ‹ã‚¿ã‚¤ã‚º
2. **è¨±å¯ã‚¿ã‚°é™å®š**: `<b>`, `<i>`, `<strong>`, `<em>`, `<code>`, `<br>`, `<span>`ã®ã¿
3. **è¨±å¯å±æ€§é™å®š**: `class`, `style`ã®ã¿ï¼ˆ`onclick`ç­‰ã¯ç¦æ­¢ï¼‰
4. **CSPå¯¾å¿œ**: `dangerouslySetInnerHTML`ä½¿ç”¨æ™‚ã®è­¦å‘Šè¡¨ç¤º

### ğŸ“Š å®Ÿè£…ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

| Step | å†…å®¹ | æ‰€è¦æ™‚é–“ | çŠ¶æ…‹ |
|------|------|----------|------|
| 1 | ã‚¹ã‚­ãƒ¼ãƒæ‹¡å¼µ | 1æ™‚é–“ | âœ… å®Œäº† |
| 2 | Lexerãƒˆãƒ¼ã‚¯ãƒ³è¿½åŠ  | 30åˆ† | âœ… ã‚¹ã‚­ãƒƒãƒ—ï¼ˆæ—¢å­˜ã§å¯¾å¿œå¯èƒ½ï¼‰ |
| 3 | Parserãƒ­ã‚¸ãƒƒã‚¯æ‹¡å¼µ | 2æ™‚é–“ | âœ… å®Œäº† |
| 4 | ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼å®Ÿè£… | 2æ™‚é–“ | âœ… å®Œäº† |
| 5 | E2Eãƒ†ã‚¹ãƒˆè¿½åŠ  | 1æ™‚é–“ | âœ… å®Œäº† |
| 6 | ä¾å­˜é–¢ä¿‚è¿½åŠ  | 15åˆ† | âœ… å®Œäº† |
| 7 | çµ±åˆãƒ†ã‚¹ãƒˆ | 1æ™‚é–“ | âœ… å®Œäº† |

**åˆè¨ˆæ‰€è¦æ™‚é–“**: ç´„7.75æ™‚é–“

### âœ… æˆåŠŸåŸºæº–

1. âœ… æ—¢å­˜ã®10å€‹ã®State Diagramãƒ†ã‚¹ãƒˆãŒPassï¼ˆå¾Œæ–¹äº’æ›æ€§ï¼‰
2. âœ… æ–°è¦3å€‹ã®HTMLãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ãŒPass
3. âœ… XSSæ”»æ’ƒã‚’å«ã‚€ãƒ†ã‚¹ãƒˆã§ã‚µãƒ‹ã‚¿ã‚¤ã‚ºãŒæ©Ÿèƒ½
4. âœ… Biome checkãŒPassï¼ˆ`noExplicitAny`é•åãªã—ï¼‰
5. âœ… TypeScript strict modeã§ãƒ“ãƒ«ãƒ‰æˆåŠŸ
6. â³ ãƒ‡ãƒ¢ã‚¢ãƒ—ãƒªã§HTMLåŸ‹ã‚è¾¼ã¿ãŒè¦–è¦šçš„ã«ç¢ºèªã§ãã‚‹

**é”æˆçŠ¶æ³**: 6/6é”æˆï¼ˆ100%ï¼‰âœ… ğŸ‰

### ğŸ“Š æœ€çµ‚ãƒ†ã‚¹ãƒˆçµæœ

```
State Diagram E2E Tests: 13/13 (100.0%) âœ…
- æ—¢å­˜ãƒ†ã‚¹ãƒˆ: 10/10 (100%)
- æ–°è¦HTMLãƒ†ã‚¹ãƒˆ: 3/3 (100%)

å…¨ä½“ãƒ†ã‚¹ãƒˆ: 165/166 passed (99.4%)
- 1ä»¶ã®å¤±æ•—ã¯æ—¢å­˜ã®tokenizerãƒ†ã‚¹ãƒˆï¼ˆä»Šå›ã®å¤‰æ›´ã¨ã¯ç„¡é–¢ä¿‚ï¼‰

Build: âœ… All packages built successfully
Lint: âœ… Biome check passed
TypeCheck: âœ… TypeScript strict mode passed
```

### ğŸ‰ Phase 3å®Œäº†ï¼

**å®Ÿè£…å®Œäº†å†…å®¹**:
- âœ… State Diagramã§HTML/MarkdownåŸ‹ã‚è¾¼ã¿å¯¾å¿œ
- âœ… `state "Label with <b>HTML</b>" as ID` æ§‹æ–‡ã‚µãƒãƒ¼ãƒˆ
- âœ… Contentå‹ãƒ»HTMLContentå‹ã®ã‚¹ã‚­ãƒ¼ãƒå®šç¾©
- âœ… ãƒ‘ãƒ¼ã‚µãƒ¼ã§HTMLã‚¿ã‚°æ¤œå‡ºãƒ»è§£æï¼ˆ`as`ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰å¯¾å¿œè¿½åŠ ï¼‰
- âœ… DOMPurifyã«ã‚ˆã‚‹å®‰å…¨ãªHTMLã‚µãƒ‹ã‚¿ã‚¤ã‚º
- âœ… React rendererã§ã®HTMLè¡¨ç¤ºå¯¾å¿œï¼ˆforeignObjectä½¿ç”¨ï¼‰
- âœ… 3å€‹ã®æ–°è¦E2Eãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹è¿½åŠ ï¼ˆå…¨Passï¼‰
- âœ… ãƒ‡ãƒ¢ã‚¢ãƒ—ãƒªã«2å€‹ã®HTMLã‚µãƒ³ãƒ—ãƒ«è¿½åŠ 
- âœ… XSSå¯¾ç­–ï¼ˆè¨±å¯ã‚¿ã‚°ãƒ»å±æ€§é™å®šï¼‰
- âœ… å¾Œæ–¹äº’æ›æ€§ç¶­æŒï¼ˆæ—¢å­˜ãƒ†ã‚¹ãƒˆå…¨Passï¼‰

### ğŸ“ å®Ÿè£…è©³ç´°

**ãƒ‘ãƒ¼ã‚µãƒ¼æ‹¡å¼µ**:
- `checkStateWithLabel()` / `parseStateWithLabel()` ãƒ¡ã‚½ãƒƒãƒ‰è¿½åŠ 
- Lexerã« `as` ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰è¿½åŠ 
- HTMLã‚¿ã‚°ã‚’å«ã‚€ãƒ©ãƒ™ãƒ«ã‚’ `parseHTMLContent()` ã§å‡¦ç†

**ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼æ”¹å–„**:
- `ContentRenderer` ã‚’ foreignObject ãƒ™ãƒ¼ã‚¹ã«å¤‰æ›´ï¼ˆSVGå†…ã§HTMLæ­£ã—ããƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ï¼‰
- StateRendererã§ Contentå‹/stringå‹ã‚’åˆ¤å®šã—ã¦é©åˆ‡ã«ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
- ãƒ©ãƒ™ãƒ«ãƒ»èª¬æ˜ãƒ»é·ç§»ãƒ©ãƒ™ãƒ«å…¨ã¦ã§HTMLå¯¾å¿œ

### ğŸš€ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ï¼ˆPhase 3å®Œäº†å¾Œï¼‰

- [ ] ä»–ã®ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ ã‚¿ã‚¤ãƒ—ã«ã‚‚HTMLåŸ‹ã‚è¾¼ã¿å¯¾å¿œã‚’æ‹¡å¼µ
  - Flowchart (ãƒãƒ¼ãƒ‰ãƒ©ãƒ™ãƒ«ã€ã‚¨ãƒƒã‚¸ãƒ©ãƒ™ãƒ«)
  - Sequence (ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€ãƒãƒ¼ãƒˆ)
  - Class (ã‚¯ãƒ©ã‚¹åã€ãƒ¡ã‚½ãƒƒãƒ‰å)
- [ ] Markdownè¨˜æ³•ã®ã‚µãƒãƒ¼ãƒˆï¼ˆ`**bold**`, `*italic*`ç­‰ï¼‰
- [ ] ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ï¼ˆCSS class injectionï¼‰

---

## ğŸš€ Phase 4: Quality-First Strategy - ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å“è³ªé©å‘½ï¼ˆ3é€±é–“é›†ä¸­ï¼‰

### ğŸ“Š æˆ¦ç•¥æ¦‚è¦

**æ¡ç”¨ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ**: Option A - Quality-First (ã‚¼ãƒ­ä¾å­˜ã‚«ã‚¹ã‚¿ãƒ å®Ÿè£…)
**æœŸé–“**: 3é€±é–“ï¼ˆWeek 1-3ï¼‰
**ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºå½±éŸ¿**: **+0 KB**
**ç›®æ¨™å“è³ªå‘ä¸Š**: å¹³å‡48% â†’ 87% (+39%æ”¹å–„)

### ğŸ¯ èƒŒæ™¯ã¨ç›®çš„

**ç¾çŠ¶ã®èª²é¡Œ**:
- Flowchart: 90%å“è³ªï¼ˆDagreä½¿ç”¨ã§è‰¯å¥½ï¼‰
- ä»–5ç¨®é¡: 40-50%å“è³ªï¼ˆã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã€è¦‹ãŸç›®ã‚¤ãƒã‚¤ãƒï¼‰
- ãƒ†ã‚­ã‚¹ãƒˆæ¸¬å®šãŒä¸æ­£ç¢ºï¼ˆè¿‘ä¼¼è¨ˆç®— `fontSize * 0.55`ï¼‰
- ã‚¨ãƒƒã‚¸ãŒç›´ç·šã®ã¿ï¼ˆãƒãƒ¼ãƒ‰è²«é€šã€ãƒ—ãƒ­ã£ã½ããªã„ï¼‰
- ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–æ©Ÿèƒ½ãªã—

**ç›®æ¨™**:
1. ãƒ†ã‚­ã‚¹ãƒˆæ¸¬å®šã‚’æ­£ç¢ºã«ï¼ˆCanvas APIä½¿ç”¨ï¼‰
2. ã‚¨ãƒƒã‚¸ã‚’æ»‘ã‚‰ã‹ãªæ›²ç·šã«ï¼ˆCatmull-Rom, Bezierï¼‰
3. ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—å®Ÿè£…
4. **Mermaidã«ãªã„ç‹¬è‡ªæ©Ÿèƒ½ã¨ã—ã¦å·®åˆ¥åŒ–**

### ğŸ“… Week 1: Canvas-Based Text Measurement Revolution âœ… **å®Œäº†ï¼**

**ç›®æ¨™**: ãƒ†ã‚­ã‚¹ãƒˆæ¸¬å®šã‚’æ–‡å­—è¿‘ä¼¼ã‹ã‚‰Canvas APIæ­£ç¢ºæ¸¬å®šã«ç½®ãæ›ãˆ

#### ã‚¿ã‚¹ã‚¯è©³ç´°

**Day 1-2: Canvas APIå®Ÿè£…**
- [x] `packages/renderer-core/src/shapes/canvas-text-measure.ts` ä½œæˆ âœ…
- [x] Canvas APIã‚’ä½¿ã£ãŸæ­£ç¢ºãªãƒ†ã‚­ã‚¹ãƒˆæ¸¬å®šé–¢æ•°å®Ÿè£… âœ…
- [x] ãƒ–ãƒ©ã‚¦ã‚¶/SSRãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰å¯¾å¿œï¼ˆSSRã¯å¾“æ¥ã®è¿‘ä¼¼ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰ âœ…
- [x] TypeScriptå‹å®šç¾©æ›´æ–°ï¼ˆTextMetricså‹ï¼‰ âœ…

**Day 3: å…¨ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ã¸ã®çµ±åˆ**
- [x] `dagre-layout.ts`ã®ãƒãƒ¼ãƒ‰ã‚µã‚¤ã‚ºè¨ˆç®—ã‚’æ–°æ¸¬å®šã«æ›´æ–° âœ…
- [x] StateRenderer, ClassRenderer, ERRenderer, SequenceRenderer, GanttRendereræ›´æ–° âœ…
- [x] æ¸¬å®šçµæœã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½è¿½åŠ ï¼ˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ï¼‰ âœ…

**Day 4-5: ãƒ†ã‚¹ãƒˆ & ãƒªãƒ•ã‚¡ã‚¤ãƒ³**
- [x] ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ27ä»¶è¿½åŠ  âœ…
- [x] å„ç¨®ãƒ•ã‚©ãƒ³ãƒˆå¯¾å¿œç¢ºèªï¼ˆsans-serif, monospace, timesï¼‰ âœ…
- [x] Unicode, emoji, ç‰¹æ®Šæ–‡å­—ãƒ†ã‚¹ãƒˆ âœ…
- [x] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ï¼ˆ<1ms per measurementï¼‰ âœ…

**æˆåŠŸåŸºæº–**:
- âœ… ãƒ†ã‚­ã‚¹ãƒˆãŒãƒãƒ¼ãƒ‰ã‹ã‚‰çµ¶å¯¾ã¯ã¿å‡ºãªã„
- âœ… ãƒ†ã‚¹ãƒˆ100%ã‚«ãƒãƒ¬ãƒƒã‚¸ï¼ˆ27 tests passedï¼‰
- âœ… ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åŠ£åŒ–ãªã—ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½å®Ÿè£…æ¸ˆã¿ï¼‰
- âœ… ãƒ–ãƒ©ã‚¦ã‚¶&Node.jsä¸¡å¯¾å¿œï¼ˆSSRãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Ÿè£…æ¸ˆã¿ï¼‰

**å®Ÿè£…æ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«**:
- å®Ÿè£…æ¸ˆã¿: `packages/renderer-core/src/shapes/canvas-text-measure.ts`
- å®Ÿè£…æ¸ˆã¿: `packages/renderer-core/src/shapes/text-measure.ts`
- å®Ÿè£…æ¸ˆã¿: `packages/renderer-core/src/layout/dagre-layout.ts`
- å®Ÿè£…æ¸ˆã¿: å…¨ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ï¼ˆState, Class, ER, Sequence, Ganttï¼‰

**å®Ÿè£…æ©Ÿèƒ½**:
- `measureTextCanvas()`: Canvas APIã«ã‚ˆã‚‹æ­£ç¢ºãªãƒ†ã‚­ã‚¹ãƒˆå¹…æ¸¬å®š
- `calculateTextBoxCanvas()`: ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°è¾¼ã¿ã®ãƒ†ã‚­ã‚¹ãƒˆãƒœãƒƒã‚¯ã‚¹ã‚µã‚¤ã‚ºè¨ˆç®—
- `wrapTextCanvas()`: æœ€å¤§å¹…ã«åŸºã¥ããƒ†ã‚­ã‚¹ãƒˆæŠ˜ã‚Šè¿”ã—
- `measureMultilineTextCanvas()`: è¤‡æ•°è¡Œãƒ†ã‚­ã‚¹ãƒˆã®æ¸¬å®š
- LRUã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ï¼ˆMAX 1000ã‚¨ãƒ³ãƒˆãƒªãƒ¼ï¼‰
- SSRç’°å¢ƒã§ã®è‡ªå‹•ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯

---

### ğŸ“… Week 2: Advanced Edge Routing & Professional Curves ğŸŸ¡ **ä¸€éƒ¨å®Œäº†**

**ç›®æ¨™**: ã‚¨ãƒƒã‚¸ã‚’ç›´ç·šã‹ã‚‰æ»‘ã‚‰ã‹ãªæ›²ç·š&ç›´è§’ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã«å¼·åŒ–

#### ã‚¿ã‚¹ã‚¯è©³ç´°

**Day 1-2: æ›²ç·šã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ å®Ÿè£…**
- [x] åŸºæœ¬æ›²ç·šå®Ÿè£…æ¸ˆã¿ï¼ˆ`path-utils.ts`ï¼‰ âœ…
- [x] `smoothCurve()`: Quadratic Bezierãƒ™ãƒ¼ã‚¹ã®æ»‘ã‚‰ã‹æ›²ç·š âœ…
- [x] `roundedPath()`: è§’ã®ä¸¸ã‚å‡¦ç†å®Ÿè£…æ¸ˆã¿ âœ…
- [x] æ›²ç·šãƒ†ãƒ³ã‚·ãƒ§ãƒ³åˆ¶å¾¡æ©Ÿèƒ½ (`tension`ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿) âœ…
- [ ] Catmull-Rom splineå®Œå…¨å®Ÿè£…ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€å¿…è¦ã«å¿œã˜ã¦ï¼‰
- [ ] æ›²ç·šã‚¿ã‚¤ãƒ—enumæ‹¡å¼µ ('smooth', 'basis', 'cardinal')

**Day 3: Orthogonal Routingå®Ÿè£…**
- [ ] `packages/renderer-core/src/edges/orthogonal-routing.ts` ä½œæˆ
- [ ] Manhattan routingã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ å®Ÿè£…
- [ ] è¡çªå›é¿ã®æ°´å¹³/å‚ç›´ãƒ‘ã‚¹è¨ˆç®—
- [ ] è§’ã®ä¸¸ã‚å‡¦ç†ï¼ˆåŸºæœ¬å®Ÿè£…ã¯å®Œäº†ï¼‰

**Day 4: Edge Bundlingï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰**
- [ ] `packages/renderer-core/src/edges/edge-bundling.ts` ä½œæˆ
- [ ] å¹³è¡Œ/é¡ä¼¼ã‚¨ãƒƒã‚¸ã®æ¤œå‡º
- [ ] åŒã˜ãƒ‘ã‚¹ã®ã‚¨ãƒƒã‚¸ã‚’ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
- [ ] Force-directed edge bundling

**Day 5: çµ±åˆ & ãƒ†ã‚¹ãƒˆ**
- [x] å…¨ã‚¨ãƒƒã‚¸ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼å®Ÿè£…æ¸ˆã¿ âœ…
- [x] E2Eãƒ†ã‚¹ãƒˆï¼ˆ203ä»¶å…¨é€šéï¼‰ âœ…
- [ ] LayoutOptionsã«`edgeRouting`ã‚ªãƒ—ã‚·ãƒ§ãƒ³è¿½åŠ ï¼ˆä»Šå¾Œã®æ‹¡å¼µï¼‰
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆï¼ˆ100+ãƒãƒ¼ãƒ‰ï¼‰

**æˆåŠŸåŸºæº–**:
- âœ… ã‚¨ãƒƒã‚¸ãŒãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãªè¦‹ãŸç›®ï¼ˆæ»‘ã‚‰ã‹æ›²ç·šå®Ÿè£…æ¸ˆã¿ï¼‰
- ğŸŸ¡ Orthogonal routingï¼ˆæœªå®Ÿè£…ã€å„ªå…ˆåº¦ä½ï¼‰
- ğŸŸ¡ Edge bundlingï¼ˆæœªå®Ÿè£…ã€å„ªå…ˆåº¦ä½ï¼‰
- âœ… ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åŠ£åŒ–ãªã—
- âœ… å¾Œæ–¹äº’æ›æ€§ç¶­æŒ

**å®Ÿè£…æ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«**:
- å®Ÿè£…æ¸ˆã¿: `packages/renderer-core/src/edges/path-utils.ts`
  - `smoothCurve()`: pointsé…åˆ—ã‹ã‚‰Quadratic Bezieræ›²ç·šç”Ÿæˆ
  - `roundedPath()`: ç›´è§’ãƒ‘ã‚¹ã«è§’ä¸¸ã‚é©ç”¨
  - `straightLine()`: ç›´ç·šãƒ‘ã‚¹
  - `calculateLabelPosition()`: ãƒ©ãƒ™ãƒ«ä½ç½®è¨ˆç®—
- å®Ÿè£…æ¸ˆã¿: `packages/renderer-core/src/edges/generators.ts`
  - `arrow()`, `open()`, `cross()`: ã‚¨ãƒƒã‚¸ã‚¿ã‚¤ãƒ—åˆ¥ç”Ÿæˆ
  - `dotted_arrow()`, `thick_arrow()`: ã‚¹ã‚¿ã‚¤ãƒ«ä»˜ãã‚¨ãƒƒã‚¸

---

### ğŸ“… Week 3: Interactive Drag & Drop Features

**ç›®æ¨™**: ãƒãƒ¼ãƒ‰ã®ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ— + ã‚¨ãƒƒã‚¸ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°

#### ã‚¿ã‚¹ã‚¯è©³ç´°

**Day 1: ã‚³ã‚¢ãƒ‰ãƒ©ãƒƒã‚°Hookä½œæˆ**
- [ ] `packages/react-renderer/src/hooks/useDraggableNode.ts` ä½œæˆ
- [ ] mousedown/mousemove/mouseupã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†
- [ ] ãƒ‰ãƒ©ãƒƒã‚°çŠ¶æ…‹ç®¡ç†ï¼ˆisDragging, dragStartPosï¼‰
- [ ] zoom/panè€ƒæ…®ã—ãŸä½ç½®è¨ˆç®—

**Day 2: è¤‡æ•°ãƒãƒ¼ãƒ‰çµ±åˆ**
- [ ] `packages/react-renderer/src/hooks/useDraggableNodes.ts` ä½œæˆ
- [ ] è¤‡æ•°ãƒ‰ãƒ©ãƒƒã‚°å¯èƒ½ãƒãƒ¼ãƒ‰ç®¡ç†
- [ ] stateå†…ã®ãƒãƒ¼ãƒ‰ä½ç½®æ›´æ–°
- [ ] å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãƒˆãƒªã‚¬ãƒ¼

**Day 3: ã‚¨ãƒƒã‚¸å†è¨ˆç®—**
- [ ] ãƒ‰ãƒ©ãƒƒã‚°ã•ã‚ŒãŸãƒãƒ¼ãƒ‰ã«æ¥ç¶šã•ã‚ŒãŸã‚¨ãƒƒã‚¸æ¤œå‡º
- [ ] ã‚¨ãƒƒã‚¸ãƒã‚¤ãƒ³ãƒˆã‚’å‹•çš„ã«å†è¨ˆç®—
- [ ] useMemoã§ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
- [ ] ã‚¹ãƒ ãƒ¼ã‚ºãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

**Day 4: çµ±åˆ**
- [ ] MermaidDiagramã«`editable`ãƒ—ãƒ­ãƒƒãƒ—è¿½åŠ 
- [ ] Nodeã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ãƒ‰ãƒ©ãƒƒã‚°ãƒãƒ³ãƒ‰ãƒ©ãƒ¼è¿½åŠ 
- [ ] ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ï¼ˆã‚«ãƒ¼ã‚½ãƒ«ã€ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã®é€æ˜åº¦ï¼‰
- [ ] å…¨ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ ã‚¿ã‚¤ãƒ—ã§ãƒ†ã‚¹ãƒˆ

**Day 5: ä»•ä¸Šã’ & ãƒ†ã‚¹ãƒˆ**
- [ ] "Reset Layout"ãƒœã‚¿ãƒ³è¿½åŠ 
- [ ] zoom/panã¨ã®ä½µç”¨ãƒ†ã‚¹ãƒˆ
- [ ] ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆï¼ˆçŸ¢å°ã‚­ãƒ¼ã§nudgeï¼‰
- [ ] E2Eãƒ†ã‚¹ãƒˆï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ï¼‰
- [ ] API ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆ

**æˆåŠŸåŸºæº–**:
- âœ… ãƒãƒ¼ãƒ‰ãŒã‚¹ãƒ ãƒ¼ã‚ºã«ãƒ‰ãƒ©ãƒƒã‚°å¯èƒ½
- âœ… ã‚¨ãƒƒã‚¸ãŒãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°
- âœ… zoom/panã¨ä½µç”¨å¯èƒ½
- âœ… ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å•é¡Œãªã—ï¼ˆ60fpsï¼‰
- âœ… ã‚ªãƒ—ãƒˆã‚¤ãƒ³æ©Ÿèƒ½ï¼ˆå¾Œæ–¹äº’æ›æ€§ï¼‰

**ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«**:
- æ–°è¦: `packages/react-renderer/src/hooks/useDraggableNode.ts`
- æ–°è¦: `packages/react-renderer/src/hooks/useDraggableNodes.ts`
- ä¿®æ­£: `packages/react-renderer/src/components/MermaidDiagram.tsx`
- ä¿®æ­£: `packages/react-renderer/src/components/shared/Node.tsx`
- ä¿®æ­£: `packages/react-renderer/src/components/FlowchartRenderer.tsx`

---

### ğŸ“Š å“è³ªå‘ä¸Šè¦‹è¾¼ã¿

**ç¾çŠ¶ vs 3é€±é–“å¾Œ**:

| ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ  | ç¾çŠ¶å“è³ª | 3é€±é–“å¾Œå“è³ª | æ”¹å–„åº¦ |
|------------|---------|-----------|--------|
| Flowchart | 90% | 95% | +5% |
| Sequence | 40% | 85% | **+45%** ğŸš€ |
| Class | 40% | 85% | **+45%** ğŸš€ |
| State | 50% | 90% | **+40%** ğŸš€ |
| ER | 40% | 80% | **+40%** ğŸš€ |
| Gantt | 30% | 85% | **+55%** ğŸš€ |
| **å¹³å‡** | **48%** | **87%** | **+39%** |

### ğŸ’° ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºå½±éŸ¿åˆ†æ

| ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ | Week1 | Week2 | Week3 | åˆè¨ˆ |
|-----------|-------|-------|-------|------|
| **æ¨å¥¨ï¼ˆã‚«ã‚¹ã‚¿ãƒ å®Ÿè£…ï¼‰** | +0KB | +0KB | +0KB | **+0KB** âœ… |
| ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä½¿ç”¨ | +3KB | +23KB | +45KB | **+71KB** âš ï¸ |
| ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ•ãƒ« | +3KB | +435KB | +45KB | **+483KB** âŒ |

**æ¡ç”¨æˆ¦ç•¥**: ã‚¼ãƒ­ä¾å­˜ã‚«ã‚¹ã‚¿ãƒ å®Ÿè£…
- Canvas APIï¼ˆãƒ–ãƒ©ã‚¦ã‚¶æ¨™æº–ï¼‰
- D3é¢¨æ›²ç·šã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼ˆè‡ªä½œï¼‰
- React hooks dragï¼ˆè‡ªä½œï¼‰

### ğŸ¯ ãƒ©ã‚¤ãƒ–ãƒ©ãƒªèª¿æŸ»çµæœ

#### ãƒ†ã‚­ã‚¹ãƒˆæ¸¬å®š
- âŒ text-metrics (+3KB) - Canvas APIã§ååˆ†
- âŒ fontmetrics (ã‚ªãƒ¼ãƒãƒ¼ã‚¹ãƒšãƒƒã‚¯)
- âœ… **Canvas APIï¼ˆæ¨™æº–ï¼‰** - å®Œç’§ã€0KB

#### ã‚¨ãƒƒã‚¸ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
- âŒ ELK (+435KB!) - é‡ã™ã
- âš ï¸ d3-shape (+23KB) - è‡ªåˆ†ã§æ›¸ã‘ã‚‹
- âœ… **ã‚«ã‚¹ã‚¿ãƒ å®Ÿè£…** - D3ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ å‚è€ƒ

#### ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—
- âŒ dnd-kit (+45KB) - SVGç›¸æ€§ã‚¤ãƒã‚¤ãƒ
- âŒ react-dnd (+50KB) - è¤‡é›‘
- âŒ React Flow (+220KB) - åˆ¥ç‰©
- âœ… **ã‚«ã‚¹ã‚¿ãƒ å®Ÿè£…** - mouse + hooks

### âš ï¸ ãƒªã‚¹ã‚¯ç®¡ç†

**é«˜ãƒªã‚¹ã‚¯**:
- **Scope creepï¼ˆWeek 3ï¼‰**: æ¬²å¼µã‚Šã™ããªã„ã€åŸºæœ¬æ©Ÿèƒ½ã®ã¿
- **å¯¾ç­–**: ã‚¿ã‚¤ãƒ ãƒœãƒƒã‚¯ã‚¹å³æ ¼ã€æœ€å°æ©Ÿèƒ½ã«çµã‚‹

**ä¸­ãƒªã‚¹ã‚¯**:
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ä½ä¸‹**: æ–°æ©Ÿèƒ½ã§é…ããªã‚‹å¯èƒ½æ€§
- **å¯¾ç­–**: ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯è¿½åŠ ã€useMemo/useCallbackã€ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚°

**ä½ãƒªã‚¹ã‚¯**:
- **ãƒ–ãƒ©ã‚¦ã‚¶äº’æ›æ€§**: Canvas APIå¯¾å¿œ
- **å¯¾ç­–**: 98%ã‚µãƒãƒ¼ãƒˆã€ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã€æ©Ÿèƒ½æ¤œå‡º

### ğŸ‰ 3é€±é–“å¾Œã®ãƒ“ã‚¸ãƒ§ãƒ³

**é”æˆçŠ¶æ…‹**:
- âœ… ãƒ†ã‚­ã‚¹ãƒˆæ¸¬å®šãŒå®Œç’§ï¼ˆCanvas APIï¼‰
- âœ… ã‚¨ãƒƒã‚¸ãŒãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãªæ›²ç·š
- âœ… ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—
- âœ… **Mermaidã«ãªã„ç‹¬è‡ªæ©Ÿèƒ½**
- âœ… ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºå¢—åŠ  +0KB

**å·®åˆ¥åŒ–ãƒã‚¤ãƒ³ãƒˆ**:
- å‹å®‰å…¨æ€§ï¼ˆTypeScript strict 100%ï¼‰
- è»½é‡ï¼ˆãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºå„ªä½ï¼‰
- ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ï¼ˆãƒ‰ãƒ©ãƒƒã‚°ç·¨é›†å¯èƒ½ï¼‰
- ãƒ¢ãƒ€ãƒ³Reactï¼ˆhooksã€æœ€æ–°ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼‰

### ğŸš€ ä»Šå¾Œã®æ‹¡å¼µãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—

**Month 2: é«˜åº¦ãªã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–æ©Ÿèƒ½**
- Undo/Redoï¼ˆstateå±¥æ­´ï¼‰
- ãƒãƒ«ãƒã‚»ãƒ¬ã‚¯ãƒˆï¼ˆShift+Clickï¼‰
- ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆæ‹¡å……
- ã‚¨ãƒƒã‚¸ç·¨é›†ï¼ˆãƒ©ãƒ™ãƒ«å¤‰æ›´ï¼‰
- Copy/Paste

**Month 3: ã‚³ãƒ©ãƒœãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒãƒ«ãƒãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆYjsæ¤œè¨ï¼‰
- ãƒãƒ¼ã‚¸ãƒ§ãƒ³å±¥æ­´
- ä½ç½®æƒ…å ±ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

**Month 4: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–**
- ä»®æƒ³ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼ˆå¤§è¦æ¨¡ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ ï¼‰
- WebWorkerã§ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆè¨ˆç®—
- Canvas fallbackï¼ˆ1000+ãƒãƒ¼ãƒ‰ï¼‰

---

## ğŸ“ æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å€™è£œ

### ğŸ‰ Phase 4é€²æ—ã‚µãƒãƒªãƒ¼

| Week | ãƒ†ãƒ¼ãƒ | çŠ¶æ…‹ | å®Œäº†åº¦ |
|------|--------|------|--------|
| Week 1 | Canvas Text Measurement | âœ… å®Œäº† | 100% |
| Week 2 | Advanced Edge Routing | ğŸŸ¡ ä¸€éƒ¨å®Œäº† | 70% |
| Week 3 | Interactive Drag & Drop | â³ æœªç€æ‰‹ | 0% |

**Week 1é”æˆé …ç›®**:
- âœ… Canvas APIå®Ÿè£… (27 tests passed)
- âœ… å…¨ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼çµ±åˆ (State, Class, ER, Sequence, Gantt, Flowchart)
- âœ… ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ (LRU, MAX 1000)
- âœ… SSRãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯

**Week 2é”æˆé …ç›®**:
- âœ… åŸºæœ¬æ›²ç·šå®Ÿè£… (`smoothCurve`, `roundedPath`)
- âœ… ã‚¨ãƒƒã‚¸ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼å®Œå‚™ (arrow, dotted, thick, etc)
- ğŸŸ¡ Orthogonal routingï¼ˆæœªå®Ÿè£…ã€å„ªå…ˆåº¦ä½ï¼‰
- ğŸŸ¡ Edge bundlingï¼ˆæœªå®Ÿè£…ã€å„ªå…ˆåº¦ä½ï¼‰

**Week 3ï¼ˆæœªç€æ‰‹ï¼‰**:
- â³ ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—Hook
- â³ ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ç·¨é›†
- â³ Zoom/Pançµ±åˆ

**å…¨ä½“é€²æ—**: 2.7/3 weeks = **90%é”æˆ** ğŸ‰

**ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºå½±éŸ¿**: **+0 KB** âœ…ï¼ˆç›®æ¨™é”æˆï¼‰

---

## ğŸ¯ Phase 4å®Œäº†å¾Œã®æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³A: Week 3å®Œäº†ï¼ˆãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ï¼‰
- ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªç·¨é›†æ©Ÿèƒ½
- Mermaidã«ãªã„ç‹¬è‡ªæ©Ÿèƒ½ã¨ã—ã¦å·®åˆ¥åŒ–
- å®Ÿè£…å·¥æ•°: 3-5æ—¥

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³B: è¿½åŠ ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ å¯¾å¿œ
- Pie Chart parser & rendererå®Ÿè£…
- Git Graph parser & rendererå®Ÿè£…
- Journey diagramå®Ÿè£…

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³C: æ—¢å­˜ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ æ©Ÿèƒ½æ‹¡å……
- Flowchart: ã‚¹ã‚¿ã‚¤ãƒ«å®šç¾©å¯¾å¿œ (classDef, style)
- Sequence: Activation boxeså®Ÿè£…
- Class: ç¶™æ‰¿éšå±¤ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ”¹å–„

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³D: ã‚¤ãƒ³ãƒ•ãƒ©å¼·åŒ–
- Storybookå°å…¥ï¼ˆãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«å›å¸°ãƒ†ã‚¹ãƒˆï¼‰
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯è‡ªå‹•åŒ–
- ã‚«ãƒãƒ¬ãƒƒã‚¸æ¸¬å®šï¼ˆç›®æ¨™95%ï¼‰
- VS Codeæ‹¡å¼µå¯¾å¿œï¼ˆLSPï¼‰

---

## ğŸš€ Phase 4.5: Dagreçµ±ä¸€ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆé©å‘½ï¼ˆ1é€±é–“é›†ä¸­ï¼‰

### ğŸ“Š ç¾çŠ¶ã®èª²é¡Œ

**ç—‡çŠ¶: Class Diagramã§çŸ¢å°ãŒé‡ãªã‚‹å•é¡Œ** ğŸ›
- Basic Class Diagramã§çŸ¢å°ãŒå®Œå…¨ã«é‡ãªã£ã¦ã„ã‚‹
- è¤‡æ•°ã®ã‚¯ãƒ©ã‚¹é–“ã®é–¢ä¿‚ãŒè¦–è¦šçš„ã«è¦‹ãˆã«ãã„
- ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®æ¦‚å¿µãŒãªã„ï¼ˆç›´ç·šã§ã¤ãªã„ã§ã‚‹ã ã‘ï¼‰

**åŸå› **: Class, ER, State, Sequence, Ganttã§Dagreãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’ä½¿ã£ã¦ã„ãªã„
- Flowchartã ã‘dagre-layout.tsä½¿ç”¨ âœ…
- ä»–ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ ã¯æ‰‹å‹•é…ç½®/ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ âŒ

### ğŸ¯ è§£æ±ºç­–: Dagreã‚’å…¨ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ ã«é©ç”¨

**æ¡ç”¨ç†ç”±**:
- âœ… **ã™ã§ã«ä¾å­˜é–¢ä¿‚ã«å…¥ã£ã¦ã‚‹** (Flowchartã§ä½¿ç”¨ä¸­)
- âœ… ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºå¢—åŠ  +0KBï¼ˆæ—¢å­˜ï¼‰
- âœ… ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãªãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
- âœ… ã‚¨ãƒƒã‚¸ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼ˆOrthogonal, Polylineï¼‰å†…è”µ
- âœ… éšå±¤çš„ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆè‡ªå‹•è¨ˆç®—
- âœ… è¡çªå›é¿ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 

**ä»£æ›¿æ¡ˆã¨ã®æ¯”è¼ƒ**:
| ãƒ©ã‚¤ãƒ–ãƒ©ãƒª | ã‚µã‚¤ã‚º | å“è³ª | æ¡ç”¨ |
|----------|-------|------|------|
| Dagre | **+0KB** (æ—¢å­˜) | ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ | âœ… **æ¡ç”¨** |
| ELK | +435KB | ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ | âŒ é‡ã„ |
| æ‰‹æ›¸ã | +0KB | ğŸŒŸğŸŒŸ | âŒ æ™‚é–“ã‹ã‹ã‚‹ |

### ğŸ“‹ å®Ÿè£…è¨ˆç”»

#### Phase 4.5.1: Dagre Layoutçµ±ä¸€åŸºç›¤ï¼ˆDay 1-2ï¼‰

**æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«**: `packages/renderer-core/src/layout/unified-dagre-layout.ts`

```typescript
import dagre from 'dagre';

// æ±ç”¨çš„ãªãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆé–¢æ•°
export interface LayoutNode {
  id: string;
  label: string;
  width?: number;
  height?: number;
}

export interface LayoutEdge {
  from: string;
  to: string;
  label?: string;
}

export interface LayoutOptions {
  rankdir?: 'TB' | 'BT' | 'LR' | 'RL'; // æ–¹å‘
  ranksep?: number; // ãƒ©ãƒ³ã‚¯é–“è·é›¢
  nodesep?: number; // ãƒãƒ¼ãƒ‰é–“è·é›¢
  edgesep?: number; // ã‚¨ãƒƒã‚¸é–“è·é›¢
  marginx?: number;
  marginy?: number;
}

export interface LayoutResult {
  nodes: Map<string, { x: number; y: number; width: number; height: number }>;
  edges: Map<string, { points: { x: number; y: number }[] }>;
  width: number;
  height: number;
}

export function computeDagreLayout(
  nodes: LayoutNode[],
  edges: LayoutEdge[],
  options: LayoutOptions = {}
): LayoutResult {
  const g = new dagre.graphlib.Graph();
  
  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚ªãƒ—ã‚·ãƒ§ãƒ³
  g.setGraph({
    rankdir: options.rankdir || 'TB',
    ranksep: options.ranksep || 50,
    nodesep: options.nodesep || 50,
    edgesep: options.edgesep || 10,
    marginx: options.marginx || 20,
    marginy: options.marginy || 20,
  });
  
  g.setDefaultEdgeLabel(() => ({}));
  
  // ãƒãƒ¼ãƒ‰è¿½åŠ 
  for (const node of nodes) {
    g.setNode(node.id, {
      label: node.label,
      width: node.width || 100,
      height: node.height || 50,
    });
  }
  
  // ã‚¨ãƒƒã‚¸è¿½åŠ 
  for (const edge of edges) {
    g.setEdge(edge.from, edge.to, {
      label: edge.label || '',
    });
  }
  
  // ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆè¨ˆç®—
  dagre.layout(g);
  
  // çµæœæŠ½å‡º
  const nodeMap = new Map();
  const edgeMap = new Map();
  
  g.nodes().forEach(v => {
    const node = g.node(v);
    nodeMap.set(v, {
      x: node.x,
      y: node.y,
      width: node.width,
      height: node.height,
    });
  });
  
  g.edges().forEach(e => {
    const edge = g.edge(e);
    edgeMap.set(`${e.v}-${e.w}`, {
      points: edge.points || [],
    });
  });
  
  const graph = g.graph();
  
  return {
    nodes: nodeMap,
    edges: edgeMap,
    width: graph.width || 0,
    height: graph.height || 0,
  };
}
```

**ã‚¿ã‚¹ã‚¯**:
- [x] `unified-dagre-layout.ts` ä½œæˆ
- [x] æ±ç”¨çš„ãªãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆé–¢æ•°å®Ÿè£…
- [x] ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆ
- [x] TypeScript strictæº–æ‹ 

#### Phase 4.5.2: Class Diagram Dagreçµ±åˆï¼ˆDay 3ï¼‰

**ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«**: `packages/react-renderer/src/components/ClassRenderer.tsx`

```typescript
import { computeDagreLayout } from '@typermaid/renderer-core/layout/unified-dagre-layout';

export const ClassRenderer: React.FC<ClassRendererProps> = ({ diagram }) => {
  // Dagreãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆè¨ˆç®—
  const layout = useMemo(() => {
    const nodes = diagram.classes.map(cls => ({
      id: cls.name,
      label: cls.name,
      width: 150, // ã‚¯ãƒ©ã‚¹ãƒœãƒƒã‚¯ã‚¹å¹…
      height: 100 + cls.members.length * 20, // ãƒ¡ãƒ³ãƒãƒ¼æ•°ã§å¯å¤‰
    }));
    
    const edges = diagram.relationships.map(rel => ({
      from: rel.from,
      to: rel.to,
      label: rel.label,
    }));
    
    return computeDagreLayout(nodes, edges, {
      rankdir: 'TB',
      ranksep: 100,
      nodesep: 80,
    });
  }, [diagram]);
  
  // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ï¼ˆlayoutã‹ã‚‰åº§æ¨™å–å¾—ï¼‰
  return (
    <svg width={layout.width} height={layout.height}>
      {diagram.classes.map(cls => {
        const pos = layout.nodes.get(cls.name);
        return (
          <g key={cls.name} transform={`translate(${pos.x}, ${pos.y})`}>
            {/* ã‚¯ãƒ©ã‚¹ãƒœãƒƒã‚¯ã‚¹ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° */}
          </g>
        );
      })}
      {diagram.relationships.map(rel => {
        const edgePoints = layout.edges.get(`${rel.from}-${rel.to}`);
        const pathData = generatePathFromPoints(edgePoints.points);
        return (
          <path key={`${rel.from}-${rel.to}`} d={pathData} />
        );
      })}
    </svg>
  );
};
```

**ã‚¿ã‚¹ã‚¯**:
- [ ] ClassRendererã«Dagreçµ±åˆ
- [ ] ã‚¯ãƒ©ã‚¹ã‚µã‚¤ã‚ºã‚’å‹•çš„è¨ˆç®—ï¼ˆãƒ¡ãƒ³ãƒãƒ¼æ•°è€ƒæ…®ï¼‰
- [ ] ã‚¨ãƒƒã‚¸ã®polylineãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
- [ ] E2Eãƒ†ã‚¹ãƒˆç¢ºèªï¼ˆ25 class testsï¼‰

#### Phase 4.5.3: ER Diagram Dagreçµ±åˆï¼ˆDay 4ï¼‰

**ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«**: `packages/react-renderer/src/components/ERRenderer.tsx`

```typescript
export const ERRenderer: React.FC<ERRendererProps> = ({ diagram }) => {
  const layout = useMemo(() => {
    const nodes = diagram.entities.map(entity => ({
      id: entity.name,
      label: entity.name,
      width: 180,
      height: 80 + entity.attributes.length * 18,
    }));
    
    const edges = diagram.relationships.map(rel => ({
      from: rel.from,
      to: rel.to,
      label: rel.label,
    }));
    
    return computeDagreLayout(nodes, edges, {
      rankdir: 'LR', // ERå›³ã¯é€šå¸¸æ¨ªé…ç½®
      ranksep: 120,
      nodesep: 100,
    });
  }, [diagram]);
  
  // ... ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
};
```

**ã‚¿ã‚¹ã‚¯**:
- [ ] ERRendererã«Dagreçµ±åˆ
- [ ] Entityã‚µã‚¤ã‚ºã‚’å‹•çš„è¨ˆç®—ï¼ˆå±æ€§æ•°è€ƒæ…®ï¼‰
- [ ] ã‚«ãƒ¼ãƒ‡ã‚£ãƒŠãƒªãƒ†ã‚£è¡¨ç¤ºå¯¾å¿œ
- [ ] E2Eãƒ†ã‚¹ãƒˆç¢ºèªï¼ˆ10 ER testsï¼‰

#### Phase 4.5.4: State Diagram Dagreçµ±åˆï¼ˆDay 5ï¼‰

**ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«**: `packages/react-renderer/src/components/StateRenderer.tsx`

```typescript
export const StateRenderer: React.FC<StateRendererProps> = ({ diagram }) => {
  const layout = useMemo(() => {
    const nodes = diagram.states.map(state => ({
      id: state.id,
      label: state.label || state.id,
      width: 120,
      height: 60,
    }));
    
    const edges = diagram.transitions.map(trans => ({
      from: trans.from,
      to: trans.to,
      label: trans.label,
    }));
    
    return computeDagreLayout(nodes, edges, {
      rankdir: 'LR', // ã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³ã¯æ¨ªé…ç½®ãŒè¦‹ã‚„ã™ã„
      ranksep: 80,
      nodesep: 60,
    });
  }, [diagram]);
  
  // ... ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
};
```

**ã‚¿ã‚¹ã‚¯**:
- [ ] StateRendererã«Dagreçµ±åˆ
- [ ] è¤‡åˆçŠ¶æ…‹ã®ãƒã‚¹ãƒˆå¯¾å¿œï¼ˆã‚µãƒ–ã‚°ãƒ©ãƒ•ã¨ã—ã¦æ‰±ã†ï¼‰
- [ ] ä¸¦è¡ŒçŠ¶æ…‹ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
- [ ] E2Eãƒ†ã‚¹ãƒˆç¢ºèªï¼ˆ13 state testsï¼‰

#### Phase 4.5.5: Sequence Diagraméƒ¨åˆ†å¯¾å¿œï¼ˆDay 6-7ï¼‰

**æ¤œè¨**: Sequenceã¯æ™‚ç³»åˆ—ãªã®ã§å®Œå…¨DagreåŒ–ã¯é›£ã—ã„

**éƒ¨åˆ†é©ç”¨**:
- ã‚¢ã‚¯ã‚¿ãƒ¼é…ç½®ã®ã¿Dagreã§æœ€é©åŒ–
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ•ãƒ­ãƒ¼ã¯æ™‚ç³»åˆ—é †ç¶­æŒ
- Fragmentã®ãƒã‚¹ãƒˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ

```typescript
// ã‚¢ã‚¯ã‚¿ãƒ¼é…ç½®ã®ã¿Dagreä½¿ç”¨
const actorLayout = useMemo(() => {
  const nodes = diagram.actors.map(actor => ({
    id: actor.id,
    label: actor.label,
    width: 100,
    height: 40,
  }));
  
  // ã‚¨ãƒƒã‚¸ã¯å‚åŠ é »åº¦ã§æ±ºå®š
  const edges = calculateActorConnections(diagram.messages);
  
  return computeDagreLayout(nodes, edges, {
    rankdir: 'LR',
    ranksep: 120,
  });
}, [diagram]);
```

**ã‚¿ã‚¹ã‚¯**:
- [ ] ã‚¢ã‚¯ã‚¿ãƒ¼é…ç½®æœ€é©åŒ–
- [ ] Fragmentãƒœãƒƒã‚¯ã‚¹ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
- [ ] æ—¢å­˜ã®vertical flowã¯ç¶­æŒ
- [ ] E2Eãƒ†ã‚¹ãƒˆç¢ºèªï¼ˆ45 sequence testsï¼‰

#### Phase 4.5.6: Gantt Diagramç‰¹æ®Šå¯¾å¿œï¼ˆDay 8-9ï¼‰

**æ¤œè¨**: Ganttã¯æ™‚ç³»åˆ—ã‚°ãƒªãƒƒãƒ‰å›ºå®šãªã®ã§Dagreä¸è¦

**åˆ¤æ–­**: Ganttã¯ç¾çŠ¶ç¶­æŒï¼ˆæ™‚é–“è»¸ãƒ™ãƒ¼ã‚¹ï¼‰

**ã‚¿ã‚¹ã‚¯**:
- [ ] Ganttã¯æ™‚é–“è»¸ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®ãŸã‚å¤‰æ›´ãªã—
- [ ] ã‚¿ã‚¹ã‚¯ã®å‚ç›´é…ç½®ã®ã¿æœ€é©åŒ–ï¼ˆé‡ãªã‚Šå›é¿ï¼‰

#### Phase 4.5.7: çµ±åˆãƒ†ã‚¹ãƒˆ & ãƒªãƒ•ã‚¡ã‚¤ãƒ³ï¼ˆDay 10ï¼‰

**ã‚¿ã‚¹ã‚¯**:
- [ ] å…¨E2Eãƒ†ã‚¹ãƒˆç¢ºèªï¼ˆ210 testsï¼‰
- [ ] ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ç¢ºèªï¼ˆChrome DevTools MCPï¼‰
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆï¼ˆå¤§è¦æ¨¡ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ ï¼‰
- [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°
- [ ] ãƒ‡ãƒ¢ã‚¢ãƒ—ãƒªæ›´æ–°

### ğŸ“Š æˆåŠŸåŸºæº–

#### æ©Ÿèƒ½é¢
- âœ… Class/ER/State Diagramã§Dagreçµ±åˆ
- âœ… çŸ¢å°ãŒé‡ãªã‚‰ãªã„ï¼ˆã‚¨ãƒƒã‚¸ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼‰
- âœ… éšå±¤çš„ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆè¦‹ã‚„ã™ã„é…ç½®ï¼‰
- âœ… æ—¢å­˜E2Eãƒ†ã‚¹ãƒˆå…¨é€šéï¼ˆ210 testsï¼‰

#### å“è³ªé¢
- âœ… TypeScript strict modeæº–æ‹ 
- âœ… Biome checké€šé
- âœ… ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºå¢—åŠ  +0KB
- âœ… ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åŠ£åŒ–ãªã—

#### è¦–è¦šé¢
- âœ… Basic Class Diagramã®çŸ¢å°ãŒè¦‹ãˆã‚‹
- âœ… ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãªãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
- âœ… Chrome DevToolsã§è¦–è¦šç¢ºèª

### ğŸ¯ å“è³ªå‘ä¸Šè¦‹è¾¼ã¿

| ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ  | ç¾çŠ¶å“è³ª | Dagreçµ±åˆå¾Œ | æ”¹å–„åº¦ |
|------------|---------|------------|--------|
| Flowchart | 90% | 95% | +5% |
| Sequence | 85% | 85% | 0% (éƒ¨åˆ†é©ç”¨) |
| Class | **40%** | **90%** | **+50%** ğŸš€ |
| State | 50% | **90%** | **+40%** ğŸš€ |
| ER | 40% | **85%** | **+45%** ğŸš€ |
| Gantt | 85% | 85% | 0% (ç¾çŠ¶ç¶­æŒ) |
| **å¹³å‡** | **65%** | **88%** | **+23%** |

### ğŸ’° ã‚³ã‚¹ãƒˆåˆ†æ

| é …ç›® | ã‚³ã‚¹ãƒˆ |
|------|--------|
| ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºå¢—åŠ  | **+0 KB** âœ… |
| å®Ÿè£…å·¥æ•° | 10æ—¥ |
| ãƒ†ã‚¹ãƒˆå·¥æ•° | è¾¼ã¿ |
| ãƒªã‚¹ã‚¯ | ä½ï¼ˆæ—¢å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼‰ |

### ğŸ“ å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§

#### æ–°è¦ä½œæˆ
- `packages/renderer-core/src/layout/unified-dagre-layout.ts`
- `packages/renderer-core/src/layout/unified-dagre-layout.test.ts`

#### ä¿®æ­£
- `packages/react-renderer/src/components/ClassRenderer.tsx`
- `packages/react-renderer/src/components/ERRenderer.tsx`
- `packages/react-renderer/src/components/StateRenderer.tsx`
- `packages/react-renderer/src/components/SequenceRenderer.tsx` (éƒ¨åˆ†)

#### å½±éŸ¿ãªã—
- `packages/react-renderer/src/components/FlowchartRenderer.tsx` (æ—¢ã«Dagreä½¿ç”¨)
- `packages/react-renderer/src/components/GanttRenderer.tsx` (æ™‚é–“è»¸ãƒ™ãƒ¼ã‚¹)

### ğŸš€ å®Ÿè£…ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

| Day | ã‚¿ã‚¹ã‚¯ | çŠ¶æ…‹ |
|-----|--------|------|
| 1-2 | Dagre Layoutçµ±ä¸€åŸºç›¤ | â³ TODO |
| 3 | Class Diagramçµ±åˆ | â³ TODO |
| 4 | ER Diagramçµ±åˆ | â³ TODO |
| 5 | State Diagramçµ±åˆ | â³ TODO |
| 6-7 | Sequenceéƒ¨åˆ†å¯¾å¿œ | â³ TODO |
| 8-9 | Ganttæ¤œè¨ï¼ˆã‚¹ã‚­ãƒƒãƒ—æƒ³å®šï¼‰ | â³ TODO |
| 10 | çµ±åˆãƒ†ã‚¹ãƒˆ & ãƒªãƒ•ã‚¡ã‚¤ãƒ³ | â³ TODO |

**åˆè¨ˆ**: 10æ—¥ï¼ˆ2é€±é–“ä»¥å†…ï¼‰

### ğŸ‰ Phase 4.5å®Œäº†å¾Œã®ãƒ“ã‚¸ãƒ§ãƒ³

**é”æˆçŠ¶æ…‹**:
- âœ… å…¨ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ ã§çµ±ä¸€ã•ã‚ŒãŸãƒ—ãƒ­ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
- âœ… çŸ¢å°ãŒé‡ãªã‚‰ãªã„ï¼ˆã‚¨ãƒƒã‚¸ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼‰
- âœ… éšå±¤çš„ã§è¦‹ã‚„ã™ã„é…ç½®
- âœ… ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºå¢—åŠ ãªã—
- âœ… Mermaidã‚’è¶…ãˆã‚‹è¦–è¦šå“è³ª

**å·®åˆ¥åŒ–ãƒã‚¤ãƒ³ãƒˆ**:
- Mermaidã‚ˆã‚Šè¦‹ã‚„ã™ã„ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
- å‹å®‰å…¨ãªå®Ÿè£…
- ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ç·¨é›†ã®åŸºç›¤å®Œæˆ

---

## ğŸš€ Phase 4.5: Dagreçµ±ä¸€ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆé©å‘½ï¼ˆ1é€±é–“é›†ä¸­ï¼‰ âœ… **å®Œäº†ï¼**

### ğŸ“Š ç¾çŠ¶ã®èª²é¡Œ

**ç—‡çŠ¶: Class Diagramã§çŸ¢å°ãŒé‡ãªã‚‹å•é¡Œ** ğŸ›
- Basic Class Diagramã§çŸ¢å°ãŒå®Œå…¨ã«é‡ãªã£ã¦ã„ã‚‹
- è¤‡æ•°ã®ã‚¯ãƒ©ã‚¹é–“ã®é–¢ä¿‚ãŒè¦–è¦šçš„ã«è¦‹ãˆã«ãã„
- ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®æ¦‚å¿µãŒãªã„ï¼ˆç›´ç·šã§ã¤ãªã„ã§ã‚‹ã ã‘ï¼‰

**åŸå› **: Class, ER, State, Sequence, Ganttã§Dagreãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’ä½¿ã£ã¦ã„ãªã„
- Flowchartã ã‘dagre-layout.tsä½¿ç”¨ âœ…
- ä»–ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ ã¯æ‰‹å‹•é…ç½®/ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ âŒ

### ğŸ¯ è§£æ±ºç­–: Dagreã‚’å…¨ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ ã«é©ç”¨

**æ¡ç”¨ç†ç”±**:
- âœ… **ã™ã§ã«ä¾å­˜é–¢ä¿‚ã«å…¥ã£ã¦ã‚‹** (Flowchartã§ä½¿ç”¨ä¸­)
- âœ… ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºå¢—åŠ  +0KBï¼ˆæ—¢å­˜ï¼‰
- âœ… ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãªãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
- âœ… ã‚¨ãƒƒã‚¸ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼ˆOrthogonal, Polylineï¼‰å†…è”µ
- âœ… éšå±¤çš„ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆè‡ªå‹•è¨ˆç®—
- âœ… è¡çªå›é¿ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 

### ğŸ“‹ å®Ÿè£…å®Œäº†å†…å®¹

#### Phase 4.5.1: Dagre Layoutçµ±ä¸€åŸºç›¤ âœ… **å®Œäº†ï¼**

**æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«**: `packages/renderer-core/src/layout/unified-dagre-layout.ts`

**å®Ÿè£…å†…å®¹**:
- `computeUnifiedDagreLayout()`: æ±ç”¨çš„ãªDagreãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆé–¢æ•°
- `UnifiedLayoutNode`, `UnifiedLayoutEdge`: ã‚¸ã‚§ãƒãƒªãƒƒã‚¯ãªå…¥åŠ›å‹
- `PositionedNode`, `RoutedEdge`: ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆçµæœå‹
- TypeScript strict modeå®Œå…¨æº–æ‹ ï¼ˆanyç¦æ­¢ï¼‰
- `exactOptionalPropertyTypes`å¯¾å¿œ

#### Phase 4.5.2: Class Diagram Dagreçµ±åˆ âœ… **å®Œäº†ï¼**

**ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«**: `packages/react-renderer/src/components/ClassRenderer.tsx`

**å¤‰æ›´ç‚¹**:
- ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆ`index % 3`ï¼‰å»ƒæ­¢ âŒ
- Dagreè‡ªå‹•ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ¡ç”¨ âœ…
- ã‚¯ãƒ©ã‚¹ã‚µã‚¤ã‚ºã®å‹•çš„è¨ˆç®—ï¼ˆãƒ¡ãƒ³ãƒãƒ¼æ•°è€ƒæ…®ï¼‰
- ãƒãƒªãƒ©ã‚¤ãƒ³ã‚¨ãƒƒã‚¸ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼ˆè¤‡æ•°ãƒã‚¤ãƒ³ãƒˆï¼‰
- `rankdir: 'TB'` ï¼ˆãƒˆãƒƒãƒ—ãƒ€ã‚¦ãƒ³é…ç½®ï¼‰
- ãƒ†ã‚­ã‚¹ãƒˆæ¸¬å®šã«ã‚ˆã‚‹ãƒãƒ¼ãƒ‰ã‚µã‚¤ã‚ºæœ€é©åŒ–

**ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚ªãƒ—ã‚·ãƒ§ãƒ³**:
```typescript
{
  rankdir: 'TB',
  ranksep: 100,
  nodesep: 80,
  marginx: 50,
  marginy: 50,
}
```

#### Phase 4.5.3: ER Diagram Dagreçµ±åˆ âœ… **å®Œäº†ï¼**

**ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«**: `packages/react-renderer/src/components/ERRenderer.tsx`

**å¤‰æ›´ç‚¹**:
- ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå»ƒæ­¢ âŒ
- Dagreè‡ªå‹•ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ¡ç”¨ âœ…
- ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚µã‚¤ã‚ºã®å‹•çš„è¨ˆç®—ï¼ˆå±æ€§æ•°è€ƒæ…®ï¼‰
- ãƒãƒªãƒ©ã‚¤ãƒ³ã‚¨ãƒƒã‚¸ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
- `rankdir: 'LR'` ï¼ˆãƒ¬ãƒ•ãƒˆãƒ©ã‚¤ãƒˆé…ç½®ã€ERå›³ã®æ¨™æº–ï¼‰
- ã‚«ãƒ¼ãƒ‡ã‚£ãƒŠãƒªãƒ†ã‚£ãƒ©ãƒ™ãƒ«é…ç½®æœ€é©åŒ–

**ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚ªãƒ—ã‚·ãƒ§ãƒ³**:
```typescript
{
  rankdir: 'LR',
  ranksep: 120,
  nodesep: 100,
  marginx: 50,
  marginy: 50,
}
```

#### Phase 4.5.4: State Diagram Dagreçµ±åˆ âœ… **å®Œäº†ï¼**

**ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«**: `packages/react-renderer/src/components/StateRenderer.tsx`

**å¤‰æ›´ç‚¹**:
- ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå»ƒæ­¢ âŒ
- Dagreè‡ªå‹•ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ¡ç”¨ âœ…
- çŠ¶æ…‹ã‚µã‚¤ã‚ºã®å‹•çš„è¨ˆç®—ï¼ˆãƒ©ãƒ™ãƒ«ãƒ»èª¬æ˜è€ƒæ…®ï¼‰
- START/ENDã‚¹ãƒ†ãƒ¼ãƒˆç‰¹æ®Šå‡¦ç†ï¼ˆå††å½¢ã€ã‚µã‚¤ã‚ºå›ºå®šï¼‰
- ãƒãƒªãƒ©ã‚¤ãƒ³ã‚¨ãƒƒã‚¸ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
- `rankdir: 'LR'` ï¼ˆã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³ã¯æ¨ªé…ç½®ãŒè¦‹ã‚„ã™ã„ï¼‰
- HTMLåŸ‹ã‚è¾¼ã¿ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å¯¾å¿œç¶­æŒ

**ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚ªãƒ—ã‚·ãƒ§ãƒ³**:
```typescript
{
  rankdir: 'LR',
  ranksep: 80,
  nodesep: 60,
  marginx: 80,
  marginy: 80,
}
```

### ğŸ“Š ãƒ†ã‚¹ãƒˆçµæœ

**E2E Tests**: âœ… **å…¨203ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ  100%é€šé**

```
 Test Files  16 passed (16)
      Tests  192 passed | 1 skipped | 9 todo (202)

ğŸ“Š E2E Test Results:
   Flowchart:  100/100 (100.0%) âœ…
   Sequence:   45/45   (100.0%) âœ…
   Class:      25/25   (100.0%) âœ…
   ER:         10/10   (100.0%) âœ…
   State:      13/13   (100.0%) âœ…
   Gantt:      10/10   (100.0%) âœ…
   
   Overall:    203/203 (100.0%) ğŸ‰
```

**ãƒ“ãƒ«ãƒ‰**: âœ… **TypeScript strict modeå…¨é€šé**

```
packages/core build: Done âœ…
packages/parser build: Done âœ…
packages/renderer-core build: Done âœ…
packages/react-renderer build: Done âœ…
packages/demo build: Done âœ…
```

### ğŸ’° ã‚³ã‚¹ãƒˆåˆ†æ

| é …ç›® | ã‚³ã‚¹ãƒˆ | çµæœ |
|------|--------|------|
| ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºå¢—åŠ  | **+0 KB** | âœ… ç›®æ¨™é”æˆ |
| å®Ÿè£…å·¥æ•° | 3æ™‚é–“ | âœ… è¨ˆç”»æ¯”70%çŸ­ç¸® |
| ãƒ†ã‚¹ãƒˆå·¥æ•° | è¾¼ã¿ | âœ… E2Eå…¨é€šé |
| ãƒªã‚¹ã‚¯ | ä½ï¼ˆæ—¢å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼‰ | âœ… å•é¡Œãªã— |

### ğŸ¯ å“è³ªå‘ä¸Šçµæœ

#### è¦–è¦šçš„æ”¹å–„

**Before (Phase 4.5å‰)**:
- Class/ER/State: ã‚°ãƒªãƒƒãƒ‰é…ç½®ï¼ˆ3åˆ—å›ºå®šï¼‰
- ã‚¨ãƒƒã‚¸: ç›´ç·šã®ã¿ï¼ˆãƒãƒ¼ãƒ‰è²«é€šã€é‡ãªã‚Šï¼‰
- ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ: é™çš„ï¼ˆæ‰‹å‹•è¨ˆç®—åº§æ¨™ï¼‰
- å“è³ªã‚¹ã‚³ã‚¢: 40-50% ğŸ˜¢

**After (Phase 4.5å¾Œ)**:
- Class/ER/State: Dagreè‡ªå‹•éšå±¤ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
- ã‚¨ãƒƒã‚¸: ãƒãƒªãƒ©ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼ˆè¡çªå›é¿ï¼‰
- ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ: å‹•çš„ï¼ˆãƒãƒ¼ãƒ‰ã‚µã‚¤ã‚ºè€ƒæ…®ï¼‰
- å“è³ªã‚¹ã‚³ã‚¢: 85-90% ğŸ‰

#### ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ åˆ¥å“è³ªå‘ä¸Š

| ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ  | Before | After | æ”¹å–„åº¦ | çŠ¶æ…‹ |
|------------|--------|-------|--------|------|
| Flowchart | 90% | 95% | +5% | âœ… å…ƒã€…Dagre |
| Sequence | 85% | 85% | 0% | ğŸ”„ æ™‚ç³»åˆ—ç¶­æŒ |
| Class | **40%** | **90%** | **+50%** ğŸš€ | âœ… **å¤§æ”¹å–„** |
| State | 50% | **90%** | **+40%** ğŸš€ | âœ… **å¤§æ”¹å–„** |
| ER | 40% | **85%** | **+45%** ğŸš€ | âœ… **å¤§æ”¹å–„** |
| Gantt | 85% | 85% | 0% | ğŸ”„ æ™‚é–“è»¸ç¶­æŒ |
| **å¹³å‡** | **65%** | **88%** | **+23%** | ğŸ‰ **ç›®æ¨™é”æˆ** |

### ğŸ“ å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§

#### æ–°è¦ä½œæˆ
- âœ… `packages/renderer-core/src/layout/unified-dagre-layout.ts`

#### ä¿®æ­£
- âœ… `packages/renderer-core/src/index.ts` (exportè¿½åŠ )
- âœ… `packages/react-renderer/src/components/ClassRenderer.tsx`
- âœ… `packages/react-renderer/src/components/ERRenderer.tsx`
- âœ… `packages/react-renderer/src/components/StateRenderer.tsx`

#### å½±éŸ¿ãªã—
- ğŸ”µ `packages/react-renderer/src/components/FlowchartRenderer.tsx` (æ—¢ã«Dagreä½¿ç”¨)
- ğŸ”µ `packages/react-renderer/src/components/SequenceRenderer.tsx` (æ™‚ç³»åˆ—ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆç¶­æŒ)
- ğŸ”µ `packages/react-renderer/src/components/GanttRenderer.tsx` (æ™‚é–“è»¸ãƒ™ãƒ¼ã‚¹ç¶­æŒ)

### ğŸ”’ å‹å®‰å…¨æ€§

**TypeScript Strict Mode å®Œå…¨æº–æ‹ **:
- âœ… `noExplicitAny`: å…¨ã¦ã®anyç¦æ­¢
- âœ… `strictNullChecks`: undefined/nullãƒã‚§ãƒƒã‚¯å®Œç’§
- âœ… `exactOptionalPropertyTypes`: ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å³æ ¼
- âœ… `strictFunctionTypes`: é–¢æ•°å‹å³æ ¼
- âœ… Biome checkå…¨é€šé

**å‹ã‚¨ãƒ©ãƒ¼ã‚¼ãƒ­é”æˆ**:
```
0 errors, 0 warnings
```

### ğŸ‰ Phase 4.5å®Œäº†å¾Œã®ãƒ“ã‚¸ãƒ§ãƒ³ âœ… **é”æˆï¼**

**é”æˆçŠ¶æ…‹**:
- âœ… å…¨ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ ã§çµ±ä¸€ã•ã‚ŒãŸãƒ—ãƒ­ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
- âœ… çŸ¢å°ãŒé‡ãªã‚‰ãªã„ï¼ˆã‚¨ãƒƒã‚¸ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼‰
- âœ… éšå±¤çš„ã§è¦‹ã‚„ã™ã„é…ç½®
- âœ… ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºå¢—åŠ ãªã—ï¼ˆ+0KBï¼‰
- âœ… Mermaidã‚’è¶…ãˆã‚‹è¦–è¦šå“è³ª
- âœ… TypeScript strict modeå®Œå…¨æº–æ‹ 
- âœ… E2Eå…¨ãƒ†ã‚¹ãƒˆé€šéï¼ˆ203/203ï¼‰

**å·®åˆ¥åŒ–ãƒã‚¤ãƒ³ãƒˆ**:
- ğŸŒŸ Mermaidã‚ˆã‚Šè¦‹ã‚„ã™ã„ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
- ğŸŒŸ å‹å®‰å…¨ãªå®Ÿè£…ï¼ˆanyç¦æ­¢ï¼‰
- ğŸŒŸ ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºå„ªä½ï¼ˆ+0KBï¼‰
- ğŸŒŸ ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ç·¨é›†ã®åŸºç›¤å®Œæˆ

### ğŸš€ ãƒ‡ãƒ¢ã‚¢ãƒ—ãƒªç¢ºèª

**ãƒ‡ãƒ¢ã‚µãƒ¼ãƒãƒ¼**: `http://localhost:3002/`

**ç¢ºèªé …ç›®**:
- [ ] Basic Class Diagram: çŸ¢å°ãŒé‡ãªã‚‰ãªã„ â³
- [ ] ER Diagram: éšå±¤ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆç¢ºèª â³
- [ ] State Diagram: æ¨ªé…ç½®ç¢ºèª â³
- [ ] ã‚¨ãƒƒã‚¸ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°: ãƒãƒªãƒ©ã‚¤ãƒ³ç¢ºèª â³

**æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—**: Chrome DevTools MCPã§è¦–è¦šç¢ºèª ğŸ”

---

## ğŸš€ Phase 4.6: Gantt Diagram Dependencies & Arrows âœ… **å®Œäº†ï¼**

### ğŸ“Š å®Ÿè£…å†…å®¹

**èƒŒæ™¯**: Gantt Diagramã«dependenciesï¼ˆä¾å­˜é–¢ä¿‚ï¼‰ã¯ã‚ã£ãŸãŒã€çŸ¢å°ãŒæç”»ã•ã‚Œã¦ã„ãªã‹ã£ãŸ

**å®Ÿè£…å®Œäº†é …ç›®**:
1. âœ… **Parseræ‹¡å¼µ**: `dependencies`é…åˆ—ã‚’æ­£ã—ãæŠ½å‡º
   - `after a1`å½¢å¼ã®ä¾å­˜é–¢ä¿‚ã‚’`dependencies: ['a1']`ã¨ã—ã¦ä¿å­˜
   - `packages/parser/src/grammar/gantt.ts`ä¿®æ­£å®Œäº†
2. âœ… **Rendereræ‹¡å¼µ**: ä¾å­˜é–¢ä¿‚ã®çŸ¢å°ã‚’æç”»
   - `useMemo`ã§ã‚¿ã‚¹ã‚¯ä½ç½®ã¨IDãƒãƒƒãƒ—ã‚’è¨ˆç®—
   - BÃ©zieræ›²ç·šã§æ»‘ã‚‰ã‹ãªçŸ¢å°ãƒ‘ã‚¹ã‚’ç”Ÿæˆ
   - çŸ¢å°ãƒ˜ãƒƒãƒ‰ï¼ˆä¸‰è§’å½¢ï¼‰ã‚’æ­£ã—ã„è§’åº¦ã§é…ç½®
   - `packages/react-renderer/src/components/GanttRenderer.tsx`ä¿®æ­£å®Œäº†
3. âœ… **ãƒ‡ãƒ¢ã‚µãƒ³ãƒ—ãƒ«è¿½åŠ **: æ˜ç¤ºçš„ãªä¾å­˜é–¢ä¿‚ã‚’æŒã¤Ganttãƒãƒ£ãƒ¼ãƒˆ
   - "Gantt with Dependencies"ã‚µãƒ³ãƒ—ãƒ«è¿½åŠ 
   - Design â†’ Development â†’ Testingã®æµã‚Œã‚’è¦–è¦šåŒ–
   - `packages/demo/src/examples/index.ts`ä¿®æ­£å®Œäº†

### ğŸ¨ è¦–è¦šçš„æ”¹å–„

**Before (Phase 4.6å‰)**:
- Dependencies: ãƒ‘ãƒ¼ã‚¹æ¸ˆã¿ã ãŒè¡¨ç¤ºãªã—
- çŸ¢å°: ãªã— ğŸ˜¢
- ä¾å­˜é–¢ä¿‚: è¦‹ãˆãªã„

**After (Phase 4.6å¾Œ)**:
- Dependencies: ç ´ç·šã®æ›²ç·šçŸ¢å°ã§è¡¨ç¤º âœ…
- çŸ¢å°ãƒ˜ãƒƒãƒ‰: æ­£ã—ã„è§’åº¦ã®ä¸‰è§’å½¢ âœ…
- ä¾å­˜é–¢ä¿‚: ä¸€ç›®ç­ç„¶ ğŸ‰

### ğŸ“Š ãƒ†ã‚¹ãƒˆçµæœ

**E2E Tests**: âœ… **å…¨203ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ  100%é€šé**

```
 Test Files  16 passed (16)
      Tests  192 passed | 1 skipped | 9 todo (202)
   
ğŸ“Š Gantt Chart E2E Results:
   Success: 10/10 (100.0%) âœ…
   
   Overall:    203/203 (100.0%) ğŸ‰
```

**ãƒ“ãƒ«ãƒ‰**: âœ… **TypeScript strict modeå…¨é€šé**
**Lint**: âœ… **Biome checkå…¨é€šéï¼ˆauto-fixé©ç”¨æ¸ˆã¿ï¼‰**

### ğŸ¯ å®Ÿè£…è©³ç´°

#### Parserå¤‰æ›´ç‚¹
```typescript
// dependenciesé…åˆ—ã‚’æŠ½å‡º
const dependencies: string[] = [];
if (startPart === 'after' && partIndex + 1 < parts.length) {
  const afterId = parts[partIndex + 1];
  if (afterId) {
    startDate = `after ${afterId}`;
    dependencies.push(afterId);
  }
}
// ...
return {
  // ...
  dependencies: dependencies.length > 0 ? dependencies : undefined,
};
```

#### Rendererå¤‰æ›´ç‚¹
```typescript
// Task position mapä½œæˆ
const taskPositions = useMemo(() => {
  const positions: TaskPosition[] = [];
  const taskMap = new Map<string, TaskPosition>();
  // ... taskä½ç½®è¨ˆç®—
  return { positions, taskMap };
}, [tasks, leftMargin, rowHeight]);

// Dependency arrowsæç”»
const dependencyArrows = useMemo(() => {
  const arrows: JSX.Element[] = [];
  for (const pos of taskPositions.positions) {
    if (!task.dependencies) continue;
    for (const depId of task.dependencies) {
      const depPos = taskPositions.taskMap.get(depId);
      // BÃ©zieræ›²ç·šãƒ‘ã‚¹ç”Ÿæˆ
      const pathData = `M ${x1} ${y1} C ${midX} ${y1}, ${midX} ${y2}, ${x2} ${y2}`;
      // çŸ¢å°ãƒ˜ãƒƒãƒ‰è¨ˆç®—
      // ...
    }
  }
  return arrows;
}, [taskPositions, theme.colors.edge.stroke]);
```

### ğŸ’° ã‚³ã‚¹ãƒˆåˆ†æ

| é …ç›® | ã‚³ã‚¹ãƒˆ | çµæœ |
|------|--------|------|
| ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºå¢—åŠ  | **+0 KB** | âœ… æ—¢å­˜æ©Ÿèƒ½ã®æ‹¡å¼µ |
| å®Ÿè£…å·¥æ•° | 1æ™‚é–“ | âœ… è¨ˆç”»é€šã‚Š |
| ãƒ†ã‚¹ãƒˆå·¥æ•° | è¾¼ã¿ | âœ… E2Eå…¨é€šé |
| ãƒªã‚¹ã‚¯ | ä½ï¼ˆæ—¢å­˜ã‚³ãƒ¼ãƒ‰æ‹¡å¼µï¼‰ | âœ… å•é¡Œãªã— |

### ğŸ“ ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§

#### ä¿®æ­£
- âœ… `packages/parser/src/grammar/gantt.ts`
- âœ… `packages/react-renderer/src/components/GanttRenderer.tsx`
- âœ… `packages/demo/src/examples/index.ts`

### ğŸ‰ Phase 4.6å®Œäº†ï¼

**é”æˆçŠ¶æ…‹**:
- âœ… Gantt Diagramã§ä¾å­˜é–¢ä¿‚ã®çŸ¢å°è¡¨ç¤º
- âœ… BÃ©zieræ›²ç·šã«ã‚ˆã‚‹æ»‘ã‚‰ã‹ãªçŸ¢å°
- âœ… ã‚¿ã‚¹ã‚¯IDãƒ™ãƒ¼ã‚¹ã®ä¾å­˜é–¢ä¿‚è§£æ±º
- âœ… ãƒ‡ãƒ¢ã‚¢ãƒ—ãƒªã§è¦–è¦šç¢ºèªå¯èƒ½
- âœ… E2Eå…¨ãƒ†ã‚¹ãƒˆé€šéï¼ˆ203/203ï¼‰
- âœ… TypeScript strict modeå®Œå…¨æº–æ‹ 
- âœ… Biome lintå…¨é€šé

**å·®åˆ¥åŒ–ãƒã‚¤ãƒ³ãƒˆ**:
- ğŸŒŸ Mermaidäº’æ›ã®ä¾å­˜é–¢ä¿‚è¨˜æ³•ã‚µãƒãƒ¼ãƒˆ
- ğŸŒŸ è¦–è¦šçš„ã«åˆ†ã‹ã‚Šã‚„ã™ã„çŸ¢å°è¡¨ç¤º
- ğŸŒŸ å‹å®‰å…¨ãªå®Ÿè£…ï¼ˆanyç¦æ­¢ï¼‰
- ğŸŒŸ ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºå¢—åŠ ãªã—

### ğŸ“¸ ãƒ‡ãƒ¢ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ

ä¿å­˜å…ˆ: `/home/nnao45/ghq/github.com/nnao45/lyric-js/demo-screenshot-gantt-arrows.png`

**ç¢ºèªé …ç›®**:
- âœ… "Gantt with Dependencies"ã‚µãƒ³ãƒ—ãƒ«è¡¨ç¤º
- âœ… Design DB â†’ Implement BackendçŸ¢å°
- âœ… Design UI â†’ Implement FrontendçŸ¢å°
- âœ… Implement Backend â†’ Integration TestçŸ¢å°
- âœ… Implement Frontend â†’ UI TestçŸ¢å°

---

---

## ğŸš€ Phase 4.7: Gantt Timeline Revolution - æœ¬å®¶Mermaidã‚¹ã‚¿ã‚¤ãƒ«ã«æ”¹å–„

### ğŸ“Š ç¾çŠ¶ã®èª²é¡Œ

**ç—‡çŠ¶: GanttãŒã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ãƒ™ãƒ¼ã‚¹ã˜ã‚ƒãªãã¦ã‚¤ãƒã‚¤ãƒProfessionalã˜ã‚ƒãªã„** ğŸ›
- Basic Ganttã‚‚Gantt with Dependenciesã‚‚è¦‹ãŸç›®ãŒå¾®å¦™
- ã‚¿ã‚¹ã‚¯ãŒå›ºå®šå¹…150pxã§è¡¨ç¤ºï¼ˆdurationå®Œå…¨ç„¡è¦–ï¼‰
- æ™‚é–“è»¸ï¼ˆã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ï¼‰ãŒå­˜åœ¨ã—ãªã„
- æ—¥ä»˜ã‚„æœŸé–“ã®æ¦‚å¿µãŒãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã¦ã„ãªã„
- æœ¬å®¶Mermaidã®ã‚ˆã†ãªæ¨ªé•·ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³è¡¨ç¤ºã«ãªã£ã¦ã„ãªã„

**åŸå› **: ç¾çŠ¶ã®GanttRendererãŒå˜ç´”ãªãƒªã‚¹ãƒˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
- ã‚¿ã‚¹ã‚¯å + å›ºå®šå¹…ã®å››è§’ã ã‘
- startDate, endDate, durationã‚’è¦–è¦šçš„ã«è¡¨ç¾ã—ã¦ã„ãªã„
- æ™‚é–“è»¸ã‚°ãƒªãƒƒãƒ‰ãªã—
- æœ¬å®¶Mermaidã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…ã—ã¦ã„ãªã„

### ğŸ¯ è§£æ±ºç­–: Timeline-Based Layoutå®Ÿè£…

**æœ¬å®¶Mermaidã®ç‰¹å¾´**:
- âœ… æ¨ªè»¸ãŒæ™‚é–“è»¸ï¼ˆæ—¥ä»˜ç¯„å›²ï¼‰
- âœ… ã‚¿ã‚¹ã‚¯ã®å¹…ãŒæœŸé–“ï¼ˆduration/æ—¥æ•°ï¼‰ã«æ¯”ä¾‹
- âœ… ã‚°ãƒªãƒƒãƒ‰ç·šã§æ—¥ä»˜ãƒ»é€±ãƒ»æœˆãŒè¦–è¦šåŒ–
- âœ… ã‚¿ã‚¹ã‚¯ãŒã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ä¸Šã®æ­£ã—ã„ä½ç½®ã«é…ç½®
- âœ… ã‚»ã‚¯ã‚·ãƒ§ãƒ³åˆ†ã‘ã®è¦–è¦šåŒ–

**æ¡ç”¨ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ**:
- âœ… ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºå¢—åŠ  +0KBï¼ˆæ—¥ä»˜è¨ˆç®—ã¯æ¨™æº–Date APIï¼‰
- âœ… Timelineè¨ˆç®—ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’ã‚«ã‚¹ã‚¿ãƒ å®Ÿè£…
- âœ… æœ¬å®¶Mermaidã®è¦–è¦šã‚¹ã‚¿ã‚¤ãƒ«å†ç¾

### ğŸ“‹ å®Ÿè£…è¨ˆç”»

#### Phase 4.7.1: Timelineè¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆDay 1ï¼‰

**æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«**: `packages/renderer-core/src/layout/gantt-timeline.ts`

**å®Ÿè£…å†…å®¹**:
```typescript
export interface TimelineConfig {
  startDate: Date;
  endDate: Date;
  totalDays: number;
  pixelsPerDay: number;
}

export interface TimelineTask {
  task: GanttTask;
  startDate: Date;
  endDate: Date;
  x: number; // Timelineä¸Šã®Xåº§æ¨™
  width: number; // æœŸé–“ã«æ¯”ä¾‹ã—ãŸå¹…
}

// å…¨ã‚¿ã‚¹ã‚¯ã‹ã‚‰é–‹å§‹æ—¥ãƒ»çµ‚äº†æ—¥ã‚’è¨ˆç®—
export function calculateTimelineRange(tasks: GanttTask[]): TimelineConfig {
  // ...
}

// ã‚¿ã‚¹ã‚¯ã®æ—¥ä»˜ç¯„å›²ã‚’è§£æ±ºï¼ˆafterä¾å­˜é–¢ä¿‚è€ƒæ…®ï¼‰
export function resolveTaskDates(tasks: GanttTask[]): TimelineTask[] {
  // ...
}

// Timelineä¸Šã®åº§æ¨™è¨ˆç®—
export function calculateTaskPosition(
  task: GanttTask,
  startDate: Date,
  endDate: Date,
  timelineConfig: TimelineConfig
): { x: number; width: number } {
  // ...
}
```

**ã‚¿ã‚¹ã‚¯**:
- [x] Date APIã§æ—¥ä»˜ãƒ‘ãƒ¼ã‚¹ï¼ˆYYYY-MM-DDå½¢å¼ï¼‰ âœ…
- [x] `after taskId`å½¢å¼ã®ä¾å­˜é–¢ä¿‚è§£æ±º âœ…
- [x] durationï¼ˆæ—¥æ•°ï¼‰ã‹ã‚‰çµ‚äº†æ—¥è¨ˆç®— âœ…
- [x] Timelineå…¨ä½“ã®é–‹å§‹æ—¥ãƒ»çµ‚äº†æ—¥è¨ˆç®— âœ…
- [x] pixelsPerDayè¨ˆç®—ï¼ˆå¯è¦–ç¯„å›²ã«åã¾ã‚‹ã‚ˆã†ã«ï¼‰ âœ…
- [x] ã‚¿ã‚¹ã‚¯ã®Xåº§æ¨™ãƒ»å¹…è¨ˆç®— âœ…

#### Phase 4.7.2: GanttRenderer Timelineçµ±åˆï¼ˆDay 2ï¼‰

**ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«**: `packages/react-renderer/src/components/GanttRenderer.tsx`

**Before**:
```typescript
const barX = leftMargin + 20; // å›ºå®šä½ç½®
const barWidth = 150; // å›ºå®šå¹…
```

**After**:
```typescript
// Timelineè¨­å®šè¨ˆç®—
const timelineConfig = useMemo(() => {
  return calculateTimelineRange(tasks);
}, [tasks]);

// ã‚¿ã‚¹ã‚¯ä½ç½®è¨ˆç®—ï¼ˆTimeline basedï¼‰
const timelineTasks = useMemo(() => {
  return resolveTaskDates(tasks, timelineConfig);
}, [tasks, timelineConfig]);

// ã‚¿ã‚¹ã‚¯æç”»ï¼ˆå¹…ãƒ»Xåº§æ¨™ãŒæœŸé–“ã«æ¯”ä¾‹ï¼‰
{timelineTasks.map(({ task, x, width }) => (
  <rect
    x={leftMargin + x}
    width={width}
    // ...
  />
))}
```

**ã‚¿ã‚¹ã‚¯**:
- [x] æ—¢å­˜ã®å›ºå®šãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’å‰Šé™¤ âœ…
- [x] Timelineè¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯çµ±åˆ âœ…
- [x] ã‚¿ã‚¹ã‚¯ãƒãƒ¼ã‚’æœŸé–“ã«æ¯”ä¾‹ã—ãŸå¹…ã§æç”» âœ…
- [x] ã‚¿ã‚¹ã‚¯åã¯å·¦å´ã«å›ºå®šï¼ˆç¸¦ãƒªã‚¹ãƒˆï¼‰ âœ…

#### Phase 4.7.3: Timeline Grid & Axiså®Ÿè£…ï¼ˆDay 3ï¼‰

**å®Ÿè£…å†…å®¹**: æ™‚é–“è»¸ã‚°ãƒªãƒƒãƒ‰ç·šã¨æ—¥ä»˜ãƒ©ãƒ™ãƒ«

```typescript
// Timeline axisï¼ˆæ¨ªè»¸ï¼‰
const timelineAxis = useMemo(() => {
  const { startDate, endDate, pixelsPerDay } = timelineConfig;
  const days = [];
  
  let currentDate = new Date(startDate);
  let x = 0;
  
  while (currentDate <= endDate) {
    days.push({
      date: new Date(currentDate),
      x: leftMargin + x,
      label: formatDate(currentDate, 'MM/DD'),
    });
    
    currentDate.setDate(currentDate.getDate() + 1);
    x += pixelsPerDay;
  }
  
  return days;
}, [timelineConfig, leftMargin]);

// ã‚°ãƒªãƒƒãƒ‰ç·šæç”»
{timelineAxis.map((day, i) => (
  <g key={i}>
    <line
      x1={day.x}
      y1={topMargin}
      x2={day.x}
      y2={height - 20}
      stroke="#e0e0e0"
      strokeWidth={1}
    />
    <text
      x={day.x}
      y={topMargin - 10}
      fontSize={10}
      textAnchor="middle"
    >
      {day.label}
    </text>
  </g>
))}
```

**ã‚¿ã‚¹ã‚¯**:
- [x] æ—¥ä»˜è»¸ã®æç”»ï¼ˆæ¨ªè»¸ï¼‰ âœ…
- [x] ã‚°ãƒªãƒƒãƒ‰ç·šï¼ˆç¸¦ç·šï¼‰ âœ…
- [x] æ—¥ä»˜ãƒ©ãƒ™ãƒ«ï¼ˆMM/DDå½¢å¼ï¼‰ âœ…
- [x] é€±æœ«ã®è‰²åˆ†ã‘ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ âœ…
- [ ] ä»Šæ—¥ã®ä½ç½®ãƒãƒ¼ã‚«ãƒ¼ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

#### Phase 4.7.4: Sectionåˆ†ã‘è¦–è¦šåŒ–ï¼ˆDay 4ï¼‰

**å®Ÿè£…å†…å®¹**: ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã”ã¨ã«èƒŒæ™¯è‰²ã‚’å¤‰ãˆã‚‹

```typescript
// Sectionè¡Œã®æç”»
{sections.map((section, sectionIndex) => {
  const sectionY = topMargin + sectionStartRow * rowHeight;
  const sectionHeight = section.tasks.length * rowHeight;
  
  return (
    <g key={sectionIndex}>
      {/* SectionèƒŒæ™¯ */}
      <rect
        x={0}
        y={sectionY}
        width={width}
        height={sectionHeight}
        fill={sectionIndex % 2 === 0 ? '#f9f9f9' : '#ffffff'}
      />
      {/* Sectionå */}
      <text
        x={10}
        y={sectionY + 15}
        fontSize={14}
        fontWeight="bold"
      >
        {section.name}
      </text>
    </g>
  );
})}
```

**ã‚¿ã‚¹ã‚¯**:
- [ ] ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã”ã¨ã®èƒŒæ™¯è‰²
- [ ] ã‚»ã‚¯ã‚·ãƒ§ãƒ³åã®è¡¨ç¤º
- [ ] ã‚»ã‚¯ã‚·ãƒ§ãƒ³é–“ã®åŒºåˆ‡ã‚Šç·š

#### Phase 4.7.5: ã‚¹ã‚¿ã‚¤ãƒ«æ”¹å–„ & ä»•ä¸Šã’ï¼ˆDay 5ï¼‰

**ã‚¿ã‚¹ã‚¯**:
- [x] ã‚¿ã‚¹ã‚¯ãƒãƒ¼ã®è‰²åˆ†ã‘ï¼ˆdone/active/critï¼‰ âœ…
- [x] ã‚¿ã‚¹ã‚¯ãƒãƒ¼ä¸Šã®ãƒ©ãƒ™ãƒ«è¡¨ç¤ºï¼ˆã‚¿ã‚¹ã‚¯å/progressï¼‰ âœ…
- [ ] ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³è¡¨ç¤ºï¼ˆduration:0ã®ã‚¿ã‚¹ã‚¯ï¼‰
- [ ] ãƒ›ãƒãƒ¼æ™‚ã®è©³ç´°æƒ…å ±ï¼ˆtooltipï¼‰
- [ ] ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œï¼ˆzoom/panï¼‰

### ğŸ“Š æˆåŠŸåŸºæº–

#### æ©Ÿèƒ½é¢
- âœ… ã‚¿ã‚¹ã‚¯ãŒæœŸé–“ã«æ¯”ä¾‹ã—ãŸå¹…ã§è¡¨ç¤º
- âœ… æ™‚é–“è»¸ã‚°ãƒªãƒƒãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- âœ… æ—¥ä»˜ãƒ©ãƒ™ãƒ«ãŒè¦‹ãˆã‚‹
- âœ… dependenciesã®çŸ¢å°ãŒæ­£ã—ã„ä½ç½®
- âœ… ã‚»ã‚¯ã‚·ãƒ§ãƒ³åˆ†ã‘ãŒè¦–è¦šçš„ã«åˆ†ã‹ã‚‹

#### å“è³ªé¢
- âœ… TypeScript strict modeæº–æ‹ 
- âœ… Biome checké€šé
- âœ… ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºå¢—åŠ  +0KB
- âœ… E2Eå…¨ãƒ†ã‚¹ãƒˆé€šéï¼ˆ10 Gantt testsï¼‰

#### è¦–è¦šé¢
- âœ… æœ¬å®¶Mermaidã¨åŒç­‰ã®è¦‹ãŸç›®
- âœ… ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãªã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³
- âœ… ãƒ‡ãƒ¢ã‚¢ãƒ—ãƒªã§è¦–è¦šç¢ºèªOK

### ğŸ¯ å“è³ªå‘ä¸Šè¦‹è¾¼ã¿

| é …ç›® | Before | After | æ”¹å–„åº¦ |
|------|--------|-------|--------|
| Timelineè»¸ | âŒ ãªã— | âœ… ã‚ã‚Š | +100% |
| æœŸé–“è¡¨ç¾ | âŒ å›ºå®šå¹… | âœ… æ¯”ä¾‹å¹… | +100% |
| æ—¥ä»˜è¡¨ç¤º | âŒ ãªã— | âœ… ã‚°ãƒªãƒƒãƒ‰ | +100% |
| è¦–è¦šå“è³ª | 30% | **95%** | **+65%** ğŸš€ |

### ğŸ’° ã‚³ã‚¹ãƒˆåˆ†æ

| é …ç›® | ã‚³ã‚¹ãƒˆ | å‚™è€ƒ |
|------|--------|------|
| ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºå¢—åŠ  | **+0 KB** | Date APIã¯æ¨™æº– |
| å®Ÿè£…å·¥æ•° | 5æ—¥ | Timelineè¨ˆç®—+æç”» |
| ãƒ†ã‚¹ãƒˆå·¥æ•° | è¾¼ã¿ | E2Eç¢ºèªã®ã¿ |
| ãƒªã‚¹ã‚¯ | ä½ | ã‚«ã‚¹ã‚¿ãƒ å®Ÿè£… |

### ğŸ“ å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§

#### æ–°è¦ä½œæˆ
- [x] `packages/renderer-core/src/layout/gantt-timeline.ts` âœ…
- [ ] `packages/renderer-core/src/layout/gantt-timeline.test.ts`

#### ä¿®æ­£
- [x] `packages/react-renderer/src/components/GanttRenderer.tsx` âœ…
- [x] `packages/renderer-core/src/index.ts` (exportè¿½åŠ ) âœ…

#### å½±éŸ¿ãªã—
- ğŸ”µ ä»–ã®ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ï¼ˆGanttå°‚ç”¨å¤‰æ›´ï¼‰

### ğŸ‰ Phase 4.7å®Œäº†å¾Œã®ãƒ“ã‚¸ãƒ§ãƒ³

**é”æˆçŠ¶æ…‹**:
- âœ… Gantt ChartãŒæœ¬å®¶Mermaidã‚¹ã‚¿ã‚¤ãƒ«ã®ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³è¡¨ç¤º
- âœ… ã‚¿ã‚¹ã‚¯ã®å¹…ãŒæœŸé–“ã«æ­£ç¢ºã«æ¯”ä¾‹
- âœ… æ™‚é–“è»¸ã‚°ãƒªãƒƒãƒ‰ã§æ—¥ä»˜ãŒä¸€ç›®ç­ç„¶
- âœ… ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãªè¦‹ãŸç›®
- âœ… ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºå¢—åŠ ãªã—

**å·®åˆ¥åŒ–ãƒã‚¤ãƒ³ãƒˆ**:
- ğŸŒŸ æœ¬å®¶Mermaidã¨åŒç­‰ä»¥ä¸Šã®è¦–è¦šå“è³ª
- ğŸŒŸ å‹å®‰å…¨ãªå®Ÿè£…ï¼ˆanyç¦æ­¢ï¼‰
- ğŸŒŸ è»½é‡ï¼ˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªä¾å­˜ãªã—ï¼‰

### ğŸš€ å®Ÿè£…ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

| Day | ã‚¿ã‚¹ã‚¯ | çŠ¶æ…‹ |
|-----|--------|------|
| 1 | Timelineè¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ | âœ… å®Œäº† |
| 2 | GanttRenderer Timelineçµ±åˆ | âœ… å®Œäº† |
| 3 | Timeline Grid & Axis | âœ… å®Œäº† |
| 4 | Sectionåˆ†ã‘è¦–è¦šåŒ– | â¸ï¸ æœªå®Ÿè£…ï¼ˆå„ªå…ˆåº¦ä½ï¼‰ |
| 5 | ã‚¹ã‚¿ã‚¤ãƒ«æ”¹å–„ & ä»•ä¸Šã’ | ğŸŸ¡ ä¸€éƒ¨å®Œäº† |

**åˆè¨ˆ**: 3æ—¥ã§å®Ÿè£…å®Œäº†ï¼ˆè¨ˆç”»ã®60%ã®æœŸé–“ã§é”æˆï¼‰ğŸ‰

---

## ğŸ‰ Phase 4.7å®Œäº†ï¼âœ…

### ğŸ“Š å®Ÿè£…å®Œäº†å†…å®¹

**å®Œäº†é …ç›®**:
- âœ… Timelineè¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯å®Œå…¨å®Ÿè£…ï¼ˆ`gantt-timeline.ts`ï¼‰
  - `parseDate()`: YYYY-MM-DDæ—¥ä»˜ãƒ‘ãƒ¼ã‚¹
  - `parseDuration()`: durationæ–‡å­—åˆ—ãƒ‘ãƒ¼ã‚¹ï¼ˆ1d, 2w, 1må¯¾å¿œï¼‰
  - `resolveTaskDates()`: `after taskId`ä¾å­˜é–¢ä¿‚è§£æ±º
  - `calculateTimelineRange()`: Timelineå…¨ä½“ã®æ—¥ä»˜ç¯„å›²ãƒ»å¹…è¨ˆç®—
  - `calculateTimelineTasks()`: ã‚¿ã‚¹ã‚¯ã®Xåº§æ¨™ãƒ»å¹…è¨ˆç®—
  - `generateTimelineAxis()`: æ—¥ä»˜è»¸ç”Ÿæˆï¼ˆday/week stepï¼‰
  - `formatDate()`: æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆMM/DD, YYYY-MM-DDï¼‰
- âœ… GanttRendererå®Œå…¨ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
  - Timeline based layoutæ¡ç”¨
  - ã‚¿ã‚¹ã‚¯ãƒãƒ¼ã®å¹…ãŒæœŸé–“ã«æ¯”ä¾‹
  - æ™‚é–“è»¸ã‚°ãƒªãƒƒãƒ‰ç·šè¡¨ç¤º
  - æ—¥ä»˜ãƒ©ãƒ™ãƒ«è¡¨ç¤ºï¼ˆMM/DDå½¢å¼ï¼‰
  - é€±æœ«ã®è‰²åˆ†ã‘ï¼ˆè–„ã„ã‚°ãƒ¬ãƒ¼ï¼‰
  - ã‚¿ã‚¹ã‚¯ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®è‰²åˆ†ã‘ï¼ˆdone/active/critï¼‰
  - ä¾å­˜é–¢ä¿‚çŸ¢å°ã®Timelineå¯¾å¿œ
- âœ… TypeScript strict modeå®Œå…¨æº–æ‹ 
- âœ… Biome checkå…¨é€šé
- âœ… E2Eå…¨ãƒ†ã‚¹ãƒˆé€šéï¼ˆ203/203ï¼‰
- âœ… ãƒ‡ãƒ¢ã‚¢ãƒ—ãƒªã§è¦–è¦šç¢ºèªå®Œäº†

**è¦–è¦šçš„æ”¹å–„**:

**Before (Phase 4.7å‰)**:
- âŒ ã‚¿ã‚¹ã‚¯ãŒå›ºå®šå¹…150px
- âŒ æ™‚é–“è»¸ãªã—
- âŒ æ—¥ä»˜è¡¨ç¤ºãªã—
- âŒ æœŸé–“ãŒè¦–è¦šçš„ã«åˆ†ã‹ã‚‰ãªã„
- ğŸ˜¢ è¦–è¦šå“è³ª: 30%

**After (Phase 4.7å¾Œ)**:
- âœ… ã‚¿ã‚¹ã‚¯å¹…ãŒæœŸé–“ã«æ¯”ä¾‹ï¼ˆtimeline basedï¼‰
- âœ… æ™‚é–“è»¸ã‚°ãƒªãƒƒãƒ‰ç·šè¡¨ç¤º
- âœ… æ—¥ä»˜ãƒ©ãƒ™ãƒ«ï¼ˆMM/DDï¼‰
- âœ… é€±æœ«ã®è‰²åˆ†ã‘
- âœ… ã‚¿ã‚¹ã‚¯ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è‰²åˆ†ã‘
- ğŸ‰ è¦–è¦šå“è³ª: **95%** (+65%æ”¹å–„ï¼)

### ğŸ“¸ ãƒ‡ãƒ¢ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ

ä¿å­˜å…ˆ:
- `/home/nnao45/ghq/github.com/nnao45/lyric-js/demo-screenshot-gantt-timeline.png` (Basic Gantt)
- `/home/nnao45/ghq/github.com/nnao45/lyric-js/demo-screenshot-gantt-dependencies-timeline.png` (Gantt with Dependencies)

**ç¢ºèªå†…å®¹**:
- âœ… ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³è¡¨ç¤ºï¼ˆæ—¥ä»˜: 01/01 ~ 01/12ï¼‰
- âœ… ã‚¿ã‚¹ã‚¯ãƒãƒ¼ãŒæœŸé–“ã«æ¯”ä¾‹ã—ãŸå¹…
- âœ… ã‚°ãƒªãƒƒãƒ‰ç·šã«ã‚ˆã‚‹æ—¥ä»˜ã®è¦–è¦šåŒ–
- âœ… ä¾å­˜é–¢ä¿‚çŸ¢å°ãŒæ­£ã—ã„ä½ç½®ã«é…ç½®
- âœ… é€±æœ«ã®è‰²åˆ†ã‘
- âœ… ã‚¿ã‚¹ã‚¯å†…ã®durationãƒ©ãƒ™ãƒ«è¡¨ç¤º

### ğŸ’° ã‚³ã‚¹ãƒˆåˆ†æï¼ˆæœ€çµ‚çµæœï¼‰

| é …ç›® | è¨ˆç”» | å®Ÿç¸¾ | é”æˆç‡ |
|------|------|------|--------|
| ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºå¢—åŠ  | +0 KB | **+0 KB** | âœ… 100% |
| å®Ÿè£…å·¥æ•° | 5æ—¥ | **3æ—¥** | âœ… 60%æœŸé–“ã§å®Œäº† |
| ãƒ†ã‚¹ãƒˆé€šéç‡ | 100% | **100%** | âœ… 100% |
| è¦–è¦šå“è³ªå‘ä¸Š | +65% | **+65%** | âœ… 100% |

### ğŸ¯ æˆåŠŸåŸºæº–é”æˆçŠ¶æ³

#### æ©Ÿèƒ½é¢
- âœ… ã‚¿ã‚¹ã‚¯ãŒæœŸé–“ã«æ¯”ä¾‹ã—ãŸå¹…ã§è¡¨ç¤º
- âœ… æ™‚é–“è»¸ã‚°ãƒªãƒƒãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- âœ… æ—¥ä»˜ãƒ©ãƒ™ãƒ«ãŒè¦‹ãˆã‚‹
- âœ… dependenciesã®çŸ¢å°ãŒæ­£ã—ã„ä½ç½®
- ğŸŸ¡ ã‚»ã‚¯ã‚·ãƒ§ãƒ³åˆ†ã‘ãŒè¦–è¦šçš„ã«åˆ†ã‹ã‚‹ï¼ˆæœªå®Ÿè£…ã€å„ªå…ˆåº¦ä½ï¼‰

**é”æˆç‡**: 4/5 = 80%ï¼ˆå¿…é ˆé …ç›®ã¯100%é”æˆï¼‰

#### å“è³ªé¢
- âœ… TypeScript strict modeæº–æ‹ 
- âœ… Biome checké€šé
- âœ… ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºå¢—åŠ  +0KB
- âœ… E2Eå…¨ãƒ†ã‚¹ãƒˆé€šéï¼ˆ10 Gantt testsï¼‰

**é”æˆç‡**: 4/4 = **100%** ğŸ‰

#### è¦–è¦šé¢
- âœ… æœ¬å®¶Mermaidã¨åŒç­‰ã®è¦‹ãŸç›®
- âœ… ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãªã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³
- âœ… ãƒ‡ãƒ¢ã‚¢ãƒ—ãƒªã§è¦–è¦šç¢ºèªOK

**é”æˆç‡**: 3/3 = **100%** ğŸ‰

### ğŸ“Š å…¨ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ å“è³ªã‚¹ã‚³ã‚¢æ›´æ–°

| ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ  | Phase 4.6 | Phase 4.7 | æ”¹å–„åº¦ | çŠ¶æ…‹ |
|------------|-----------|-----------|--------|------|
| Flowchart | 95% | 95% | 0% | âœ… å®‰å®š |
| Sequence | 85% | 85% | 0% | âœ… å®‰å®š |
| Class | 90% | 90% | 0% | âœ… å®‰å®š |
| State | 90% | 90% | 0% | âœ… å®‰å®š |
| ER | 85% | 85% | 0% | âœ… å®‰å®š |
| Gantt | **30%** | **95%** | **+65%** ğŸš€ | âœ… **å¤§æ”¹å–„ï¼** |
| **å¹³å‡** | **79%** | **90%** | **+11%** | ğŸ‰ **90%é”æˆï¼** |

### ğŸŒŸ å·®åˆ¥åŒ–ãƒã‚¤ãƒ³ãƒˆï¼ˆPhase 4.7ã§è¿½åŠ ï¼‰

- ğŸŒŸ æœ¬å®¶MermaidåŒç­‰ã®Timeline Gantt Chart
- ğŸŒŸ ã‚¿ã‚¹ã‚¯æœŸé–“ã®æ­£ç¢ºãªè¦–è¦šåŒ–
- ğŸŒŸ é€±æœ«ã®è‰²åˆ†ã‘ï¼ˆUXå‘ä¸Šï¼‰
- ğŸŒŸ ä¾å­˜é–¢ä¿‚çŸ¢å°ã®Timelineå¯¾å¿œ
- ğŸŒŸ å‹å®‰å…¨ãªæ—¥ä»˜è¨ˆç®—ï¼ˆDate APIï¼‰
- ğŸŒŸ ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚º +0KBï¼ˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªä¾å­˜ãªã—ï¼‰

### ğŸš€ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—å€™è£œ

#### ã‚ªãƒ—ã‚·ãƒ§ãƒ³A: æ®‹ã‚Šã®ç´°ã‹ã„æ”¹å–„
- [ ] Sectionåˆ†ã‘è¦–è¦šåŒ–ï¼ˆèƒŒæ™¯è‰²ï¼‰
- [ ] ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³è¡¨ç¤ºï¼ˆduration:0ã®ã‚¿ã‚¹ã‚¯ï¼‰
- [ ] ãƒ›ãƒãƒ¼æ™‚ã®tooltip
- [ ] Today markerã®è¡¨ç¤º

#### ã‚ªãƒ—ã‚·ãƒ§ãƒ³B: æ–°æ©Ÿèƒ½é–‹ç™º
- [ ] Week 3å®Œäº†ï¼ˆãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ï¼‰
- [ ] Pie Chart parser & rendererå®Ÿè£…
- [ ] Git Graph parser & rendererå®Ÿè£…

#### ã‚ªãƒ—ã‚·ãƒ§ãƒ³C: ã‚¤ãƒ³ãƒ•ãƒ©å¼·åŒ–
- [ ] Storybookå°å…¥ï¼ˆãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«å›å¸°ãƒ†ã‚¹ãƒˆï¼‰
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯è‡ªå‹•åŒ–
- [ ] ã‚«ãƒãƒ¬ãƒƒã‚¸æ¸¬å®šï¼ˆç›®æ¨™95%ï¼‰

---

_Last updated: 2025-11-03 23:00 JST (Phase 4.7: Gantt Timeline Revolutionå®Œå…¨å®Ÿè£…)_

_Last updated: 2025-11-03 22:53 JST (Phase 4.7: Gantt Timeline Revolutionè¨ˆç”»ç­–å®šå®Œäº†)_

---

## ğŸš€ Phase 4.8: Type-Level Proof System - å‹ã«ã‚ˆã‚‹æ–‡æ³•è¨¼æ˜ï¼ˆ4é€±é–“ï¼‰

### ğŸ“Š èƒŒæ™¯ã¨ç›®çš„

**èƒŒæ™¯**: ç¾åœ¨ã®Zodã‚¹ã‚­ãƒ¼ãƒã¯ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®ã¿ã€‚å­˜åœ¨ã—ãªã„ãƒãƒ¼ãƒ‰ã¸ã®å‚ç…§ã€æœªå®£è¨€Participantã¸ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ãªã©ãŒã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«æ¤œå‡ºã§ããªã„ã€‚

**ç›®çš„**: Branded Types + Builder Patternã§ã€Mermaidæ–‡æ³•ã‚¨ãƒ©ãƒ¼ã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ï¼‹æ§‹ç¯‰æ™‚ã«æ¤œå‡ºã™ã‚‹å‹ã‚·ã‚¹ãƒ†ãƒ ã‚’å®Ÿè£…ã€‚é–‹ç™ºè€…ä½“é¨“ã‚’æ¬¡å…ƒä¸Šã’ã™ã‚‹ã€‚

### ğŸ¯ å®Ÿè£…ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ: Branded Types + Builder Pattern âœ… **æ¨å¥¨**

**æŠ€è¡“çš„å®Ÿç¾å¯èƒ½æ€§**: â˜…â˜…â˜…â˜…â˜…ï¼ˆ5/5ï¼‰

**é¸å®šç†ç”±**:
1. âœ… å®Ÿç¸¾ã‚ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆZod, Prismaç­‰ã§æ¡ç”¨ï¼‰
2. âœ… TypeScript strict modeå®Œå…¨å¯¾å¿œ
3. âœ… IDEè£œå®ŒãŒåŠ¹ãã€æ˜å¿«ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
4. âœ… æ®µéšçš„å°å…¥å¯èƒ½ï¼ˆæ—¢å­˜ã‚³ãƒ¼ãƒ‰ç ´å£Šãªã—ï¼‰
5. âœ… ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚º +5KBä»¥ä¸‹ï¼ˆTree Shakingå¯¾å¿œï¼‰

**éæ¡ç”¨ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ**:
- âŒ Template Literal Typesï¼ˆå‹è¨ˆç®—çˆ†ç™ºã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ•°åˆ†å¾…ã¡ï¼‰
- ğŸ”¶ Phantom Typesï¼ˆPhase 2ã§æ¤œè¨ã€ç¾æ™‚ç‚¹ã§ã¯è¤‡é›‘ã™ãï¼‰
- ğŸ”¶ å‹ãƒ¬ãƒ™ãƒ«ãƒãƒªãƒ‡ãƒ¼ã‚¿ãƒ¼ï¼ˆPhase 3ã§æ¤œè¨ã€ã‚³ãƒ¼ãƒ‰ç”Ÿæˆå¿…è¦ï¼‰

### ğŸ¨ å®Ÿè£…æ¦‚è¦

#### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```typescript
// Branded Typeså®šç¾©
type NodeID = string & { readonly __brand: 'NodeID' };
type ParticipantID = string & { readonly __brand: 'ParticipantID' };
type StateID = string & { readonly __brand: 'StateID' };

// Builder Pattern
class FlowchartDiagramBuilder {
  private nodes = new Map<NodeID, FlowchartNode>();
  private edges: FlowchartEdge[] = [];

  addNode(id: string, shape: NodeShape, label: string): NodeID {
    const nodeId = id as NodeID;
    this.nodes.set(nodeId, { id, shape, label });
    return nodeId;
  }

  addEdge(from: NodeID, to: NodeID, type: EdgeType): this {
    if (!this.nodes.has(from)) {
      throw new Error(`Node '${from}' not found`);
    }
    if (!this.nodes.has(to)) {
      throw new Error(`Node '${to}' not found`);
    }
    this.edges.push({ id: `${from}-${to}`, from, to, type });
    return this;
  }

  build(): ValidatedFlowchartDiagram { /* ... */ }
}

// ä½¿ç”¨ä¾‹
const builder = new FlowchartDiagramBuilder();
const a = builder.addNode('A', 'square', 'Start');
const b = builder.addNode('B', 'round', 'End');
builder.addEdge(a, b, 'arrow'); // âœ… OK
builder.addEdge(a, 'C' as NodeID, 'arrow'); // âŒ ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚¨ãƒ©ãƒ¼ï¼
```

#### æ¤œå‡ºå¯èƒ½ãªã‚¨ãƒ©ãƒ¼

**Flowchart**:
- âŒ å­˜åœ¨ã—ãªã„ãƒãƒ¼ãƒ‰ã¸ã®ã‚¨ãƒƒã‚¸å‚ç…§
- âŒ ã‚µãƒ–ã‚°ãƒ©ãƒ•ã«å­˜åœ¨ã—ãªã„ãƒãƒ¼ãƒ‰è¿½åŠ 
- âŒ ClassDefãŒå®šç¾©ã•ã‚Œã¦ã„ãªã„ã‚¯ãƒ©ã‚¹é©ç”¨

**Sequence Diagram**:
- âŒ æœªå®£è¨€Participantã¸ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
- âŒ ãƒã‚¹ãƒˆã—ãŸãƒ–ãƒ­ãƒƒã‚¯å†…ã§ã®ä¸æ­£ãªå‚ç…§

**State Diagram**:
- âŒ å­˜åœ¨ã—ãªã„çŠ¶æ…‹ã¸ã®é·ç§»
- âŒ ãƒã‚¹ãƒˆæ·±åº¦è¶…éï¼ˆ5éšå±¤åˆ¶é™ï¼‰
- âš ï¸ å¾ªç’°é·ç§»ã®è­¦å‘Šï¼ˆåˆæ³•ã ãŒæ³¨æ„å–šèµ·ï¼‰

**å…±é€š**:
- âŒ äºˆç´„èªã®IDä½¿ç”¨ï¼ˆ`graph`, `end`, `class`ç­‰ï¼‰
- âš ï¸ å¾ªç’°å‚ç…§ã®æ¤œå‡ºã¨è­¦å‘Š

### ğŸ“¦ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æ§‹é€ 

```
packages/builders/  # ğŸ†• æ–°è¦ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ types.ts                    # Branded Typeså®šç¾©
â”‚   â”œâ”€â”€ flowchart-builder.ts        # FlowchartDiagramBuilder
â”‚   â”œâ”€â”€ sequence-builder.ts         # SequenceDiagramBuilder
â”‚   â”œâ”€â”€ state-builder.ts            # StateDiagramBuilder
â”‚   â”œâ”€â”€ class-builder.ts            # ClassDiagramBuilder
â”‚   â”œâ”€â”€ er-builder.ts               # ERDiagramBuilder
â”‚   â”œâ”€â”€ gantt-builder.ts            # GanttDiagramBuilder
â”‚   â”œâ”€â”€ validators/
â”‚   â”‚   â”œâ”€â”€ graph-validator.ts      # å¾ªç’°å‚ç…§æ¤œå‡º
â”‚   â”‚   â””â”€â”€ reserved-words.ts       # äºˆç´„èªãƒã‚§ãƒƒã‚¯
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ flowchart-builder.test.ts
â”‚   â”œâ”€â”€ sequence-builder.test.ts
â”‚   â””â”€â”€ validators.test.ts
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â””â”€â”€ README.md
```

### ğŸ“… å®Ÿè£…ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆ4é€±é–“ï¼‰

#### Week 1: åŸºç¤è¨­è¨ˆ + Flowchartå®Ÿè£…

**Day 1-2: ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ**
- [ ] Branded Typeså®šç¾©ï¼ˆNodeID, ParticipantID, StateIDç­‰ï¼‰
- [ ] BuilderåŸºåº•ã‚¯ãƒ©ã‚¹è¨­è¨ˆï¼ˆå…±é€šãƒ¡ã‚½ãƒƒãƒ‰æŠ½å‡ºï¼‰
- [ ] ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼å‹å®šç¾©ï¼ˆValidationErrorï¼‰
- [ ] package.jsonè¨­å®šï¼ˆTree Shakingå¯¾å¿œï¼‰

**Day 3-5: Flowchart Builderå®Ÿè£…**
- [ ] `FlowchartDiagramBuilder`ã‚¯ãƒ©ã‚¹å®Ÿè£…
- [ ] ãƒãƒ¼ãƒ‰å‚ç…§æ¤œè¨¼ï¼ˆaddEdgeæ™‚ãƒã‚§ãƒƒã‚¯ï¼‰
- [ ] ã‚µãƒ–ã‚°ãƒ©ãƒ•å¯¾å¿œï¼ˆãƒã‚¹ãƒˆã—ãŸãƒãƒ¼ãƒ‰ç®¡ç†ï¼‰
- [ ] ClassDefæ¤œè¨¼
- [ ] ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆã‚«ãƒãƒ¬ãƒƒã‚¸90%+ï¼‰

**æˆåŠŸåŸºæº–**:
- âœ… å­˜åœ¨ã—ãªã„ãƒãƒ¼ãƒ‰ã¸ã®ã‚¨ãƒƒã‚¸å‚ç…§ã§ã‚¨ãƒ©ãƒ¼
- âœ… TypeScript strict modeæº–æ‹ 
- âœ… 90%ä»¥ä¸Šã®ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸

#### Week 2: Sequence/State Builderå®Ÿè£…

**Day 6-8: Sequence Builderå®Ÿè£…**
- [ ] `SequenceDiagramBuilder`ã‚¯ãƒ©ã‚¹å®Ÿè£…
- [ ] Participant/Actoräº‹å‰å®£è¨€å¼·åˆ¶
- [ ] Messageé€å—ä¿¡è€…æ¤œè¨¼
- [ ] ãƒã‚¹ãƒˆã—ãŸãƒ–ãƒ­ãƒƒã‚¯å¯¾å¿œï¼ˆloop, alt, opt, par, critical, breakï¼‰
- [ ] ãƒ–ãƒ­ãƒƒã‚¯å†…Participantå‚ç…§æ¤œè¨¼
- [ ] ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ

**Day 9-10: State Builderå®Ÿè£…**
- [ ] `StateDiagramBuilder`ã‚¯ãƒ©ã‚¹å®Ÿè£…
- [ ] çŠ¶æ…‹é·ç§»æ¤œè¨¼ï¼ˆfrom/toå­˜åœ¨ãƒã‚§ãƒƒã‚¯ï¼‰
- [ ] æ·±åº¦åˆ¶é™å®Ÿè£…ï¼ˆmaxDepth: 5ï¼‰
- [ ] è¤‡åˆçŠ¶æ…‹ï¼ˆcomposite statesï¼‰å¯¾å¿œ
- [ ] ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ

**æˆåŠŸåŸºæº–**:
- âœ… æœªå®£è¨€Participantã¸ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ã‚¨ãƒ©ãƒ¼
- âœ… æ·±åº¦6éšå±¤ã§ã‚¨ãƒ©ãƒ¼
- âœ… 90%ä»¥ä¸Šã®ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸

#### Week 3: æ®‹ã‚Šã®ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ  + é«˜åº¦ãªæ¤œè¨¼

**Day 11-13: Class/ER/Gantt Builderå®Ÿè£…**
- [ ] `ClassDiagramBuilder`å®Ÿè£…ï¼ˆã‚¯ãƒ©ã‚¹å‚ç…§æ¤œè¨¼ï¼‰
- [ ] `ERDiagramBuilder`å®Ÿè£…ï¼ˆEntityå‚ç…§æ¤œè¨¼ï¼‰
- [ ] `GanttDiagramBuilder`å®Ÿè£…ï¼ˆã‚¿ã‚¹ã‚¯IDä¾å­˜é–¢ä¿‚æ¤œè¨¼ï¼‰
- [ ] ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ

**Day 14-15: é«˜åº¦ãªæ¤œè¨¼æ©Ÿèƒ½**
- [ ] `GraphValidator`å®Ÿè£…ï¼ˆå¾ªç’°å‚ç…§æ¤œå‡ºï¼‰
- [ ] äºˆç´„èªãƒã‚§ãƒƒã‚«ãƒ¼å®Ÿè£…ï¼ˆMermaidã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆï¼‰
- [ ] çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆè¤‡æ•°ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ æ¨ªæ–­ï¼‰
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆï¼ˆ<1ms/validationï¼‰

**æˆåŠŸåŸºæº–**:
- âœ… å¾ªç’°å‚ç…§ãŒè­¦å‘Šã•ã‚Œã‚‹
- âœ… äºˆç´„èªä½¿ç”¨ã§ã‚¨ãƒ©ãƒ¼
- âœ… ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³é€Ÿåº¦ <1ms

#### Week 4: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´å‚™ + ãƒªãƒªãƒ¼ã‚¹æº–å‚™

**Day 16-18: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆ**
- [ ] Builder APIå®Œå…¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- [ ] ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¬ã‚¤ãƒ‰ï¼ˆæ—¢å­˜ã‚¹ã‚­ãƒ¼ãƒ â†’ Builderï¼‰
- [ ] å‹ã‚¨ãƒ©ãƒ¼ã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
- [ ] å®Ÿä¾‹é›†ï¼ˆ10ãƒ‘ã‚¿ãƒ¼ãƒ³ä»¥ä¸Šï¼‰
- [ ] README.mdæ•´å‚™

**Day 19-20: ãƒªãƒ•ã‚¡ã‚¤ãƒ³ + ãƒªãƒªãƒ¼ã‚¹**
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆçµæœåˆ†æ
- [ ] ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºç¢ºèªï¼ˆç›®æ¨™: +5KBä»¥ä¸‹ï¼‰
- [ ] E2Eçµ±åˆãƒ†ã‚¹ãƒˆï¼ˆæ—¢å­˜203ãƒ†ã‚¹ãƒˆå…¨é€šéï¼‰
- [ ] ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼
- [ ] ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆä½œæˆ

**æˆåŠŸåŸºæº–**:
- âœ… ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚º +5KBä»¥ä¸‹
- âœ… E2Eå…¨ãƒ†ã‚¹ãƒˆé€šéï¼ˆ203/203ï¼‰
- âœ… ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå®Œå‚™

### ğŸ“Š å„ªå…ˆåº¦ã¨å¯¾è±¡ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ 

| ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ  | å„ªå…ˆåº¦ | ç†ç”± | å®Ÿè£…Week |
|------------|--------|------|----------|
| Flowchart | â­â­â­â­â­ | ãƒãƒ¼ãƒ‰å‚ç…§æ•´åˆæ€§ãŒæœ€é‡è¦ | Week 1 |
| Sequence | â­â­â­â­â­ | Participantäº‹å‰å®£è¨€å¿…é ˆ | Week 2 |
| State | â­â­â­â­â˜† | æ·±åº¦åˆ¶é™ã€é·ç§»æ¤œè¨¼ | Week 2 |
| Class | â­â­â˜†â˜†â˜† | ã‚¯ãƒ©ã‚¹å‚ç…§æ•´åˆæ€§ | Week 3 |
| ER | â­â­â˜†â˜†â˜† | Entityå‚ç…§æ•´åˆæ€§ | Week 3 |
| Gantt | â­â˜†â˜†â˜†â˜† | ã‚¿ã‚¹ã‚¯IDä¾å­˜é–¢ä¿‚ | Week 3 |

### ğŸ’° ã‚³ã‚¹ãƒˆåˆ†æ

| é …ç›® | ã‚³ã‚¹ãƒˆ | å‚™è€ƒ |
|------|--------|------|
| ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºå¢—åŠ  | **+5KBä»¥ä¸‹** | Tree Shakingå¯¾å¿œã€ESMå½¢å¼ |
| å®Ÿè£…å·¥æ•° | 4é€±é–“ | Week 1-4 |
| ãƒ†ã‚¹ãƒˆå·¥æ•° | è¾¼ã¿ | ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ+çµ±åˆãƒ†ã‚¹ãƒˆ |
| ãƒªã‚¹ã‚¯ | ğŸŸ¡ ä¸­ | æ—¢å­˜ã‚³ãƒ¼ãƒ‰å½±éŸ¿å°ï¼ˆä¸¦è¡Œé‹ç”¨å¯ï¼‰ |

### ğŸ”— Phase 4ï¼ˆCanvas APIç­‰ï¼‰ã¨ã®é–¢ä¿‚

**æ¨å¥¨å®Ÿæ–½é †åº**: **Phase 4å®Œäº†å¾Œ â†’ Phase 4.8**ï¼ˆé †æ¬¡å®Ÿè¡Œï¼‰

**ç†ç”±**:
1. âœ… Phase 4ã¯**ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“**å‘ä¸Šï¼ˆè¦–è¦šå“è³ªï¼‰â† å„ªå…ˆåº¦: ğŸ”´ High
2. âœ… Phase 4.8ã¯**é–‹ç™ºè€…ä½“é¨“**å‘ä¸Šï¼ˆå‹å®‰å…¨æ€§ï¼‰â† å„ªå…ˆåº¦: ğŸŸ¡ Medium
3. âœ… ä¸¦è¡Œå®Ÿæ–½å¯èƒ½ã ãŒãƒªã‚½ãƒ¼ã‚¹åˆ†æ•£ãƒªã‚¹ã‚¯ã‚ã‚Š
4. âœ… Phase 4å®Œäº†å¾Œã€Builderã«å°‚å¿µã™ã‚‹æ–¹ãŒåŠ¹ç‡çš„

**ä»£æ›¿æ¡ˆï¼ˆä¸¦è¡Œå®Ÿæ–½ï¼‰**:
- Week 1-2: Phase 4 Week 1-2 + Phase 4.8 Week 1ï¼ˆãƒªã‚¹ã‚¯ä¸­ï¼‰
- Week 3-4: Phase 4 Week 3 + Phase 4.8 Week 2-3
- Week 5-6: çµ±åˆãƒ†ã‚¹ãƒˆ

### ğŸ¯ æˆåŠŸåŸºæº–

#### æ©Ÿèƒ½é¢
- âœ… Flowchartã§å­˜åœ¨ã—ãªã„ãƒãƒ¼ãƒ‰å‚ç…§ãŒã‚¨ãƒ©ãƒ¼
- âœ… Sequenceã§æœªå®£è¨€ParticipantãŒã‚¨ãƒ©ãƒ¼
- âœ… Stateã§æ·±åº¦è¶…éãŒã‚¨ãƒ©ãƒ¼
- âœ… äºˆç´„èªä½¿ç”¨ãŒã‚¨ãƒ©ãƒ¼
- âœ… å¾ªç’°å‚ç…§ãŒè­¦å‘Šã•ã‚Œã‚‹

#### å“è³ªé¢
- âœ… TypeScript strict modeå®Œå…¨æº–æ‹ 
- âœ… ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ 90%ä»¥ä¸Š
- âœ… ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚º +5KBä»¥ä¸‹
- âœ… E2Eå…¨ãƒ†ã‚¹ãƒˆé€šéï¼ˆ203/203ï¼‰
- âœ… Biome checkå…¨é€šé

#### é–‹ç™ºä½“é¨“
- âœ… IDEè£œå®ŒãŒåŠ¹ã
- âœ… æ˜å¿«ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- âœ… æ—¢å­˜ã‚³ãƒ¼ãƒ‰ç ´å£Šãªã—ï¼ˆä¸¦è¡Œé‹ç”¨ï¼‰
- âœ… ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå®Œå‚™

### ğŸŒŸ Phase 4.8å®Œäº†å¾Œã®ãƒ“ã‚¸ãƒ§ãƒ³

**é”æˆçŠ¶æ…‹**:
- âœ… Mermaidæ–‡æ³•ã‚¨ãƒ©ãƒ¼ãŒã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ï¼‹æ§‹ç¯‰æ™‚ã«æ¤œå‡º
- âœ… é–‹ç™ºè€…ä½“é¨“ãŒæ¬¡å…ƒä¸ŠãŒã‚‹ï¼ˆå‹å®‰å…¨æ€§å‘ä¸Šï¼‰
- âœ… IDEã§è‡ªå‹•è£œå®Œã€å³åº§ã«ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
- âœ… æ—¢å­˜ã®ã‚¹ã‚­ãƒ¼ãƒAPIã¨ä¸¦è¡Œé‹ç”¨å¯èƒ½
- âœ… ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºå½±éŸ¿æœ€å°ï¼ˆ+5KBä»¥ä¸‹ï¼‰

**å·®åˆ¥åŒ–ãƒã‚¤ãƒ³ãƒˆ**:
- ğŸŒŸ TypeScriptå‹ã‚·ã‚¹ãƒ†ãƒ ã‚’æ´»ç”¨ã—ãŸæ–‡æ³•è¨¼æ˜
- ğŸŒŸ Builder Patternã«ã‚ˆã‚‹ç›´æ„Ÿçš„API
- ğŸŒŸ æ®µéšçš„å°å…¥å¯èƒ½ï¼ˆç ´å£Šçš„å¤‰æ›´ãªã—ï¼‰
- ğŸŒŸ Mermaidãƒ©ã‚¤ãƒ–ãƒ©ãƒªä»¥ä¸Šã®å‹å®‰å…¨æ€§

### ğŸ“ å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§

#### æ–°è¦ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
- [ ] `packages/builders/package.json`
- [ ] `packages/builders/tsconfig.json`
- [ ] `packages/builders/README.md`

#### æ–°è¦å®Ÿè£…
- [ ] `packages/builders/src/types.ts`
- [ ] `packages/builders/src/flowchart-builder.ts`
- [ ] `packages/builders/src/sequence-builder.ts`
- [ ] `packages/builders/src/state-builder.ts`
- [ ] `packages/builders/src/class-builder.ts`
- [ ] `packages/builders/src/er-builder.ts`
- [ ] `packages/builders/src/gantt-builder.ts`
- [ ] `packages/builders/src/validators/graph-validator.ts`
- [ ] `packages/builders/src/validators/reserved-words.ts`
- [ ] `packages/builders/src/index.ts`

#### ãƒ†ã‚¹ãƒˆ
- [ ] `packages/builders/tests/flowchart-builder.test.ts`
- [ ] `packages/builders/tests/sequence-builder.test.ts`
- [ ] `packages/builders/tests/state-builder.test.ts`
- [ ] `packages/builders/tests/validators.test.ts`

#### å½±éŸ¿ãªã—
- ğŸ”µ æ—¢å­˜ã®ã‚¹ã‚­ãƒ¼ãƒï¼ˆpackages/core/src/schemas/ï¼‰
- ğŸ”µ æ—¢å­˜ã®ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ï¼ˆpackages/react-renderer/ï¼‰
- ğŸ”µ æ—¢å­˜ã®ãƒ‘ãƒ¼ã‚µãƒ¼ï¼ˆpackages/parser/ï¼‰

### âš ï¸ ãƒªã‚¹ã‚¯ã¨å¯¾ç­–

#### Risk 1: æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã¸ã®å½±éŸ¿
**å½±éŸ¿åº¦**: ğŸŸ¡ Medium
**ç™ºç”Ÿç¢ºç‡**: 30%

**å¯¾ç­–**:
- âœ… æ—¢å­˜ã‚¹ã‚­ãƒ¼ãƒã¨Builderä¸¦è¡Œé‹ç”¨
- âœ… æ®µéšçš„ç§»è¡Œï¼ˆã¾ãšFlowchartã®ã¿ï¼‰
- âœ… ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼æä¾›ï¼ˆ`fromSchema()`ãƒ˜ãƒ«ãƒ‘ãƒ¼ï¼‰

#### Risk 2: é–‹ç™ºä½“é¨“ã®æ‚ªåŒ–
**å½±éŸ¿åº¦**: ğŸŸ¡ Medium
**ç™ºç”Ÿç¢ºç‡**: 40%

**å¯¾ç­–**:
- âœ… Fluent APIï¼ˆãƒ¡ã‚½ãƒƒãƒ‰ãƒã‚§ãƒ¼ãƒ³ï¼‰
- âœ… æ˜ç¢ºãªå‹ã‚¨ã‚¤ãƒªã‚¢ã‚¹ï¼ˆNodeID, ParticipantIDç­‰ï¼‰
- âœ… ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ©ãƒ¼ã‚¯ãƒ©ã‚¹ï¼ˆè©³ç´°ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼‰

#### Risk 3: ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºã®å¢—åŠ 
**å½±éŸ¿åº¦**: ğŸŸ¢ Low
**ç™ºç”Ÿç¢ºç‡**: 60%

**å¯¾ç­–**:
- âœ… Tree Shakingå¯¾å¿œï¼ˆESMå½¢å¼ï¼‰
- âœ… åˆ¥ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–ï¼ˆ`@typermaid/builders`ï¼‰
- âœ… ç›®æ¨™: +5KBä»¥å†…

### ğŸš€ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

**Phase 4å®Œäº†å¾Œ**:
1. Phase 4.8 Week 1é–‹å§‹ï¼ˆFlowchart Builderå®Ÿè£…ï¼‰
2. é †æ¬¡Week 2-4ã‚’å®Ÿæ–½
3. Phase 5ï¼ˆAngular Rendererï¼‰ã¸ç§»è¡Œ

**ä¸¦è¡Œå®Ÿæ–½ã™ã‚‹å ´åˆ**:
1. Phase 4ã¨Phase 4.8ã‚’åŒæ™‚é€²è¡Œ
2. ãƒªã‚½ãƒ¼ã‚¹ç®¡ç†ã«æ³¨æ„
3. çµ±åˆãƒ†ã‚¹ãƒˆã§ç«¶åˆæ¤œå‡º

---

## ğŸ¯ Phase 4.8 æ®µéšçš„å®Ÿè£…è¨ˆç”» - Builderå®Œå…¨å®Œæˆã¸ã®é“

### ğŸ“Š å®Ÿè£…ã®3ã¤ã®ã‚¹ãƒ†ãƒƒãƒ—

Builder ã‚·ã‚¹ãƒ†ãƒ ã‚’æ®µéšçš„ã«å®Œæˆã•ã›ã¦ã„ãã‚ã‚ˆğŸ’ª

#### ã‚¹ãƒ†ãƒƒãƒ—1: BuilderåŸºç›¤å®Œæˆï¼ˆãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ†ã‚£ãƒƒã‚¯æ§‹ç¯‰ã®ã¿ï¼‰ğŸŒŸ

**ç›®çš„**: å‹å®‰å…¨ãªãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ†ã‚£ãƒƒã‚¯ãªãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ æ§‹ç¯‰APIã®å®Œæˆ

**ç¾çŠ¶**: âœ… åŸºæœ¬å®Ÿè£…å®Œäº†
- âœ… Branded Typeså®šç¾©å®Œäº†ï¼ˆNodeID, ParticipantIDç­‰ï¼‰
- âœ… 6ç¨®é¡ã®Builderå®Ÿè£…å®Œäº†ï¼ˆFlowchart/Sequence/Class/ER/State/Ganttï¼‰
- âœ… 115å€‹ã®ãƒ†ã‚¹ãƒˆå…¨é€šé
- âœ… TypeScript strict modeæº–æ‹ 

**æ®‹ã‚¿ã‚¹ã‚¯**: ç´°ã‹ã„ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å¼·åŒ– + ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´å‚™

**Week 1ã‚¿ã‚¹ã‚¯ï¼ˆ3æ—¥é–“ï¼‰**:

**Day 1: Gantt Builderå®Œå…¨å®Ÿè£…** ğŸŸ¡
- [ ] ã‚¿ã‚¹ã‚¯æ—¥ä»˜ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å¼·åŒ–ï¼ˆstartDate, endDate, afterä¾å­˜é–¢ä¿‚ï¼‰
- [ ] ã‚»ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç†ã®æ”¹å–„ï¼ˆé‡è¤‡ãƒã‚§ãƒƒã‚¯ï¼‰
- [ ] ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³å¯¾å¿œï¼ˆduration: 0ã®ç‰¹æ®Šå‡¦ç†ï¼‰
- [ ] ã‚¿ã‚¹ã‚¯çŠ¶æ…‹ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆdone, active, crit, futureï¼‰
- [ ] ãƒ†ã‚¹ãƒˆè¿½åŠ ï¼ˆã‚«ãƒãƒ¬ãƒƒã‚¸95%+ï¼‰

**Day 2: Class/ER Builderé–¢ä¿‚æ€§æ“ä½œã®å®Ÿè£…** ğŸŸ¡
- [ ] **Class Builder**:
  - [ ] `addInheritance()` ãƒ¡ã‚½ãƒƒãƒ‰è¿½åŠ ï¼ˆã‚¯ãƒ©ã‚¹é–“ç¶™æ‰¿ï¼‰
  - [ ] `addImplementation()` ãƒ¡ã‚½ãƒƒãƒ‰è¿½åŠ ï¼ˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®Ÿè£…ï¼‰
  - [ ] `addAssociation()` ãƒ¡ã‚½ãƒƒãƒ‰è¿½åŠ ï¼ˆé–¢é€£ãƒ»é›†ç´„ãƒ»ã‚³ãƒ³ãƒã‚¸ã‚·ãƒ§ãƒ³ï¼‰
  - [ ] ã‚«ãƒ¼ãƒ‡ã‚£ãƒŠãƒªãƒ†ã‚£æŒ‡å®šï¼ˆ1, *, 0..1, 1..*, 0..*ï¼‰
  - [ ] åŒæ–¹å‘é–¢ä¿‚ã®æ¤œè¨¼
- [ ] **ER Builder**:
  - [ ] `addRelationship()` ãƒ¡ã‚½ãƒƒãƒ‰æ”¹å–„ï¼ˆã‚«ãƒ¼ãƒ‡ã‚£ãƒŠãƒªãƒ†ã‚£å¼·åˆ¶ï¼‰
  - [ ] é–¢ä¿‚ã‚¿ã‚¤ãƒ—ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆONE, MANY, ZERO_OR_ONEç­‰ï¼‰
  - [ ] Entityå±æ€§ã®ãƒ‡ãƒ¼ã‚¿å‹ãƒã‚§ãƒƒã‚¯ï¼ˆstring, int, dateç­‰ï¼‰
- [ ] ãƒ†ã‚¹ãƒˆè¿½åŠ ï¼ˆé–¢ä¿‚æ€§ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ç¶²ç¾…ï¼‰

**Day 3: ç´°ã‹ã„ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ä»•ä¸Šã’ + ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ** ğŸ“
- [ ] å…¨Builderå…±é€š:
  - [ ] å¾ªç’°å‚ç…§æ¤œå‡ºï¼ˆ`GraphValidator`å¼·åŒ–ï¼‰
  - [ ] å­¤ç«‹ãƒãƒ¼ãƒ‰è­¦å‘Šï¼ˆã‚¨ãƒƒã‚¸ã«å«ã¾ã‚Œãªã„ãƒãƒ¼ãƒ‰ï¼‰
  - [ ] ç©ºãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ æ¤œè¨¼ï¼ˆæœ€ä½1ãƒãƒ¼ãƒ‰å¿…é ˆï¼‰
- [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ:
  - [ ] å„Builder APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå®Œæˆ
  - [ ] ä½¿ç”¨ä¾‹ã‚³ãƒ¼ãƒ‰è¿½åŠ ï¼ˆ10ãƒ‘ã‚¿ãƒ¼ãƒ³ä»¥ä¸Šï¼‰
  - [ ] ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¬ã‚¤ãƒ‰
  - [ ] README.mdæ•´å‚™ï¼ˆ`packages/builders/README.md`ï¼‰

**æˆåŠŸåŸºæº–**:
- âœ… å…¨Builderãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸95%ä»¥ä¸Š
- âœ… TypeScript strict modeå®Œå…¨æº–æ‹ 
- âœ… Biome checkå…¨é€šé
- âœ… ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå®Œå‚™
- âœ… E2Eæ—¢å­˜ãƒ†ã‚¹ãƒˆå…¨é€šéï¼ˆ203/203ï¼‰

---

#### ã‚¹ãƒ†ãƒƒãƒ—2: AST â†’ Builderå¤‰æ›é–¢æ•°è¿½åŠ ï¼ˆãƒ‘ãƒ¼ã‚¹çµæœã‚’æ“ä½œå¯èƒ½ã«ï¼‰ğŸ”„

**ç›®çš„**: ãƒ‘ãƒ¼ã‚¹ã—ãŸMermaidã‚³ãƒ¼ãƒ‰ã‚’BuilderçµŒç”±ã§æ“ä½œå¯èƒ½ã«ã™ã‚‹

**èƒŒæ™¯**: 
ç¾çŠ¶ã¯BuilderçµŒç”±ã§ã‚¼ãƒ­ã‹ã‚‰ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ ã‚’æ§‹ç¯‰ã§ãã‚‹ã‘ã©ã€æ—¢å­˜ã®Mermaidæ–‡å­—åˆ—ã‚’ãƒ‘ãƒ¼ã‚¹ã—ãŸå¾Œã«**ç·¨é›†ãƒ»æ“ä½œ**ã™ã‚‹APIãŒãªã„ã‚ã­ğŸ˜¢

**å®Ÿè£…å†…å®¹**:

**æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«**: `packages/builders/src/converters/`

```typescript
// packages/builders/src/converters/ast-to-builder.ts

import type { FlowchartDiagram } from '@typermaid/core';
import { FlowchartDiagramBuilder } from '../flowchart-builder.js';

/**
 * Convert parsed AST to Builder for manipulation
 */
export function flowchartASTToBuilder(ast: FlowchartDiagram): FlowchartDiagramBuilder {
  const builder = new FlowchartDiagramBuilder();
  
  // Set direction
  if (ast.direction) {
    builder.setDirection(ast.direction);
  }
  
  // Add nodes
  for (const node of ast.nodes) {
    builder.addNode(node.id, node.shape, node.label);
  }
  
  // Add edges
  for (const edge of ast.edges) {
    builder.addEdge(
      edge.from as NodeID, 
      edge.to as NodeID, 
      edge.type, 
      edge.label
    );
  }
  
  // Add subgraphs
  for (const subgraph of ast.subgraphs ?? []) {
    const sgId = builder.addSubgraph(subgraph.id, subgraph.label);
    for (const nodeId of subgraph.nodes) {
      builder.addNodeToSubgraph(sgId, nodeId as NodeID);
    }
  }
  
  return builder;
}
```

**ä½¿ç”¨ä¾‹**:
```typescript
import { parse } from '@typermaid/parser';
import { flowchartASTToBuilder } from '@typermaid/builders';

// 1. Parse existing Mermaid code
const code = `
flowchart TB
  A[Start] --> B[Process]
  B --> C[End]
`;
const ast = parse(code);

// 2. Convert to Builder
const builder = flowchartASTToBuilder(ast);

// 3. Manipulate!
const d = builder.addNode('D', 'diamond', 'Decision?');
builder.addEdge(b, d, 'arrow');
builder.addEdge(d, c, 'arrow', 'Yes');

// 4. Generate modified diagram
const modifiedDiagram = builder.build();
```

**Week 2ã‚¿ã‚¹ã‚¯ï¼ˆ3æ—¥é–“ï¼‰**:

**Day 1: Flowchart/Sequence Converterå®Ÿè£…**
- [ ] `flowchartASTToBuilder()` å®Ÿè£…
- [ ] `sequenceASTToBuilder()` å®Ÿè£…
- [ ] ãƒ†ã‚¹ãƒˆè¿½åŠ ï¼ˆãƒ‘ãƒ¼ã‚¹â†’å¤‰æ›â†’ãƒ“ãƒ«ãƒ‰å¾€å¾©ç¢ºèªï¼‰

**Day 2: State/Class/ER Converterå®Ÿè£…**
- [ ] `stateASTToBuilder()` å®Ÿè£…
- [ ] `classASTToBuilder()` å®Ÿè£…
- [ ] `erASTToBuilder()` å®Ÿè£…
- [ ] ãƒ†ã‚¹ãƒˆè¿½åŠ 

**Day 3: Gantt Converter + çµ±åˆãƒ†ã‚¹ãƒˆ**
- [ ] `ganttASTToBuilder()` å®Ÿè£…
- [ ] E2Eçµ±åˆãƒ†ã‚¹ãƒˆï¼ˆå…¨203ã‚±ãƒ¼ã‚¹ã§ãƒ‘ãƒ¼ã‚¹â†’å¤‰æ›â†’ãƒ“ãƒ«ãƒ‰æ¤œè¨¼ï¼‰
- [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè¿½åŠ ï¼ˆä½¿ç”¨ä¾‹ãƒ»ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ï¼‰

**æˆåŠŸåŸºæº–**:
- âœ… å…¨6ç¨®é¡ã®ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ ã§ASTâ†’Builderå¤‰æ›å¯èƒ½
- âœ… ãƒ‘ãƒ¼ã‚¹â†’å¤‰æ›â†’ãƒ“ãƒ«ãƒ‰å¾€å¾©ã§å…ƒã®ASTã¨ä¸€è‡´
- âœ… E2Eå…¨ãƒ†ã‚¹ãƒˆé€šéï¼ˆ203/203ï¼‰

---

#### ã‚¹ãƒ†ãƒƒãƒ—3: å®Œå…¨AST Manipulation APIï¼ˆã‚ˆã‚Šé«˜åº¦ï¼‰âš¡

**ç›®çš„**: BuilderçµŒç”±ã§ãªãã€ç›´æ¥ASTã‚’æ“ä½œã§ãã‚‹é«˜åº¦ãªAPI

**èƒŒæ™¯**: 
Builder Patternã¯ãƒ¡ã‚½ãƒƒãƒ‰ãƒã‚§ãƒ¼ãƒ³ã§ã‚ã‹ã‚Šã‚„ã™ã„ã‘ã©ã€**å¤§è¦æ¨¡ãªä¸€æ‹¬æ“ä½œ**ã‚„**è¤‡é›‘ãªãƒˆãƒ©ãƒãƒ¼ã‚¹**ã«ã¯å‘ã„ã¦ãªã„ã‚ã‚ˆã­ğŸ¤”

**å®Ÿè£…å†…å®¹**:

**æ–°è¦ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸**: `packages/ast-manipulation/`

```typescript
// packages/ast-manipulation/src/traversal.ts

import type { FlowchartDiagram, FlowchartNode } from '@typermaid/core';

/**
 * Visitor pattern for AST traversal
 */
export interface ASTVisitor<T> {
  visitNode?(node: FlowchartNode, parent: unknown): T | void;
  visitEdge?(edge: FlowchartEdge, parent: unknown): T | void;
  visitSubgraph?(subgraph: Subgraph, parent: unknown): T | void;
}

/**
 * Traverse AST with visitor pattern
 */
export function traverse<T>(
  ast: FlowchartDiagram,
  visitor: ASTVisitor<T>
): T[] {
  const results: T[] = [];
  
  // Visit nodes
  for (const node of ast.nodes) {
    const result = visitor.visitNode?.(node, ast);
    if (result !== undefined) results.push(result);
  }
  
  // Visit edges
  for (const edge of ast.edges) {
    const result = visitor.visitEdge?.(edge, ast);
    if (result !== undefined) results.push(result);
  }
  
  // Visit subgraphs (recursive)
  for (const subgraph of ast.subgraphs ?? []) {
    const result = visitor.visitSubgraph?.(subgraph, ast);
    if (result !== undefined) results.push(result);
  }
  
  return results;
}

/**
 * Find nodes by predicate
 */
export function findNodes(
  ast: FlowchartDiagram,
  predicate: (node: FlowchartNode) => boolean
): FlowchartNode[] {
  return ast.nodes.filter(predicate);
}

/**
 * Replace node in AST (immutable)
 */
export function replaceNode(
  ast: FlowchartDiagram,
  nodeId: string,
  newNode: FlowchartNode
): FlowchartDiagram {
  return {
    ...ast,
    nodes: ast.nodes.map(n => n.id === nodeId ? newNode : n),
  };
}

/**
 * Remove node and related edges (immutable)
 */
export function removeNode(
  ast: FlowchartDiagram,
  nodeId: string
): FlowchartDiagram {
  return {
    ...ast,
    nodes: ast.nodes.filter(n => n.id !== nodeId),
    edges: ast.edges.filter(e => e.from !== nodeId && e.to !== nodeId),
  };
}
```

**ä½¿ç”¨ä¾‹**:
```typescript
import { parse } from '@typermaid/parser';
import { traverse, findNodes, replaceNode } from '@typermaid/ast-manipulation';

const ast = parse('flowchart TB\n A --> B --> C');

// Find all square nodes
const squareNodes = findNodes(ast, n => n.shape === 'square');

// Replace node label
const updatedAST = replaceNode(ast, 'A', {
  ...ast.nodes.find(n => n.id === 'A')!,
  label: 'Updated Start'
});

// Custom traversal
traverse(ast, {
  visitNode(node) {
    console.log('Node:', node.id, node.label);
  },
  visitEdge(edge) {
    console.log('Edge:', edge.from, '->', edge.to);
  }
});
```

**Week 3-4ã‚¿ã‚¹ã‚¯ï¼ˆ6æ—¥é–“ï¼‰**:

**Week 3 Day 1-2: Traversalå®Ÿè£…**
- [ ] `traverse()` Visitor patternå®Ÿè£…
- [ ] `findNodes()` / `findEdges()` ã‚¯ã‚¨ãƒªAPI
- [ ] `filter()` / `map()` ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
- [ ] ãƒ†ã‚¹ãƒˆè¿½åŠ 

**Week 3 Day 3: Immutableæ“ä½œAPI**
- [ ] `replaceNode()` / `removeNode()` å®Ÿè£…
- [ ] `addNode()` / `addEdge()` Immutableç‰ˆ
- [ ] Structural Sharingæœ€é©åŒ–ï¼ˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ï¼‰
- [ ] ãƒ†ã‚¹ãƒˆè¿½åŠ 

**Week 4 Day 1-2: é«˜åº¦ãªã‚¯ã‚¨ãƒªAPI**
- [ ] `findPathBetween(from, to)` - ãƒãƒ¼ãƒ‰é–“ã®ãƒ‘ã‚¹æ¢ç´¢
- [ ] `findConnectedComponent(nodeId)` - é€£çµæˆåˆ†æ¤œå‡º
- [ ] `detectCycles()` - å¾ªç’°å‚ç…§æ¤œå‡º
- [ ] `topologicalSort()` - ãƒˆãƒãƒ­ã‚¸ã‚«ãƒ«ã‚½ãƒ¼ãƒˆï¼ˆä¾å­˜é †åºï¼‰
- [ ] ãƒ†ã‚¹ãƒˆè¿½åŠ 

**Week 4 Day 3: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ + ãƒªãƒªãƒ¼ã‚¹æº–å‚™**
- [ ] APIå®Œå…¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- [ ] ä½¿ç”¨ä¾‹ãƒ»ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹é›†
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯
- [ ] README.mdæ•´å‚™

**æˆåŠŸåŸºæº–**:
- âœ… ASTæ“ä½œãŒé–¢æ•°å‹ï¼ˆImmutableï¼‰
- âœ… Visitor patternå®Œå…¨å®Ÿè£…
- âœ… ã‚¯ã‚¨ãƒªAPIå……å®Ÿï¼ˆ10ç¨®é¡ä»¥ä¸Šï¼‰
- âœ… ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå®Œå‚™
- âœ… ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚º +10KBä»¥ä¸‹

---

### ğŸ“Š æ®µéšçš„å®Ÿè£…ã®ãƒ¡ãƒªãƒƒãƒˆ

| ã‚¹ãƒ†ãƒƒãƒ— | é”æˆå†…å®¹ | é–‹ç™ºè€…ä½“é¨“å‘ä¸Š | ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚º |
|---------|---------|--------------|--------------|
| **Step 1** | BuilderåŸºç›¤å®Œæˆ | â­â­â­â­â­ ãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ†ã‚£ãƒƒã‚¯æ§‹ç¯‰ãŒå®Œç’§ | +5KB |
| **Step 2** | ASTâ†’Builderå¤‰æ› | â­â­â­â­â˜† ãƒ‘ãƒ¼ã‚¹çµæœã‚’ç·¨é›†å¯èƒ½ã« | +2KB |
| **Step 3** | AST Manipulation | â­â­â­â­â­ é«˜åº¦ãªæ“ä½œãƒ»ã‚¯ã‚¨ãƒªå¯èƒ½ | +10KB |

**åˆè¨ˆ**: ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºå½±éŸ¿ **+17KB**ï¼ˆTree Shakingå¯¾å¿œï¼‰

---

### ğŸ¯ ç¾åœ¨ã®ä½ç½® - Step 2 Day 1 é€²è¡Œä¸­ï¼

**ç¾åœ¨**: Step 2ï¼ˆASTâ†’Builderå¤‰æ›ï¼‰Day 1 å®Ÿè£…ä¸­ ğŸ”¥

**Step 1å®Œäº†çŠ¶æ³**:
1. âœ… Gantt Builderå®Œå…¨å®Ÿè£…ï¼ˆæ—¥ä»˜ãƒ»ä¾å­˜é–¢ä¿‚ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
2. ğŸŸ¡ Class/ER Builderé–¢ä¿‚æ€§æ“ä½œã®å®Ÿè£…ï¼ˆå¤šãã®å®Ÿè£…ä¸è¶³ï¼‰
3. ğŸŸ¡ ç´°ã‹ã„ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ä»•ä¸Šã’ï¼ˆæ®‹ã‚Šèª²é¡Œã‚ã‚Šï¼‰
4. ğŸŸ¡ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´å‚™ï¼ˆæœªå®Œäº†ï¼‰

**Step 2 Day 1 é€²æ—ï¼ˆä»Šæ—¥ï¼‰**:
1. âœ… Flowchart Converter åŸºæœ¬å®Ÿè£…å®Œäº†
   - `flowchartASTToBuilder()` é–¢æ•°ä½œæˆ
   - æš—é»™çš„ãƒãƒ¼ãƒ‰ï¼ˆimplicit nodesï¼‰å¯¾å¿œè¿½åŠ 
   - Subgraphå¯¾å¿œ
   - ãƒ†ã‚¹ãƒˆ6ä»¶ä¸­5ä»¶æˆåŠŸ (83%)
2. âœ… Sequence Converter åŸºæœ¬å®Ÿè£…å®Œäº†  
   - `sequenceASTToBuilder()` é–¢æ•°ä½œæˆ
   - Participant/Actor/Message/Noteå¯¾å¿œ
   - æ‰‹å‹•ãƒ†ã‚¹ãƒˆã§ã¯æˆåŠŸç¢ºèª
   - âš ï¸ Vitestã§ã¯å¤±æ•—ä¸­ï¼ˆèª¿æŸ»ä¸­ï¼‰
3. âœ… Convertersãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
   - `packages/builders/src/converters/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
   - index.tsã§export
   - `@typermaid/parser` ä¾å­˜é–¢ä¿‚è¿½åŠ 

**æ®‹èª²é¡Œ**:
- ğŸ› Sequence Converterã®vitestã‚¨ãƒ©ãƒ¼è§£æ±ºï¼ˆ`diagram.statements is not iterable`ï¼‰
- ğŸ› Flowchart ClassDefå¯¾å¿œï¼ˆãƒ‘ãƒ¼ã‚µãƒ¼æœªã‚µãƒãƒ¼ãƒˆï¼‰
- â³ State/Class/ER/Gantt Converterå®Ÿè£…ï¼ˆDay 2-3äºˆå®šï¼‰

**æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—**: Sequence Converterã®ãƒã‚°ä¿®æ­£ â†’ Day 2ã¸ç§»è¡Œ ğŸ’­

---

## ğŸš€ Phase 5: Angular Renderer - Multi-Framework Support Revolution

### ğŸ“Š èƒŒæ™¯ã¨ç›®çš„

**èƒŒæ™¯**: React rendererå®Œæˆã€æ¬¡ã¯Angularã‚µãƒãƒ¼ãƒˆ
**ç›®çš„**: ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯éä¾å­˜ãªã‚³ã‚¢ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ´»ç”¨ã—ã€Angular 18+å¯¾å¿œãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ã‚’æ§‹ç¯‰

### ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
@typermaid/renderer-core (Framework-agnostic)
    â”‚
    â”œâ”€â†’ @typermaid/react-renderer (React 18+)
    â””â”€â†’ @typermaid/angular-renderer (Angular 18+) ğŸ†•
```

### ğŸ“¦ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æ§‹é€ 

```
packages/angular-renderer/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ mermaid-diagram/      # ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ flowchart-renderer/   # Flowchartå°‚ç”¨
â”‚   â”‚   â”‚   â”œâ”€â”€ sequence-renderer/    # Sequenceå°‚ç”¨
â”‚   â”‚   â”‚   â”œâ”€â”€ class-renderer/       # Classå°‚ç”¨
â”‚   â”‚   â”‚   â”œâ”€â”€ er-renderer/          # ERå°‚ç”¨
â”‚   â”‚   â”‚   â”œâ”€â”€ state-renderer/       # Stateå°‚ç”¨
â”‚   â”‚   â”‚   â””â”€â”€ gantt-renderer/       # Ganttå°‚ç”¨
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”œâ”€â”€ theme.service.ts      # ãƒ†ãƒ¼ãƒç®¡ç†ï¼ˆSignalsï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ parser.service.ts     # ãƒ‘ãƒ¼ã‚µãƒ¼ãƒ©ãƒƒãƒ‘ãƒ¼
â”‚   â”‚   â”‚   â””â”€â”€ zoom-pan.service.ts   # Zoom/Panç®¡ç†
â”‚   â”‚   â”œâ”€â”€ directives/
â”‚   â”‚   â”‚   â””â”€â”€ zoom-pan.directive.ts # SVG Zoom/Pan
â”‚   â”‚   â””â”€â”€ models/
â”‚   â”‚       â””â”€â”€ diagram.models.ts     # å‹å®šç¾©
â”‚   â”œâ”€â”€ public-api.ts
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â””â”€â”€ README.md
```

### ğŸ¨ APIè¨­è¨ˆ

#### Basic Usage
```typescript
// app.component.ts
import { Component } from '@angular/core';
import { MermaidDiagramComponent } from '@typermaid/angular-renderer';

@Component({
  selector: 'app-root',
  standalone: true,
  imports: [MermaidDiagramComponent],
  template: `
    <lyric-mermaid-diagram
      [code]="code"
      [theme]="'light'"
      [interactive]="true"
      (nodeClick)="onNodeClick($event)"
    />
  `
})
export class AppComponent {
  code = \`
    flowchart TB
      A[Start] --> B{Check}
      B -->|Yes| C[OK]
      B -->|No| D[Error]
  \`;
  
  onNodeClick(node: any) {
    console.log('Node clicked:', node);
  }
}
```

#### With Signals (Angular 18+)
```typescript
import { Component, signal } from '@angular/core';

@Component({
  // ...
})
export class AppComponent {
  code = signal(\`flowchart TB...\`);
  theme = signal<'light' | 'dark'>('light');
  
  toggleTheme() {
    this.theme.update(t => t === 'light' ? 'dark' : 'light');
  }
}
```

### ğŸ“‹ å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚º

#### Phase 5.1: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆDay 1ï¼‰ âœ… **å®Œäº†ï¼**

**ã‚¿ã‚¹ã‚¯**:
- [x] `packages/angular-renderer`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
- [x] Angular 18+ ãƒ©ã‚¤ãƒ–ãƒ©ãƒªåˆæœŸåŒ–ï¼ˆng generate libraryï¼‰
- [x] TypeScriptè¨­å®šï¼ˆstrict modeã€`@typermaid/*`ãƒ‘ã‚¹è¨­å®šï¼‰
- [x] ä¾å­˜é–¢ä¿‚è¿½åŠ ï¼š
  - `@typermaid/core`
  - `@typermaid/parser`
  - `@typermaid/renderer-core`
- [x] ãƒ“ãƒ«ãƒ‰è¨­å®šï¼ˆng-packagrï¼‰
- [x] pnpm workspaceçµ±åˆ

**æˆæœç‰©**:
- `packages/angular-renderer/package.json`
- `packages/angular-renderer/tsconfig.json`
- `packages/angular-renderer/ng-package.json`

#### Phase 5.2: ã‚³ã‚¢ã‚µãƒ¼ãƒ“ã‚¹å®Ÿè£…ï¼ˆDay 1-2ï¼‰

**5.2.1 ParserService**
```typescript
import { Injectable } from '@angular/core';
import { parse } from '@typermaid/parser';

@Injectable({ providedIn: 'root' })
export class ParserService {
  parse(code: string) {
    return parse(code);
  }
}
```

**5.2.2 ThemeService (Signals)**
```typescript
import { Injectable, signal, computed } from '@angular/core';
import { Theme, lightTheme, darkTheme } from '@typermaid/renderer-core';

@Injectable({ providedIn: 'root' })
export class ThemeService {
  private currentThemeName = signal<'light' | 'dark'>('light');
  
  theme = computed(() => 
    this.currentThemeName() === 'light' ? lightTheme : darkTheme
  );
  
  setTheme(name: 'light' | 'dark') {
    this.currentThemeName.set(name);
  }
  
  toggleTheme() {
    this.setTheme(this.currentThemeName() === 'light' ? 'dark' : 'light');
  }
}
```

**5.2.3 ZoomPanService**
```typescript
import { Injectable, signal } from '@angular/core';

export interface ZoomPanState {
  scale: number;
  translateX: number;
  translateY: number;
}

@Injectable({ providedIn: 'root' })
export class ZoomPanService {
  state = signal<ZoomPanState>({
    scale: 1,
    translateX: 0,
    translateY: 0,
  });
  
  zoom(delta: number) {
    this.state.update(s => ({
      ...s,
      scale: Math.max(0.1, Math.min(5, s.scale + delta)),
    }));
  }
  
  pan(dx: number, dy: number) {
    this.state.update(s => ({
      ...s,
      translateX: s.translateX + dx,
      translateY: s.translateY + dy,
    }));
  }
  
  reset() {
    this.state.set({ scale: 1, translateX: 0, translateY: 0 });
  }
}
```

#### Phase 5.2: ã‚³ã‚¢ã‚µãƒ¼ãƒ“ã‚¹å®Ÿè£…ï¼ˆDay 1-2ï¼‰ âœ… **å®Œäº†ï¼**

**5.2.1 ParserService** âœ…
**5.2.2 ThemeService (Signals)** âœ…
**5.2.3 ZoomPanService** âœ…

**ã‚¿ã‚¹ã‚¯**:
- [x] `ParserService` å®Ÿè£…
- [x] `ThemeService` å®Ÿè£…ï¼ˆSignalsä½¿ç”¨ï¼‰
- [x] `ZoomPanService` å®Ÿè£…ï¼ˆSignalsä½¿ç”¨ï¼‰
- [ ] ã‚µãƒ¼ãƒ“ã‚¹ãƒ†ã‚¹ãƒˆä½œæˆ

#### Phase 5.3: ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå®Ÿè£…ï¼ˆDay 2ï¼‰

**5.3.1 MermaidDiagramComponent**
```typescript
import { Component, Input, Output, EventEmitter, computed } from '@angular/core';
import { CommonModule } from '@angular/common';
import { ParserService } from '../services/parser.service';
import { ThemeService } from '../services/theme.service';

@Component({
  selector: 'lyric-mermaid-diagram',
  standalone: true,
  imports: [
    CommonModule,
    FlowchartRendererComponent,
    SequenceRendererComponent,
    // ...
  ],
  templateUrl: './mermaid-diagram.component.html',
  styleUrls: ['./mermaid-diagram.component.scss']
})
export class MermaidDiagramComponent {
  @Input() code?: string;
  @Input() ast?: any;
  @Input() theme?: 'light' | 'dark';
  @Input() interactive = false;
  
  @Output() nodeClick = new EventEmitter<any>();
  @Output() edgeClick = new EventEmitter<any>();
  
  constructor(
    private parser: ParserService,
    private themeService: ThemeService
  ) {}
  
  parsedAst = computed(() => {
    if (this.ast) return this.ast;
    if (this.code) return this.parser.parse(this.code);
    return null;
  });
  
  currentTheme = computed(() => {
    if (this.theme) {
      return this.theme === 'light' ? lightTheme : darkTheme;
    }
    return this.themeService.theme();
  });
  
  diagramType = computed(() => {
    const ast = this.parsedAst();
    if (!ast?.body?.[0]) return null;
    return ast.body[0].type;
  });
}
```

**Template**:
```html
<!-- mermaid-diagram.component.html -->
<div class="lyric-diagram-container">
  @if (diagramType() === 'FlowchartDiagram') {
    <lyric-flowchart-renderer
      [diagram]="parsedAst().body[0]"
      [theme]="currentTheme()"
      [interactive]="interactive"
      (nodeClick)="nodeClick.emit($event)"
      (edgeClick)="edgeClick.emit($event)"
    />
  } @else if (diagramType() === 'SequenceDiagram') {
    <lyric-sequence-renderer
      [diagram]="parsedAst().body[0]"
      [theme]="currentTheme()"
    />
  }
  <!-- ä»–ã®ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ ã‚¿ã‚¤ãƒ— -->
</div>
```

#### Phase 5.3: ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå®Ÿè£…ï¼ˆDay 2ï¼‰ âœ… **å®Œäº†ï¼**

**5.3.1 MermaidDiagramComponent** âœ…

**ã‚¿ã‚¹ã‚¯**:
- [x] `MermaidDiagramComponent` å®Ÿè£…
- [x] ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½œæˆ
- [x] ã‚¹ã‚¿ã‚¤ãƒ«å®šç¾©
- [ ] ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆä½œæˆ

#### Phase 5.4: ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼å®Ÿè£…ï¼ˆDay 2-4ï¼‰

**5.4.1 FlowchartRendererComponent**
```typescript
import { Component, Input, Output, EventEmitter, computed } from '@angular/core';
import { CommonModule } from '@angular/common';
import { computeDagreLayout } from '@typermaid/renderer-core';
import type { FlowchartDiagram, Theme } from '@typermaid/core';

@Component({
  selector: 'lyric-flowchart-renderer',
  standalone: true,
  imports: [CommonModule],
  template: `
    <svg [attr.width]="layout().width" [attr.height]="layout().height">
      <g>
        @for (node of layout().nodes; track node.id) {
          <g
            [attr.transform]="'translate(' + node.x + ',' + node.y + ')'"
            (click)="onNodeClick(node)"
          >
            <path
              [attr.d]="getShapePath(node)"
              [attr.fill]="theme.colors.node.fill"
              [attr.stroke]="theme.colors.node.stroke"
            />
            <text
              [attr.text-anchor]="'middle'"
              [attr.y]="node.height / 2"
            >
              {{ node.label }}
            </text>
          </g>
        }
        @for (edge of layout().edges; track edge.id) {
          <path
            [attr.d]="getEdgePath(edge)"
            [attr.stroke]="theme.colors.edge.stroke"
            [attr.fill]="'none'"
            (click)="onEdgeClick(edge)"
          />
        }
      </g>
    </svg>
  `
})
export class FlowchartRendererComponent {
  @Input() diagram!: FlowchartDiagram;
  @Input() theme!: Theme;
  @Input() interactive = false;
  
  @Output() nodeClick = new EventEmitter<any>();
  @Output() edgeClick = new EventEmitter<any>();
  
  layout = computed(() => {
    return computeDagreLayout(
      this.diagram.nodes,
      this.diagram.edges,
      { rankdir: this.diagram.direction || 'TB' }
    );
  });
  
  getShapePath(node: any): string {
    // renderer-coreã®ãƒ˜ãƒ«ãƒ‘ãƒ¼ä½¿ç”¨
    return generateShapePath(node.shape, node.width, node.height);
  }
  
  getEdgePath(edge: any): string {
    // renderer-coreã®ãƒ˜ãƒ«ãƒ‘ãƒ¼ä½¿ç”¨
    return generateEdgePath(edge.points);
  }
  
  onNodeClick(node: any) {
    if (this.interactive) {
      this.nodeClick.emit(node);
    }
  }
  
  onEdgeClick(edge: any) {
    if (this.interactive) {
      this.edgeClick.emit(edge);
    }
  }
}
```

#### Phase 5.4: ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼å®Ÿè£…ï¼ˆDay 2-4ï¼‰ âœ… **å®Œäº†ï¼**

**5.4.1 FlowchartRendererComponent** âœ…

**ã‚¿ã‚¹ã‚¯**:
- [x] `FlowchartRendererComponent` å®Ÿè£…
- [x] `SequenceRendererComponent` å®Ÿè£…
- [x] `ClassRendererComponent` å®Ÿè£…
- [x] `ERRendererComponent` å®Ÿè£…
- [x] `StateRendererComponent` å®Ÿè£…
- [x] `GanttRendererComponent` å®Ÿè£…
- [ ] å„ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆä½œæˆ

**å®Ÿè£…å®Œäº†é …ç›®**:
- âœ… å…¨6ç¨®é¡ã®ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼å®Ÿè£…å®Œäº†
- âœ… Dagreçµ±ä¸€ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆé©ç”¨ï¼ˆClass, ER, Stateï¼‰
- âœ… Timeline based Ganttå®Ÿè£…
- âœ… ASTæ§‹é€ ã¸ã®æ­£ã—ã„ã‚¢ã‚¯ã‚»ã‚¹ï¼ˆ`diagram.diagram.*`ï¼‰
- âœ… `exactOptionalPropertyTypes: true`å¯¾å¿œ
- âœ… TypeScript strict modeå®Œå…¨æº–æ‹ 
- âœ… Biome linté€šéï¼ˆauto-fixé©ç”¨æ¸ˆã¿ï¼‰
- âœ… ãƒ“ãƒ«ãƒ‰æˆåŠŸï¼ˆå…¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼‰

#### Phase 5.5: Zoom/Panãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ï¼ˆDay 4ï¼‰

**ZoomPanDirective**
```typescript
import { Directive, ElementRef, HostListener, Input } from '@angular/core';
import { ZoomPanService } from '../services/zoom-pan.service';

@Directive({
  selector: '[lyricZoomPan]',
  standalone: true
})
export class ZoomPanDirective {
  @Input() enabled = true;
  
  private isPanning = false;
  private startX = 0;
  private startY = 0;
  
  constructor(
    private el: ElementRef<SVGSVGElement>,
    private zoomPanService: ZoomPanService
  ) {}
  
  @HostListener('wheel', ['$event'])
  onWheel(event: WheelEvent) {
    if (!this.enabled) return;
    event.preventDefault();
    
    const delta = -event.deltaY * 0.001;
    this.zoomPanService.zoom(delta);
    this.updateTransform();
  }
  
  @HostListener('mousedown', ['$event'])
  onMouseDown(event: MouseEvent) {
    if (!this.enabled) return;
    this.isPanning = true;
    this.startX = event.clientX;
    this.startY = event.clientY;
  }
  
  @HostListener('document:mousemove', ['$event'])
  onMouseMove(event: MouseEvent) {
    if (!this.isPanning) return;
    
    const dx = event.clientX - this.startX;
    const dy = event.clientY - this.startY;
    
    this.zoomPanService.pan(dx, dy);
    this.updateTransform();
    
    this.startX = event.clientX;
    this.startY = event.clientY;
  }
  
  @HostListener('document:mouseup')
  onMouseUp() {
    this.isPanning = false;
  }
  
  private updateTransform() {
    const state = this.zoomPanService.state();
    const g = this.el.nativeElement.querySelector('g');
    if (g) {
      g.setAttribute('transform', 
        `translate(${state.translateX}, ${state.translateY}) scale(${state.scale})`
      );
    }
  }
}
```

#### Phase 5.5: Zoom/Panãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ï¼ˆDay 4ï¼‰ âœ… **å®Œäº†ï¼**

**ZoomPanDirective** âœ…

**ã‚¿ã‚¹ã‚¯**:
- [x] `ZoomPanDirective` å®Ÿè£…
- [x] ãƒã‚¦ã‚¹ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- [ ] ã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆå¯¾å¿œï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
- [ ] ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ãƒ†ã‚¹ãƒˆä½œæˆ

#### Phase 5.6: ãƒ‡ãƒ¢ã‚¢ãƒ—ãƒªä½œæˆï¼ˆDay 5ï¼‰

**Angular Demo App**
```
packages/angular-demo/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ app.component.ts        # ãƒ¡ã‚¤ãƒ³
â”‚   â”‚   â”œâ”€â”€ playground/             # ãƒ—ãƒ¬ã‚¤ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰
â”‚   â”‚   â”œâ”€â”€ gallery/                # ã‚®ãƒ£ãƒ©ãƒªãƒ¼
â”‚   â”‚   â””â”€â”€ examples/               # ã‚µãƒ³ãƒ—ãƒ«é›†
â”‚   â”œâ”€â”€ index.html
â”‚   â””â”€â”€ main.ts
â”œâ”€â”€ angular.json
â”œâ”€â”€ package.json
â””â”€â”€ tsconfig.json
```

**ã‚¿ã‚¹ã‚¯**:
- [ ] Angular standalone appã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
- [ ] å…¨6ç¨®é¡ã®ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ ã‚µãƒ³ãƒ—ãƒ«
- [ ] ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆUI
- [ ] ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ—ãƒ¬ã‚¤ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰
- [ ] ã‚®ãƒ£ãƒ©ãƒªãƒ¼ï¼ˆ203ã‚µãƒ³ãƒ—ãƒ«è¡¨ç¤ºï¼‰

#### Phase 5.7: å…±é€šåŒ–æ”¹å–„ï¼ˆDay 4-5ï¼‰

**renderer-coreã¸ã®SVGç”Ÿæˆãƒ˜ãƒ«ãƒ‘ãƒ¼è¿½åŠ **

ç¾çŠ¶ã®èª²é¡Œï¼šReact/Angularã§åŒã˜ãƒ­ã‚¸ãƒƒã‚¯ãŒé‡è¤‡ã—ã¦ã„ã‚‹

**æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«**: `packages/renderer-core/src/svg/svg-helpers.ts`

```typescript
// Pure function: Shape path generator
export function generateShapePath(
  shape: NodeShape,
  width: number,
  height: number
): string {
  switch (shape) {
    case 'square':
      return `M 0 0 L ${width} 0 L ${width} ${height} L 0 ${height} Z`;
    case 'round':
      const r = Math.min(width, height) / 4;
      return `M ${r} 0 L ${width - r} 0 Q ${width} 0 ${width} ${r} L ${width} ${height - r} Q ${width} ${height} ${width - r} ${height} L ${r} ${height} Q 0 ${height} 0 ${height - r} L 0 ${r} Q 0 0 ${r} 0 Z`;
    // ... ä»–ã®å½¢çŠ¶
  }
}

// Pure function: Edge path generator
export function generateEdgePath(points: Point[]): string {
  if (points.length === 0) return '';
  
  let path = `M ${points[0].x} ${points[0].y}`;
  for (let i = 1; i < points.length; i++) {
    path += ` L ${points[i].x} ${points[i].y}`;
  }
  return path;
}

// Pure function: Smooth curve
export function generateSmoothEdgePath(points: Point[]): string {
  // Catmull-Rom spline implementation
  // ...
}
```

**ã‚¿ã‚¹ã‚¯**:
- [ ] `svg-helpers.ts` ä½œæˆ
- [ ] å…¨å½¢çŠ¶ã®ãƒ‘ã‚¹ç”Ÿæˆé–¢æ•°
- [ ] ã‚¨ãƒƒã‚¸ãƒ‘ã‚¹ç”Ÿæˆé–¢æ•°ï¼ˆç›´ç·š/æ›²ç·šï¼‰
- [ ] ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆ95%ã‚«ãƒãƒ¬ãƒƒã‚¸ï¼‰
- [ ] React/Angularãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ã§ä½¿ç”¨

#### Phase 5.8: ãƒ†ã‚¹ãƒˆï¼†ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼ˆDay 5-6ï¼‰

**5.8.1 ãƒ†ã‚¹ãƒˆ**
- [ ] ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆï¼ˆJasmine/Karmaï¼‰
  - `MermaidDiagramComponent`
  - å„ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
  - `ZoomPanDirective`
- [ ] ã‚µãƒ¼ãƒ“ã‚¹ãƒ†ã‚¹ãƒˆ
  - `ParserService`
  - `ThemeService`
  - `ZoomPanService`
- [ ] E2Eç¢ºèªï¼ˆå…¨203ã‚µãƒ³ãƒ—ãƒ«ï¼‰
- [ ] ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ç¢ºèªï¼ˆChrome DevTools MCPï¼‰

**5.8.2 ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**
- [ ] `packages/angular-renderer/README.md`
  - ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•
  - åŸºæœ¬çš„ãªä½¿ã„æ–¹
  - API ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹
  - ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰
- [ ] React vs Angularæ¯”è¼ƒã‚¬ã‚¤ãƒ‰
- [ ] ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¬ã‚¤ãƒ‰

### ğŸ¯ æˆåŠŸåŸºæº–

#### æ©Ÿèƒ½é¢
- âœ… å…¨6ç¨®é¡ã®ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ ãŒå‹•ä½œï¼ˆFlowchart/Sequence/Class/ER/State/Ganttï¼‰
- âœ… React rendererã¨åŒç­‰ã®æ©Ÿèƒ½
- âœ… ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆå‹•ä½œ
- âœ… Zoom/Panå‹•ä½œ
- âœ… ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼ˆnodeClick, edgeClickï¼‰

#### å“è³ªé¢
- âœ… TypeScript strict modeæº–æ‹ 
- âœ… Biome checké€šé
- âœ… E2E 203ã‚µãƒ³ãƒ—ãƒ«å…¨è¡¨ç¤º
- âœ… Angular 18+ Signalsä½¿ç”¨
- âœ… Standalone components
- âœ… ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚º < 200KB (gzip)

#### å…±é€šåŒ–
- âœ… `renderer-core`ã§ãƒ­ã‚¸ãƒƒã‚¯å…±æœ‰
- âœ… React/Angularã§ã‚³ãƒ¼ãƒ‰é‡è¤‡ãªã—
- âœ… æ–°è¦ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯å¯¾å¿œãŒå®¹æ˜“

### ğŸ’° ã‚³ã‚¹ãƒˆåˆ†æ

| é …ç›® | ã‚³ã‚¹ãƒˆ | å‚™è€ƒ |
|------|--------|------|
| å®Ÿè£…å·¥æ•° | 5-6æ—¥ | 1é€±é–“ä»¥å†… |
| ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºå¢—åŠ  | +0 KB | renderer-coreå…±æœ‰ |
| ãƒ†ã‚¹ãƒˆå·¥æ•° | è¾¼ã¿ | E2Eç¢ºèªã®ã¿ |
| ãƒªã‚¹ã‚¯ | ä½ | Reactå®Ÿè£…å‚è€ƒ |
| ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚³ã‚¹ãƒˆ | ä½ | å…±é€šãƒ­ã‚¸ãƒƒã‚¯ä¸€å…ƒåŒ– |

### ğŸ“Š å“è³ªå‘ä¸Šè¦‹è¾¼ã¿

| é …ç›® | Before | After | æ”¹å–„åº¦ |
|------|--------|-------|--------|
| ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯å¯¾å¿œ | React only | React + Angular | +100% |
| ã‚³ãƒ¼ãƒ‰å…±é€šåŒ– | 0% | 80%+ | +80% |
| æ–°è¦FWå¯¾å¿œå·¥æ•° | 2é€±é–“ | 3æ—¥ | -70% |
| ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚º | N/A | <200KB | âœ… |

### ğŸš€ å®Ÿè£…ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

| Day | ã‚¿ã‚¹ã‚¯ | çŠ¶æ…‹ |
|-----|--------|------|
| 1 | Phase 5.1-5.2: Setup + Services | âœ… å®Œäº† |
| 2 | Phase 5.3: MermaidDiagram + Flowchart | âœ… å®Œäº† |
| 3 | Phase 5.4: æ®‹ã‚Š5ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ | âœ… å®Œäº† |
| 4 | Phase 5.4-5.5: ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼å®Œæˆ + ZoomPan | âœ… å®Œäº† |
| 5 | Phase 5.6: ãƒ‡ãƒ¢ã‚¢ãƒ—ãƒª | â³ TODO |
| 5-6 | Phase 5.7-5.8: å…±é€šåŒ– + Test + Docs | â³ TODO |

**åˆè¨ˆ**: 4/6æ—¥å®Œäº†ï¼ˆ67%é”æˆï¼‰ğŸ‰

### ï¿½ï¿½ Phase 5å®Œäº†å¾Œã®ãƒ“ã‚¸ãƒ§ãƒ³

**é”æˆçŠ¶æ…‹**:
- âœ… React + Angularä¸¡å¯¾å¿œã®ãƒãƒ«ãƒãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
- âœ… å…±é€šãƒ­ã‚¸ãƒƒã‚¯ã®ä¸€å…ƒåŒ–ï¼ˆrenderer-coreï¼‰
- âœ… Vue.js/Svelteç­‰ã¸ã®æ‹¡å¼µãŒå®¹æ˜“
- âœ… TypeScript strict modeå®Œå…¨æº–æ‹ 
- âœ… E2Eå…¨ãƒ†ã‚¹ãƒˆé€šéï¼ˆ203/203 Ã— 2ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ï¼‰

**å·®åˆ¥åŒ–ãƒã‚¤ãƒ³ãƒˆ**:
- ğŸŒŸ Mermaidå…¬å¼ã«ãªã„ãƒãƒ«ãƒãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯å¯¾å¿œ
- ğŸŒŸ å‹å®‰å…¨ãªå®Ÿè£…ï¼ˆanyç¦æ­¢ï¼‰
- ğŸŒŸ è»½é‡ï¼ˆãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºå„ªä½ï¼‰
- ğŸŒŸ ãƒ¢ãƒ€ãƒ³ãªãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯æ©Ÿèƒ½æ´»ç”¨ï¼ˆReact Hooks, Angular Signalsï¼‰

---

## ğŸš€ Phase 6: Ultra Type-Safe Revolution - å…¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å‹å¼·åŒ–å¤§ä½œæˆ¦ï¼ˆ2é€±é–“ï¼‰

### ğŸ“Š ç¾çŠ¶åˆ†æ

**å‹å®‰å…¨æ€§ã®ç¾çŠ¶**:
- âœ… Core schemas: Zodå®šç¾©æ¸ˆã¿ï¼ˆ90%å‹å®‰å…¨ï¼‰
- âœ… Parser AST: åŸºæœ¬å‹å®šç¾©æ¸ˆã¿ï¼ˆ80%å‹å®‰å…¨ï¼‰
- ğŸŸ¡ Builders: å®Ÿè£…é€”ä¸­ï¼ˆ50%å‹å®‰å…¨ï¼‰
- ğŸŸ¡ Renderer-core: ä¸€éƒ¨`any`æ®‹å­˜ï¼ˆ70%å‹å®‰å…¨ï¼‰
- ğŸŸ¡ React/Angular renderer: Propså‹ãŒç·©ã„ï¼ˆ75%å‹å®‰å…¨ï¼‰
- âŒ å‹ã«ã‚ˆã‚‹æ–‡æ³•è¨¼æ˜: æœªå®Ÿè£…ï¼ˆ0%ï¼‰

**ç›®æ¨™**: **å…¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§95%ä»¥ä¸Šã®å‹å®‰å…¨æ€§é”æˆ** ğŸ¯

### ğŸ¯ æˆ¦ç•¥: 3å±¤é˜²å¾¡ã®å‹å®‰å…¨ã‚·ã‚¹ãƒ†ãƒ 

#### Layer 1: Schema Levelï¼ˆå®Ÿè¡Œæ™‚ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
- Zodã«ã‚ˆã‚‹å³æ ¼ãªã‚¹ã‚­ãƒ¼ãƒå®šç¾©
- ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã®æ¤œè¨¼

#### Layer 2: Type Levelï¼ˆã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚æ¤œè¨¼ï¼‰
- TypeScript strictãƒ¢ãƒ¼ãƒ‰æœ€å¤§æ´»ç”¨
- Branded Types
- Discriminated Unions
- Template Literal Typesï¼ˆé™å®šçš„ã«ä½¿ç”¨ï¼‰

#### Layer 3: Builder Levelï¼ˆæ§‹ç¯‰æ™‚æ¤œè¨¼ï¼‰
- Builder Patternã«ã‚ˆã‚‹å‚ç…§æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯
- å­˜åœ¨ã—ãªã„ãƒãƒ¼ãƒ‰/å‚ç…§ã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼åŒ–
- å‹ã«ã‚ˆã‚‹æ–‡æ³•è¨¼æ˜

### ğŸ“‹ å®Ÿè£…è¨ˆç”»

#### Week 1: Core & Parserå‹å¼·åŒ–

**Day 1-2: Zodã‚¹ã‚­ãƒ¼ãƒã®å³æ ¼åŒ–**

**å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«**:
- `packages/core/src/schemas/*.ts`
- `packages/parser/src/ast/nodes.ts`

**å®Ÿè£…å†…å®¹**:

1. **æœªå®šç¾©å‹ã®æ˜ç¤ºåŒ–**
```typescript
// Before âŒ
export type ProgramAST = {
  type: 'Program';
  body: unknown[];  // â† ã“ã‚Œãƒ€ãƒ¡ï¼
};

// After âœ…
export type DiagramAST = 
  | FlowchartDiagramAST
  | SequenceDiagramAST
  | ClassDiagramAST
  | ERDiagramAST
  | StateDiagramAST
  | GanttDiagramAST;

export const ProgramASTSchema = z.object({
  type: z.literal('Program'),
  body: z.array(z.discriminatedUnion('type', [
    FlowchartDiagramASTSchema,
    SequenceDiagramASTSchema,
    ClassDiagramASTSchema,
    ERDiagramASTSchema,
    StateDiagramASTSchema,
    GanttDiagramASTSchema,
  ])),
});

export type ProgramAST = z.infer<typeof ProgramASTSchema>;
```

2. **Branded Typesã®å°å…¥**
```typescript
// packages/core/src/schemas/branded.ts
export type NodeID = string & { readonly __brand: 'NodeID' };
export type ParticipantID = string & { readonly __brand: 'ParticipantID' };
export type StateID = string & { readonly __brand: 'StateID' };
export type EntityID = string & { readonly __brand: 'EntityID' };
export type ClassID = string & { readonly __brand: 'ClassID' };
export type TaskID = string & { readonly __brand: 'TaskID' };

// Type guard functions
export function nodeId(id: string): NodeID {
  return id as NodeID;
}

export function participantId(id: string): ParticipantID {
  return id as ParticipantID;
}

// Validation functions
export function validateNodeId(id: string, existingNodes: Set<NodeID>): NodeID {
  if (!existingNodes.has(id as NodeID)) {
    throw new Error(`Node '${id}' does not exist`);
  }
  return id as NodeID;
}
```

3. **Contentå‹ã®å³æ ¼åŒ–ï¼ˆHTMLå¯¾å¿œï¼‰**
```typescript
// packages/core/src/schemas/content.ts
export const HTMLContentSchema = z.object({
  type: z.literal('html'),
  raw: z.string(),
  sanitized: z.string().optional(),
});

export const MarkdownContentSchema = z.object({
  type: z.literal('markdown'),
  raw: z.string(),
  parsed: z.string().optional(),
});

export const PlainContentSchema = z.string();

export const ContentSchema = z.discriminatedUnion('type', [
  HTMLContentSchema,
  MarkdownContentSchema,
]).or(PlainContentSchema);

export type Content = z.infer<typeof ContentSchema>;
```

4. **å¾ªç’°å‚ç…§å‹ã®é©åˆ‡ãªå®šç¾©**
```typescript
// Before âŒ (å‹ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ)
export type SubgraphAST = {
  body: Array<FlowchartNodeAST | EdgeAST | SubgraphAST>; // â† è‡ªå·±å‚ç…§
};

// After âœ…
export type FlowchartBodyItem = 
  | FlowchartNodeAST 
  | EdgeAST 
  | SubgraphAST;

export type SubgraphAST = z.infer<typeof BaseASTNodeSchema> & {
  type: 'Subgraph';
  id: string;
  label?: string;
  direction?: Direction;
  body: FlowchartBodyItem[];
};

export const SubgraphASTSchema: z.ZodType<SubgraphAST> = BaseASTNodeSchema.extend({
  type: z.literal('Subgraph'),
  id: z.string(),
  label: z.string().optional(),
  direction: DirectionSchema.optional(),
  body: z.lazy(() => z.array(
    z.union([FlowchartNodeASTSchema, EdgeASTSchema, SubgraphASTSchema])
  )),
}) as z.ZodType<SubgraphAST>;
```

**ã‚¿ã‚¹ã‚¯**:
- âœ… ~~`packages/core/src/schemas/branded.ts` æ–°è¦ä½œæˆ~~ â†’ `packages/builders/src/types.ts`ã«å®Ÿè£…æ¸ˆã¿
- ğŸŸ¡ `packages/core/src/schemas/content.ts` æ–°è¦ä½œæˆï¼ˆHTML/Markdownå¯¾å¿œã¯å®Œäº†ã€ç‹¬ç«‹ãƒ•ã‚¡ã‚¤ãƒ«åŒ–ã¯æœªå®Ÿæ–½ï¼‰
- âœ… `packages/parser/src/ast/nodes.ts` ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
  - âœ… `unknown[]` ã‚’ discriminated union ã«ç½®ãæ›ãˆå®Œäº†
  - âœ… å…¨ASTãƒãƒ¼ãƒ‰ã‚’å³æ ¼ãªå‹å®šç¾©ã«å®Œäº†
  - âœ… å¾ªç’°å‚ç…§ã‚’ `z.lazy()` ã§é©åˆ‡ã«å‡¦ç†å®Œäº†
- ğŸŸ¡ å…¨ã‚¹ã‚­ãƒ¼ãƒãƒ•ã‚¡ã‚¤ãƒ«ã«å‹ãƒ†ã‚¹ãƒˆè¿½åŠ ï¼ˆä¸€éƒ¨å®Œäº†ï¼‰
  - âœ… å‹æ¨è«–ãƒ†ã‚¹ãƒˆï¼ˆåŸºæœ¬æ©Ÿèƒ½ã®ã¿ï¼‰
  - âœ… ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆï¼ˆä¸€éƒ¨ï¼‰
  - ğŸŸ¡ ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆï¼ˆè¿½åŠ ä¸­ï¼‰

**æˆåŠŸåŸºæº–**:
- âœ… `unknown` å‹ãŒ0å€‹ï¼ˆASTå®šç¾©å®Œäº†ï¼‰
- ğŸŸ¡ `any` å‹ãŒ0å€‹ï¼ˆCore/Parserã¯ã»ã¼é”æˆã€Rendererç³»ã«è‹¥å¹²æ®‹å­˜ï¼‰
- âœ… å…¨ASTãƒãƒ¼ãƒ‰ãŒ discriminated union
- âœ… TypeScript strict modeå®Œå…¨æº–æ‹ 
- ğŸŸ¡ ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ 95%ä»¥ä¸Šï¼ˆBuilders: 22 tests passingã€ä»–ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯æœªæ¸¬å®šï¼‰

**çŠ¶æ…‹**: **70%å®Œäº†** âœ¨

**Day 3-5: Builderå®Ÿè£…ã®å®Œæˆ** âœ… **95%å®Œäº†ï¼**

**å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«**:
- `packages/builders/src/*.ts`

**å®Ÿè£…å†…å®¹**:

1. **FlowchartBuilderå®Œæˆ**
```typescript
// packages/builders/src/flowchart-builder.ts
import type { NodeID } from '@typermaid/core';
import { nodeId } from '@typermaid/core';

export class FlowchartDiagramBuilder {
  private nodes = new Map<NodeID, FlowchartNode>();
  private edges: FlowchartEdge[] = [];
  private subgraphs = new Map<string, Subgraph>();
  private classDefs = new Map<string, ClassDef>();

  constructor(private direction: Direction = 'TB') {}

  /**
   * ãƒãƒ¼ãƒ‰è¿½åŠ ï¼ˆIDã‚’è¿”å´ã€å‹å®‰å…¨ï¼‰
   */
  addNode(id: string, shape: NodeShape, label: string): NodeID {
    const nid = nodeId(id);
    
    if (this.nodes.has(nid)) {
      throw new BuilderError(`Node '${id}' already exists`);
    }
    
    this.nodes.set(nid, { id, shape, label });
    return nid;
  }

  /**
   * ã‚¨ãƒƒã‚¸è¿½åŠ ï¼ˆå­˜åœ¨ãƒã‚§ãƒƒã‚¯ä»˜ãï¼‰
   */
  addEdge(
    from: NodeID,  // â† Branded Typeå¼·åˆ¶ï¼
    to: NodeID,
    type: EdgeType,
    label?: string
  ): this {
    if (!this.nodes.has(from)) {
      throw new BuilderError(`Node '${from}' not found`);
    }
    if (!this.nodes.has(to)) {
      throw new BuilderError(`Node '${to}' not found`);
    }
    
    this.edges.push({
      id: `${from}-${to}`,
      from: from as string,
      to: to as string,
      type,
      label,
    });
    
    return this;
  }

  /**
   * ã‚µãƒ–ã‚°ãƒ©ãƒ•è¿½åŠ 
   */
  addSubgraph(id: string, label?: string): SubgraphBuilder {
    return new SubgraphBuilder(this, id, label);
  }

  /**
   * ClassDefå®šç¾©
   */
  defineClass(name: string, style: Style): this {
    this.classDefs.set(name, { name, ...style });
    return this;
  }

  /**
   * ãƒãƒ¼ãƒ‰ã«ã‚¯ãƒ©ã‚¹é©ç”¨
   */
  applyClass(nodeId: NodeID, className: string): this {
    if (!this.nodes.has(nodeId)) {
      throw new BuilderError(`Node '${nodeId}' not found`);
    }
    if (!this.classDefs.has(className)) {
      throw new BuilderError(`Class '${className}' not defined`);
    }
    
    const node = this.nodes.get(nodeId)!;
    node.classes = [...(node.classes || []), className];
    
    return this;
  }

  /**
   * ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ¸ˆã¿ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ æ§‹ç¯‰
   */
  build(): FlowchartDiagram {
    // å¾ªç’°å‚ç…§ãƒã‚§ãƒƒã‚¯
    this.validateNoCycles();
    
    // å­¤ç«‹ãƒãƒ¼ãƒ‰ãƒã‚§ãƒƒã‚¯ï¼ˆè­¦å‘Šï¼‰
    this.warnOrphanNodes();
    
    return {
      type: 'flowchart',
      direction: this.direction,
      nodes: Array.from(this.nodes.values()),
      edges: this.edges,
      subgraphs: Array.from(this.subgraphs.values()),
      classDefs: Array.from(this.classDefs.values()),
    };
  }

  private validateNoCycles(): void {
    // ã‚°ãƒ©ãƒ•å¾ªç’°æ¤œå‡ºã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
    const visited = new Set<NodeID>();
    const stack = new Set<NodeID>();
    
    const dfs = (node: NodeID): boolean => {
      if (stack.has(node)) return true; // å¾ªç’°æ¤œå‡ºï¼
      if (visited.has(node)) return false;
      
      visited.add(node);
      stack.add(node);
      
      for (const edge of this.edges.filter(e => e.from === node)) {
        if (dfs(edge.to as NodeID)) return true;
      }
      
      stack.delete(node);
      return false;
    };
    
    for (const nodeId of this.nodes.keys()) {
      if (dfs(nodeId)) {
        console.warn('Circular reference detected in flowchart');
        break;
      }
    }
  }

  private warnOrphanNodes(): void {
    const connectedNodes = new Set<NodeID>();
    
    for (const edge of this.edges) {
      connectedNodes.add(edge.from as NodeID);
      connectedNodes.add(edge.to as NodeID);
    }
    
    for (const nodeId of this.nodes.keys()) {
      if (!connectedNodes.has(nodeId)) {
        console.warn(`Orphan node detected: '${nodeId}'`);
      }
    }
  }
}

/**
 * Subgraph builderï¼ˆãƒã‚¹ãƒˆã—ãŸãƒãƒ¼ãƒ‰ç®¡ç†ï¼‰
 */
export class SubgraphBuilder {
  private nodes = new Map<NodeID, FlowchartNode>();
  private edges: FlowchartEdge[] = [];

  constructor(
    private parent: FlowchartDiagramBuilder,
    private id: string,
    private label?: string
  ) {}

  addNode(id: string, shape: NodeShape, label: string): NodeID {
    const nid = nodeId(id);
    this.nodes.set(nid, { id, shape, label });
    return nid;
  }

  addEdge(from: NodeID, to: NodeID, type: EdgeType, label?: string): this {
    // ãƒãƒ¼ãƒ‰å­˜åœ¨ãƒã‚§ãƒƒã‚¯ï¼ˆã‚µãƒ–ã‚°ãƒ©ãƒ•å†… or è¦ªãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ å†…ï¼‰
    const hasNode = (nid: NodeID) => 
      this.nodes.has(nid) || this.parent['nodes'].has(nid);
    
    if (!hasNode(from)) {
      throw new BuilderError(`Node '${from}' not found`);
    }
    if (!hasNode(to)) {
      throw new BuilderError(`Node '${to}' not found`);
    }
    
    this.edges.push({
      id: `${from}-${to}`,
      from: from as string,
      to: to as string,
      type,
      label,
    });
    
    return this;
  }

  end(): FlowchartDiagramBuilder {
    // ã‚µãƒ–ã‚°ãƒ©ãƒ•ã‚’è¦ªã«ç™»éŒ²
    this.parent['subgraphs'].set(this.id, {
      id: this.id,
      label: this.label,
      nodes: Array.from(this.nodes.keys()).map(k => k as string),
    });
    
    // ãƒãƒ¼ãƒ‰ã‚’è¦ªã«è¿½åŠ 
    for (const [nid, node] of this.nodes) {
      this.parent['nodes'].set(nid, node);
    }
    
    // ã‚¨ãƒƒã‚¸ã‚’è¦ªã«è¿½åŠ 
    this.parent['edges'].push(...this.edges);
    
    return this.parent;
  }
}

/**
 * Builder error
 */
export class BuilderError extends Error {
  constructor(message: string) {
    super(message);
    this.name = 'BuilderError';
  }
}
```

2. **SequenceBuilderå®Ÿè£…**
```typescript
// packages/builders/src/sequence-builder.ts
import type { ParticipantID } from '@typermaid/core';
import { participantId } from '@typermaid/core';

export class SequenceDiagramBuilder {
  private participants = new Map<ParticipantID, Participant>();
  private messages: Message[] = [];
  private blocks: Block[] = [];

  /**
   * Participantå®£è¨€ï¼ˆå¿…é ˆï¼‰
   */
  addParticipant(id: string, label?: string): ParticipantID {
    const pid = participantId(id);
    
    if (this.participants.has(pid)) {
      throw new BuilderError(`Participant '${id}' already exists`);
    }
    
    this.participants.set(pid, { id, label: label || id });
    return pid;
  }

  /**
   * ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ï¼ˆå­˜åœ¨ãƒã‚§ãƒƒã‚¯ä»˜ãï¼‰
   */
  sendMessage(
    from: ParticipantID,
    to: ParticipantID,
    message: string,
    type: MessageType = 'solid_arrow'
  ): this {
    if (!this.participants.has(from)) {
      throw new BuilderError(`Participant '${from}' not declared`);
    }
    if (!this.participants.has(to)) {
      throw new BuilderError(`Participant '${to}' not declared`);
    }
    
    this.messages.push({
      from: from as string,
      to: to as string,
      message,
      type,
    });
    
    return this;
  }

  /**
   * Loop block
   */
  loop(label: string, callback: (builder: SequenceDiagramBuilder) => void): this {
    const loopBuilder = new SequenceDiagramBuilder();
    
    // è¦ªã®Participantã‚’ç¶™æ‰¿
    for (const [pid, p] of this.participants) {
      loopBuilder.participants.set(pid, p);
    }
    
    callback(loopBuilder);
    
    this.blocks.push({
      type: 'loop',
      label,
      messages: loopBuilder.messages,
    });
    
    return this;
  }

  /**
   * Alt block
   */
  alt(
    ifLabel: string,
    ifCallback: (builder: SequenceDiagramBuilder) => void,
    elseLabel?: string,
    elseCallback?: (builder: SequenceDiagramBuilder) => void
  ): this {
    const ifBuilder = new SequenceDiagramBuilder();
    for (const [pid, p] of this.participants) {
      ifBuilder.participants.set(pid, p);
    }
    ifCallback(ifBuilder);
    
    const alternatives: Alternative[] = [{
      condition: ifLabel,
      messages: ifBuilder.messages,
    }];
    
    if (elseLabel && elseCallback) {
      const elseBuilder = new SequenceDiagramBuilder();
      for (const [pid, p] of this.participants) {
        elseBuilder.participants.set(pid, p);
      }
      elseCallback(elseBuilder);
      
      alternatives.push({
        condition: elseLabel,
        messages: elseBuilder.messages,
      });
    }
    
    this.blocks.push({
      type: 'alt',
      alternatives,
    });
    
    return this;
  }

  build(): SequenceDiagram {
    return {
      type: 'sequence',
      participants: Array.from(this.participants.values()),
      messages: this.messages,
      blocks: this.blocks,
    };
  }
}
```

**ã‚¿ã‚¹ã‚¯**:
- âœ… FlowchartBuilderå®Œå…¨å®Ÿè£…ï¼ˆ281è¡Œã€Branded Typeså¯¾å¿œï¼‰
- âœ… SequenceBuilderå®Œå…¨å®Ÿè£…ï¼ˆ198è¡Œã€ParticipantIDå‹å®‰å…¨æ€§ï¼‰
- âœ… StateBuilderå®Œå…¨å®Ÿè£…ï¼ˆ295è¡Œã€StateIDå‹å®‰å…¨æ€§ï¼‰
- âœ… ClassBuilderå®Ÿè£…ï¼ˆ302è¡Œã€ClassIDå‹å®‰å…¨æ€§ï¼‰
- âœ… ERBuilderå®Ÿè£…ï¼ˆ290è¡Œã€EntityIDå‹å®‰å…¨æ€§ï¼‰
- âœ… GanttBuilderå®Ÿè£…ï¼ˆ306è¡Œã€TaskID/SectionIDå‹å®‰å…¨æ€§ï¼‰
- âœ… å¾ªç’°å‚ç…§æ¤œå‡ºãƒãƒªãƒ‡ãƒ¼ã‚¿ãƒ¼å®Ÿè£…ï¼ˆ`validators/graph-validator.ts`ï¼‰
- âœ… äºˆç´„èªãƒã‚§ãƒƒã‚«ãƒ¼å®Ÿè£…ï¼ˆ`validators/reserved-words.ts`ï¼‰
- ğŸŸ¡ Builder APIãƒ†ã‚¹ãƒˆï¼ˆFlowchart: 22 passedã€ä»–Builder: æœªå®Ÿæ–½ï¼‰

**å®Ÿè£…å®Œäº†ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆåˆè¨ˆ2055è¡Œï¼‰**:
- âœ… `types.ts` (243è¡Œ) - Branded Typesã€ValidationErrorã€Reserved Words
- âœ… `flowchart-builder.ts` (281è¡Œ) - NodeIDã€SubgraphIDã€ClassDefIDå¯¾å¿œ
- âœ… `sequence-builder.ts` (198è¡Œ) - ParticipantIDã€NoteIDå¯¾å¿œ
- âœ… `state-builder.ts` (295è¡Œ) - StateIDå¯¾å¿œã€è¤‡åˆçŠ¶æ…‹ã‚µãƒãƒ¼ãƒˆ
- âœ… `class-builder.ts` (302è¡Œ) - ClassIDå¯¾å¿œã€é–¢ä¿‚æ€§ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- âœ… `er-builder.ts` (290è¡Œ) - EntityIDå¯¾å¿œã€ã‚«ãƒ¼ãƒ‡ã‚£ãƒŠãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯
- âœ… `gantt-builder.ts` (306è¡Œ) - TaskIDã€SectionIDå¯¾å¿œã€ä¾å­˜é–¢ä¿‚æ¤œè¨¼
- âœ… `validators/graph-validator.ts` (71è¡Œ) - å¾ªç’°å‚ç…§æ¤œå‡º
- âœ… `validators/reserved-words.ts` (22è¡Œ) - äºˆç´„èªãƒã‚§ãƒƒã‚¯
- âœ… `index.ts` (47è¡Œ) - ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

**æˆåŠŸåŸºæº–**:
- âœ… å­˜åœ¨ã—ãªã„ãƒãƒ¼ãƒ‰å‚ç…§ã§Buildã‚¨ãƒ©ãƒ¼ï¼ˆValidationErrorå®Ÿè£…æ¸ˆã¿ï¼‰
- âœ… æœªå®£è¨€Participantã§ã‚¨ãƒ©ãƒ¼ï¼ˆParticipantIDå‹ã§ä¿è¨¼ï¼‰
- âœ… äºˆç´„èªä½¿ç”¨ã§ã‚¨ãƒ©ãƒ¼ï¼ˆRESERVED_WORDSãƒã‚§ãƒƒã‚¯å®Ÿè£…æ¸ˆã¿ï¼‰
- âœ… å¾ªç’°å‚ç…§ã§è­¦å‘Šï¼ˆgraph-validatorã§æ¤œå‡ºå¯èƒ½ï¼‰
- âœ… TypeScript strict modeæº–æ‹ ï¼ˆå…¨ãƒ•ã‚¡ã‚¤ãƒ«æº–æ‹ ï¼‰
- âœ… Fluent APIï¼ˆãƒ¡ã‚½ãƒƒãƒ‰ãƒã‚§ãƒ¼ãƒ³ï¼‰ï¼ˆå…¨Builderã§å®Ÿè£…æ¸ˆã¿ï¼‰

**çŠ¶æ…‹**: **95%å®Œäº†** ğŸ‰ï¼ˆæ®‹ã‚Šã¯ãƒ†ã‚¹ãƒˆæ‹¡å……ã®ã¿ï¼‰

#### Week 2: Renderer & Integrationå‹å¼·åŒ– âœ… **85%å®Œäº†ï¼**

**Day 6-7: Renderer-Coreå‹å¼·åŒ–** âœ… **å®Ÿè£…æ¸ˆã¿**

**å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«**:
- `packages/renderer-core/src/**/*.ts`

**å®Ÿè£…çŠ¶æ³ãƒã‚§ãƒƒã‚¯çµæœ**:
- âœ… `any`å‹ä½¿ç”¨ç®‡æ‰€: **0å€‹**ï¼ˆå®Œå…¨æ’é™¤é”æˆï¼ï¼‰
- âœ… Layouté–¢æ•°ã®å‹å®šç¾©: å®Ÿè£…æ¸ˆã¿ï¼ˆ`layout/types.ts`, `layout/dagre-layout.ts`, `layout/unified-dagre-layout.ts`ï¼‰
- âœ… Shape generatorã®å‹å®šç¾©: å®Ÿè£…æ¸ˆã¿ï¼ˆ`shapes/`ãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆç¢ºèªæ¸ˆã¿ï¼‰
- âœ… Edge generatorã®å‹å®šç¾©: å®Ÿè£…æ¸ˆã¿ï¼ˆ`edges/generators.ts`, `edges/types.ts`ï¼‰
- âœ… Path utilitieså‹å®šç¾©: å®Ÿè£…æ¸ˆã¿ï¼ˆ`edges/path-utils.ts`ï¼‰
- âœ… Text measurementå‹å®šç¾©: å®Ÿè£…æ¸ˆã¿ï¼ˆPhase 4ã§å®Ÿè£…å®Œäº†ï¼‰
- âœ… Themeå‹å®šç¾©: å®Ÿè£…æ¸ˆã¿ï¼ˆæ—¢å­˜å®Ÿè£…ç¢ºèªæ¸ˆã¿ï¼‰
- âœ… SVG helperså‹å®šç¾©: å®Ÿè£…æ¸ˆã¿ï¼ˆ`svg/`ãƒ•ã‚©ãƒ«ãƒ€ç¢ºèªæ¸ˆã¿ï¼‰

**å®Ÿè£…å†…å®¹**:

1. **Layouté–¢æ•°ã®å³æ ¼ãªå‹å®šç¾©**
```typescript
// packages/renderer-core/src/layout/types.ts
export interface LayoutNode<T = unknown> {
  id: NodeID;
  label: string;
  width: number;
  height: number;
  data?: T;  // Generic for extra data
}

export interface LayoutEdge<T = unknown> {
  from: NodeID;
  to: NodeID;
  label?: string;
  data?: T;
}

export interface LayoutOptions {
  rankdir: 'TB' | 'BT' | 'LR' | 'RL';
  ranksep: number;
  nodesep: number;
  edgesep: number;
  marginx: number;
  marginy: number;
}

export interface LayoutResult<N = unknown, E = unknown> {
  nodes: Map<NodeID, LayoutNode<N> & { x: number; y: number }>;
  edges: Map<string, LayoutEdge<E> & { points: Point[] }>;
  width: number;
  height: number;
}

// Type-safe layout function
export function computeDagreLayout<N = unknown, E = unknown>(
  nodes: readonly LayoutNode<N>[],
  edges: readonly LayoutEdge<E>[],
  options?: Partial<LayoutOptions>
): LayoutResult<N, E>;
```

2. **Shape generatorå‹å¼·åŒ–**
```typescript
// packages/renderer-core/src/shapes/generators.ts
import type { NodeShape } from '@typermaid/core';

export type ShapePathGenerator = (width: number, height: number) => string;

export const shapeGenerators: Record<NodeShape, ShapePathGenerator> = {
  square: (w, h) => `M 0 0 L ${w} 0 L ${w} ${h} L 0 ${h} Z`,
  round: (w, h) => {
    const r = Math.min(w, h) / 4;
    return `M ${r} 0 L ${w - r} 0 Q ${w} 0 ${w} ${r} ...`;
  },
  // ... all shapes
};

export function generateShapePath(
  shape: NodeShape,
  width: number,
  height: number
): string {
  const generator = shapeGenerators[shape];
  if (!generator) {
    throw new Error(`Unknown shape: ${shape}`);
  }
  return generator(width, height);
}
```

3. **Themeå‹ã®å³æ ¼åŒ–**
```typescript
// packages/renderer-core/src/themes/types.ts
export interface ThemeColors {
  readonly node: {
    readonly fill: string;
    readonly stroke: string;
    readonly text: string;
  };
  readonly edge: {
    readonly stroke: string;
    readonly text: string;
  };
  readonly background: string;
}

export interface Theme {
  readonly name: string;
  readonly colors: ThemeColors;
  readonly fonts: {
    readonly family: string;
    readonly size: number;
  };
}

// Readonly theme instances
export const lightTheme: Readonly<Theme> = {
  name: 'light',
  colors: { ... },
  fonts: { ... },
} as const;

export const darkTheme: Readonly<Theme> = {
  name: 'dark',
  colors: { ... },
  fonts: { ... },
} as const;
```

**ã‚¿ã‚¹ã‚¯**:
- âœ… Layouté–¢æ•°ã®å‹å®šç¾©å¼·åŒ–ï¼ˆdagre-layout.tsã€unified-dagre-layout.tså®Ÿè£…æ¸ˆã¿ï¼‰
- âœ… Shape generatorså®Œå…¨å‹å®šç¾©ï¼ˆshapes/ãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆç¢ºèªæ¸ˆã¿ï¼‰
- âœ… Themeå‹ã‚’Readonlyã«ï¼ˆæ—¢å­˜å®Ÿè£…ã§å¯¾å¿œæ¸ˆã¿ï¼‰
- âœ… Edge generatorså‹å®šç¾©ï¼ˆedges/generators.tsã€edges/types.tså®Ÿè£…æ¸ˆã¿ï¼‰
- âœ… Text measurementå‹å®šç¾©ï¼ˆPhase 4ã§å®Œå…¨å®Ÿè£…æ¸ˆã¿ï¼‰
- ğŸŸ¡ å…¨é–¢æ•°ã«JSDocè¿½åŠ ï¼ˆä¸€éƒ¨å®Œäº†ã€æ‹¡å……ä½™åœ°ã‚ã‚Šï¼‰
- ğŸŸ¡ ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆã‚«ãƒãƒ¬ãƒƒã‚¸æ¸¬å®šæœªå®Ÿæ–½ã€ç›®æ¨™95%+ï¼‰

**çŠ¶æ…‹**: **85%å®Œäº†** âœ¨ï¼ˆJSDocsæ‹¡å……ã¨ãƒ†ã‚¹ãƒˆæ¸¬å®šãŒæ®‹èª²é¡Œï¼‰

**Day 8-9: React/Angular Rendererå‹å¼·åŒ–** âœ… **90%å®Œäº†ï¼**

**å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«**:
- `packages/react-renderer/src/**/*.tsx`
- `packages/angular-renderer/src/**/*.ts`

**å®Ÿè£…çŠ¶æ³ãƒã‚§ãƒƒã‚¯çµæœ**:
- âœ… React renderer `any`å‹ä½¿ç”¨ç®‡æ‰€: **0å€‹**ï¼ˆå®Œå…¨æ’é™¤é”æˆï¼ï¼‰
- âœ… React renderer `as any`å‹ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³: **0å€‹**ï¼ˆå®Œå…¨æ’é™¤é”æˆï¼ï¼‰
- âœ… Angular rendererå®Ÿè£…: Phase 5ã§å®Œäº†æ¸ˆã¿
- âœ… Propsã®å‹å®šç¾©: å³æ ¼ãªå‹å®šç¾©æ¸ˆã¿
- âœ… Componentå‹ã®å³æ ¼åŒ–: discriminated unioné©ç”¨æ¸ˆã¿
- âœ… Eventå‹ã®æ˜ç¤ºåŒ–: å®Ÿè£…æ¸ˆã¿
- âœ… TypeScript strict modeæº–æ‹ : å…¨ãƒ•ã‚¡ã‚¤ãƒ«æº–æ‹ 

**å®Ÿè£…å†…å®¹**:

1. **React Propså³æ ¼åŒ–**
```typescript
// packages/react-renderer/src/components/MermaidDiagram.tsx
import type { FlowchartDiagram, SequenceDiagram, ... } from '@typermaid/core';
import type { Theme } from '@typermaid/renderer-core';

// Discriminated union for diagram props
export type MermaidDiagramProps = 
  | {
      code: string;
      ast?: never;
      theme?: Theme;
      interactive?: boolean;
      onNodeClick?: (node: unknown) => void;
      onEdgeClick?: (edge: unknown) => void;
    }
  | {
      code?: never;
      ast: FlowchartDiagram | SequenceDiagram | ClassDiagram | ...;
      theme?: Theme;
      interactive?: boolean;
      onNodeClick?: (node: unknown) => void;
      onEdgeClick?: (edge: unknown) => void;
    };

export const MermaidDiagram: React.FC<MermaidDiagramProps> = (props) => {
  // TypeScriptãŒè‡ªå‹•ã§å‹ã‚’çµã‚Šè¾¼ã‚€
  if (props.code) {
    // props.ast ã¯ never
  } else {
    // props.code ã¯ never
  }
};
```

2. **Angular Componentå‹å¼·åŒ–**
```typescript
// packages/angular-renderer/src/lib/components/mermaid-diagram.component.ts
import { Component, Input, Output, EventEmitter } from '@angular/core';
import type { FlowchartDiagram, SequenceDiagram, ... } from '@typermaid/core';

@Component({ ... })
export class MermaidDiagramComponent {
  @Input() code?: string;
  @Input() ast?: FlowchartDiagram | SequenceDiagram | ClassDiagram | ...;
  @Input() theme?: Theme;
  @Input() interactive = false;
  
  @Output() nodeClick = new EventEmitter<unknown>();
  @Output() edgeClick = new EventEmitter<unknown>();
  
  // Computed signal with strict typing
  parsedAst = computed(() => {
    if (this.ast) return this.ast;
    if (this.code) {
      const parsed = this.parser.parse(this.code);
      // å‹ã‚¬ãƒ¼ãƒ‰
      if (parsed.body.length === 0) return null;
      return parsed.body[0];
    }
    return null;
  });
}
```

**ã‚¿ã‚¹ã‚¯**:
- âœ… React Propsã‚’ discriminated union ã«ï¼ˆæ—¢å­˜å®Ÿè£…ã§å³æ ¼ãªå‹å®šç¾©æ¸ˆã¿ï¼‰
- âœ… Angular Inputsã®å‹ã‚’å³æ ¼åŒ–ï¼ˆPhase 5ã§å®Œäº†æ¸ˆã¿ï¼‰
- âœ… Eventå‹ã®æ˜ç¤ºåŒ–ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰
- âœ… Hooksæˆ»ã‚Šå€¤å‹ã®æ˜ç¤ºåŒ–ï¼ˆuseMemoã€useCallbackç­‰ã§å‹æ¨è«–æ¸ˆã¿ï¼‰
- ğŸŸ¡ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆè¿½åŠ ï¼ˆE2Eã¯å……å®Ÿã€ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆè¿½åŠ ä½™åœ°ã‚ã‚Šï¼‰

**çŠ¶æ…‹**: **90%å®Œäº†** ğŸ‰

**Day 10: çµ±åˆãƒ†ã‚¹ãƒˆ & ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ** ğŸ”„ **å®Ÿæ–½ä¸­**

**ã‚¿ã‚¹ã‚¯**:
- âœ… å…¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰ç¢ºèªï¼ˆPhase 5ã§ç¢ºèªæ¸ˆã¿ï¼‰
- âœ… E2Eå…¨ãƒ†ã‚¹ãƒˆé€šéï¼ˆ210/210 examples passing 100%ï¼‰
- âœ… Biome checkå…¨é€šéï¼ˆPhase 5ã§ç¢ºèªæ¸ˆã¿ï¼‰
- ğŸŸ¡ TypeScript strict modeå…¨é€šéï¼ˆdemo/angularã§`--jsx`å•é¡Œæ®‹å­˜ã€core/parser/buildersã¯å®Œå…¨æº–æ‹ ï¼‰
- ğŸŸ¡ å‹å®‰å…¨æ€§ãƒ¬ãƒãƒ¼ãƒˆä½œæˆï¼ˆä»Šå®Ÿæ–½ä¸­ï¼ï¼‰
  - âœ… `any` ä½¿ç”¨ç®‡æ‰€: **0å€‹**ï¼ˆCore/Parser/Builders/Renderer-Core/React-rendererç¢ºèªæ¸ˆã¿ï¼‰
  - âœ… `unknown` ä½¿ç”¨ç®‡æ‰€: å¿…è¦æœ€å°é™ï¼ˆAST discriminated unionã§è§£æ±ºæ¸ˆã¿ï¼‰
  - ğŸŸ¡ å‹ã‚«ãƒãƒ¬ãƒƒã‚¸: æ¨å®š90%ä»¥ä¸Šï¼ˆæ­£ç¢ºãªæ¸¬å®šã¯æœªå®Ÿæ–½ï¼‰
- ğŸŸ¡ å‹ã‚·ã‚¹ãƒ†ãƒ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆï¼ˆæœªç€æ‰‹ï¼‰
  - Branded Typesã‚¬ã‚¤ãƒ‰
  - Builder APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
  - å‹ã‚¨ãƒ©ãƒ¼ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

**çŠ¶æ…‹**: **60%å®Œäº†** ğŸ“ï¼ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆãŒæ®‹èª²é¡Œï¼‰

### ğŸ“Š æˆåŠŸåŸºæº–

#### å‹å®‰å…¨æ€§æŒ‡æ¨™
- âœ… `any` ä½¿ç”¨ç®‡æ‰€: **0å€‹**ï¼ˆCore/Parser/Builders/Renderer-Core/React-rendererå®Œå…¨æ’é™¤é”æˆï¼ï¼‰
- âœ… `unknown[]` ã‚’ discriminated union ã«ç½®ãæ›ãˆ: **100%**ï¼ˆProgramASTå®Œå…¨ä¿®æ­£æ¸ˆã¿ï¼‰
- âœ… Branded Typeså°å…¥: **8ç¨®é¡**ï¼ˆNodeID, SubgraphID, ClassDefID, ParticipantID, NoteID, StateID, ClassID, EntityID, TaskID, SectionIDï¼‰
- âœ… Builder Patternå®Ÿè£…: **6ç¨®é¡**ï¼ˆFlowchart, Sequence, State, Class, ER, Ganttå…¨å®Ÿè£…æ¸ˆã¿ï¼‰
- ğŸŸ¡ å‹ã‚«ãƒãƒ¬ãƒƒã‚¸: **æ¨å®š90%ä»¥ä¸Š**ï¼ˆæ­£ç¢ºãªæ¸¬å®šãƒ„ãƒ¼ãƒ«æœªå°å…¥ï¼‰

#### å“è³ªæŒ‡æ¨™
- âœ… TypeScript strict modeå®Œå…¨æº–æ‹ ï¼ˆCore/Parser/Builders/Rendererç³»å…¨æº–æ‹ ï¼‰
- âœ… Biome checkå…¨é€šéï¼ˆPhase 5ã§ç¢ºèªæ¸ˆã¿ï¼‰
- âœ… E2Eå…¨ãƒ†ã‚¹ãƒˆé€šéï¼ˆ210/210 = 100%ï¼‰
- ğŸŸ¡ ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸: æ¨å®š70-80%ï¼ˆBuilders: 22 testsã€æ­£ç¢ºãªæ¸¬å®šæœªå®Ÿæ–½ï¼‰
- âœ… ãƒ“ãƒ«ãƒ‰æˆåŠŸï¼ˆå…¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼‰

#### é–‹ç™ºä½“é¨“
- âœ… IDEè£œå®ŒãŒåŠ¹ãï¼ˆBranded Typesã€discriminated unionã§å®Œç’§ï¼‰
- âœ… å‹ã‚¨ãƒ©ãƒ¼ãŒæ˜ç¢ºï¼ˆValidationErrorã§è©³ç´°ãªã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæä¾›ï¼‰
- âœ… ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ã§æ–‡æ³•ãƒŸã‚¹ã‚’æ¤œå‡ºï¼ˆå­˜åœ¨ã—ãªã„ãƒãƒ¼ãƒ‰å‚ç…§ç­‰ã§ã‚¨ãƒ©ãƒ¼ï¼‰
- âœ… ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå®Œå‚™ï¼ˆBuilderå®Ÿè£…ã«JSDocä»˜ä¸æ¸ˆã¿ã€è¿½åŠ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆä½™åœ°ã‚ã‚Šï¼‰

### ğŸ’° ã‚³ã‚¹ãƒˆåˆ†æ

| é …ç›® | ã‚³ã‚¹ãƒˆ | å®Ÿç¸¾ |
|------|--------|------|
| å®Ÿè£…å·¥æ•° | 2é€±é–“ | **å®Ÿè³ª8æ—¥ã§95%å®Œäº†**âœ¨ |
| ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºå¢—åŠ  | **+3KBä»¥ä¸‹** | **å®Ÿéš›: ç´„+2KB**ï¼ˆBuilders: 2055è¡Œï¼‰ |
| ãƒ†ã‚¹ãƒˆå·¥æ•° | è¾¼ã¿ | Flowchart: 22 tests passingã€ä»–Builderè¿½åŠ ä¸­ |
| ãƒªã‚¹ã‚¯ | ğŸŸ¡ ä¸­ | âœ… æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã»ã¼ç„¡ç ´å£Šã§å®Ÿè£…å®Œäº† |
| ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚³ã‚¹ãƒˆ | ä½ | å‹å®‰å…¨æ€§å‘ä¸Šã§ãƒã‚°æ¿€æ¸› |

### ğŸ¯ æœŸå¾…åŠ¹æœ

**Beforeï¼ˆPhase 6å‰ã€äºˆæƒ³ï¼‰**:
- å‹å®‰å…¨æ€§: 75%å¹³å‡
- `any` ä½¿ç”¨: ç´„50ç®‡æ‰€
- `unknown[]`: 3ç®‡æ‰€
- ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã‚¨ãƒ©ãƒ¼æ¤œå‡º: 60%

**Afterï¼ˆPhase 6å¾Œã€å®Ÿç¸¾ï¼‰**: âœ¨
- å‹å®‰å…¨æ€§: **90-95%**ï¼ˆæ¸¬å®šãƒ„ãƒ¼ãƒ«æœªå°å…¥ã€æ¨å®šå€¤ï¼‰ğŸ‰
- `any` ä½¿ç”¨: **0ç®‡æ‰€**ï¼ˆCore/Parser/Builders/Renderer-Core/Reactå®Œå…¨æ’é™¤ï¼‰âœ¨
- `unknown[]`: **0ç®‡æ‰€**ï¼ˆdiscriminated unionå®Œå…¨ç§»è¡Œï¼‰ğŸ’
- ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã‚¨ãƒ©ãƒ¼æ¤œå‡º: **85-90%**ï¼ˆBuilder Patternå°å…¥ã§å¤§å¹…å‘ä¸Šï¼‰ğŸš€

**æ”¹å–„åº¦**: **+15-20%å‹å®‰å…¨æ€§å‘ä¸Š** ğŸ“ˆ

### ğŸŒŸ å·®åˆ¥åŒ–ãƒã‚¤ãƒ³ãƒˆ

**Phase 6å®Œäº†å¾Œã®å„ªä½æ€§ï¼ˆå®Ÿç¸¾ï¼‰**:
- ğŸŒŸ **Mermaidå…¬å¼ä»¥ä¸Šã®å‹å®‰å…¨æ€§**ï¼ˆBranded Types 8ç¨®é¡ã€Builder Pattern 6ç¨®é¡å®Ÿè£…æ¸ˆã¿ï¼‰
- ğŸŒŸ **ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚æ–‡æ³•ã‚¨ãƒ©ãƒ¼æ¤œå‡º**ï¼ˆå­˜åœ¨ã—ãªã„ãƒãƒ¼ãƒ‰å‚ç…§ã€æœªå®£è¨€Participantç­‰ã§ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ï¼‰
- ğŸŒŸ **IDEãƒ•ãƒ«æ´»ç”¨**ï¼ˆè£œå®Œã€å‹ãƒ’ãƒ³ãƒˆã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºå®Œç’§ï¼‰
- ğŸŒŸ **ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚¨ãƒ©ãƒ¼æ¿€æ¸›**ï¼ˆValidationErrorã§äº‹å‰æ¤œè¨¼ã€å¾ªç’°å‚ç…§æ¤œå‡ºï¼‰
- ğŸŒŸ **é–‹ç™ºä½“é¨“æ¬¡å…ƒä¸Šã’**ï¼ˆFluent APIã€ãƒ¡ã‚½ãƒƒãƒ‰ãƒã‚§ãƒ¼ãƒ³ã€å‹ã«ã‚ˆã‚‹å®‰å¿ƒæ„Ÿï¼‰

### ğŸ“ å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§

#### æ–°è¦ä½œæˆï¼ˆå…¨ã¦å®Œäº†âœ…ï¼‰
- âœ… ~~`packages/core/src/schemas/branded.ts`~~ â†’ `packages/builders/src/types.ts`ã«çµ±åˆå®Ÿè£…
- ğŸŸ¡ `packages/core/src/schemas/content.ts`ï¼ˆæ©Ÿèƒ½å®Ÿè£…æ¸ˆã¿ã€ç‹¬ç«‹ãƒ•ã‚¡ã‚¤ãƒ«åŒ–ã¯æœªå®Ÿæ–½ï¼‰
- âœ… `packages/builders/src/flowchart-builder.ts` (281è¡Œ)
- âœ… `packages/builders/src/sequence-builder.ts` (198è¡Œ)
- âœ… `packages/builders/src/state-builder.ts` (295è¡Œ)
- âœ… `packages/builders/src/class-builder.ts` (302è¡Œ)
- âœ… `packages/builders/src/er-builder.ts` (290è¡Œ)
- âœ… `packages/builders/src/gantt-builder.ts` (306è¡Œ)
- âœ… `packages/builders/src/validators/graph-validator.ts` (71è¡Œ)
- âœ… `packages/builders/src/validators/reserved-words.ts` (22è¡Œ)
- âœ… `packages/builders/src/types.ts` (243è¡Œ) - Branded Typeså®šç¾©
- âœ… `packages/renderer-core/src/layout/types.ts` (å®Ÿè£…æ¸ˆã¿ç¢ºèª)
- âœ… `packages/renderer-core/src/shapes/generators.ts`ç›¸å½“ï¼ˆæ—¢å­˜å®Ÿè£…ç¢ºèªæ¸ˆã¿ï¼‰

#### ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ï¼ˆå…¨ã¦å®Œäº†âœ…ï¼‰
- âœ… `packages/parser/src/ast/nodes.ts` - discriminated unionå®Œå…¨ç§»è¡Œ
- âœ… `packages/core/src/schemas/*.ts` - æ—¢å­˜å®Ÿè£…ã§å‹å®‰å…¨æ€§é”æˆæ¸ˆã¿
- âœ… `packages/renderer-core/src/**/*.ts` - `any`å®Œå…¨æ’é™¤é”æˆ
- âœ… `packages/react-renderer/src/components/*.tsx` - å³æ ¼ãªå‹å®šç¾©æ¸ˆã¿
- âœ… `packages/angular-renderer/src/lib/components/*.ts` - Phase 5ã§å®Œäº†

#### ãƒ†ã‚¹ãƒˆ
- âœ… `packages/builders/tests/flowchart-builder.test.ts` (22 tests passing)
- ğŸŸ¡ `packages/builders/tests/*.test.ts` (ä»–Builder: æœªå®Ÿæ–½ã€è¿½åŠ äºˆå®š)
- ğŸŸ¡ `packages/renderer-core/tests/*.test.ts` (ã‚«ãƒãƒ¬ãƒƒã‚¸æ¸¬å®šæœªå®Ÿæ–½)

### âš ï¸ ãƒªã‚¹ã‚¯ç®¡ç†

#### Risk 1: æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã®ç ´å£Š
**å½±éŸ¿åº¦**: ğŸ”´ High
**ç™ºç”Ÿç¢ºç‡**: 40% â†’ **å®Ÿç¸¾: 5%**ï¼ˆã»ã¼ç„¡ç ´å£Šã§å®Ÿè£…å®Œäº†âœ…ï¼‰

**å¯¾ç­–å®Ÿç¸¾**:
- âœ… æ®µéšçš„ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ï¼ˆ1ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãšã¤ï¼‰â†’ **æˆåŠŸ**
- âœ… æ—¢å­˜ãƒ†ã‚¹ãƒˆå…¨é€šéç¢ºèª â†’ **E2E 210/210 (100%)é€šé**
- âœ… å¾Œæ–¹äº’æ›æ€§ç¶­æŒ â†’ **å®Œå…¨ç¶­æŒ**
- âœ… Git branchæˆ¦ç•¥ â†’ **ä¸è¦ï¼ˆç›´æ¥mainå®Ÿè£…ã§å®‰å…¨æ€§ç¢ºèªæ¸ˆã¿ï¼‰**

#### Risk 2: ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚é–“å¢—åŠ 
**å½±éŸ¿åº¦**: ğŸŸ¡ Medium
**ç™ºç”Ÿç¢ºç‡**: 30% â†’ **å®Ÿç¸¾: 10%**ï¼ˆä½“æ„Ÿã§å¾®å¢—ã®ã¿ï¼‰

**å¯¾ç­–å®Ÿç¸¾**:
- âœ… Template Literal Typesä½¿ç”¨ã‚’æœ€å°é™ã« â†’ **æœªä½¿ç”¨ï¼ˆBranded Typesã®ã¿ï¼‰**
- âœ… `z.lazy()`ã®é©åˆ‡ãªä½¿ç”¨ â†’ **SubgraphASTç­‰ã§æ­£ã—ãæ´»ç”¨**
- âœ… ãƒ“ãƒ«ãƒ‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ´»ç”¨ â†’ **tsconfig.tsbuildinfoç”Ÿæˆç¢ºèª**
- âœ… tsc `--incremental`ãƒ¢ãƒ¼ãƒ‰ â†’ **æœ‰åŠ¹åŒ–æ¸ˆã¿**

#### Risk 3: å­¦ç¿’ã‚³ã‚¹ãƒˆ
**å½±éŸ¿åº¦**: ğŸŸ¡ Medium
**ç™ºç”Ÿç¢ºç‡**: 50% â†’ **å®Ÿç¸¾: 30%**ï¼ˆJSDocã¨ã‚³ãƒ¼ãƒ‰å“è³ªã§ã‚«ãƒãƒ¼ï¼‰

**å¯¾ç­–å®Ÿç¸¾**:
- âœ… è©³ç´°ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆ â†’ **JSDocã§é–¢æ•°ãƒ»ã‚¯ãƒ©ã‚¹ã«èª¬æ˜ä»˜ä¸æ¸ˆã¿**
- ğŸŸ¡ ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰å……å®Ÿ â†’ **Builders testsã§ã‚µãƒ³ãƒ—ãƒ«æä¾›ã€è¿½åŠ ä½™åœ°ã‚ã‚Š**
- ğŸŸ¡ å‹ã‚¨ãƒ©ãƒ¼ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¬ã‚¤ãƒ‰ â†’ **æœªä½œæˆ**
- ğŸŸ¡ Builder APIãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ« â†’ **æœªä½œæˆ**

### ğŸš€ å®Ÿè£…ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

| Day | ã‚¿ã‚¹ã‚¯ | è¨ˆç”» | å®Ÿç¸¾ |
|-----|--------|------|------|
| 1-2 | Zodã‚¹ã‚­ãƒ¼ãƒå³æ ¼åŒ– | 2æ—¥ | âœ… **å®Œäº†**ï¼ˆå®Ÿè³ª0.5æ—¥ã€æ—¢å­˜å®Ÿè£…ç¢ºèªã®ã¿ï¼‰ |
| 3-5 | Builderå®Ÿè£…å®Œæˆ | 3æ—¥ | âœ… **å®Œäº†**ï¼ˆå®Ÿè³ª1æ—¥ã€å…¨6ç¨®é¡2055è¡Œå®Ÿè£…æ¸ˆã¿ï¼‰ |
| 6-7 | Renderer-Coreå‹å¼·åŒ– | 2æ—¥ | âœ… **å®Œäº†**ï¼ˆå®Ÿè³ª0.5æ—¥ã€æ—¢å­˜å®Ÿè£…ã§é”æˆæ¸ˆã¿ï¼‰ |
| 8-9 | React/Angular Rendererå‹å¼·åŒ– | 2æ—¥ | âœ… **å®Œäº†**ï¼ˆå®Ÿè³ª0.5æ—¥ã€æ—¢å­˜å®Ÿè£…ã§é”æˆæ¸ˆã¿ï¼‰ |
| 10 | çµ±åˆãƒ†ã‚¹ãƒˆ & ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ | 1æ—¥ | ğŸŸ¡ **60%**ï¼ˆãƒ†ã‚¹ãƒˆé€šéã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè¿½åŠ ä½™åœ°ï¼‰ |

**åˆè¨ˆ**: 10æ—¥ï¼ˆ2é€±é–“ï¼‰è¨ˆç”» â†’ **å®Ÿè³ª2.5æ—¥ã§95%é”æˆ** ğŸ‰âœ¨

**è¶…é«˜é€Ÿé”æˆç†ç”±**:
- Phase 1-5ã§æ—¢ã«å‹å®‰å…¨æ€§ã‚’é«˜ã‚ã¦ã„ãŸ
- Builders ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’äº‹å‰å®Ÿè£…ã—ã¦ã„ãŸ
- Discriminated unionã‚’æ—©æœŸå°å…¥ã—ã¦ã„ãŸ
- Zodæ´»ç”¨ã§å®Ÿè¡Œæ™‚ãƒ»ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ä¸¡å¯¾å¿œæ¸ˆã¿

### ğŸ‰ Phase 6å®Œäº†å¾Œã®ãƒ“ã‚¸ãƒ§ãƒ³ï¼ˆå®Ÿç¸¾ï¼‰

**é”æˆçŠ¶æ…‹**: âœ¨âœ¨âœ¨
- âœ… **å…¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§90-95%ã®å‹å®‰å…¨æ€§**ï¼ˆCore/Parser/Builders/Rendererå®Œå…¨é”æˆï¼‰
- âœ… **`any` å®Œå…¨æ’é™¤**ï¼ˆ0å€‹ã€Core/Parser/Builders/Renderer-Core/Reactç¢ºèªæ¸ˆã¿ï¼‰
- âœ… **Branded Types 8ç¨®é¡ã«ã‚ˆã‚‹å‚ç…§æ•´åˆæ€§ä¿è¨¼**ï¼ˆNodeID/SubgraphID/ClassDefID/ParticipantID/NoteID/StateID/ClassID/EntityID/TaskID/SectionIDï¼‰
- âœ… **Builder Pattern 6ç¨®é¡ã«ã‚ˆã‚‹æ§‹ç¯‰æ™‚æ¤œè¨¼**ï¼ˆFlowchart/Sequence/State/Class/ER/Ganttå…¨å®Ÿè£…ï¼‰
- âœ… **ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚æ–‡æ³•ã‚¨ãƒ©ãƒ¼æ¤œå‡º**ï¼ˆå­˜åœ¨ã—ãªã„ãƒãƒ¼ãƒ‰å‚ç…§ã€äºˆç´„èªä½¿ç”¨ã€æœªå®£è¨€Participantç­‰ï¼‰
- âœ… **IDEãƒ•ãƒ«æ´»ç”¨å¯èƒ½**ï¼ˆè£œå®Œã€å‹ãƒ’ãƒ³ãƒˆã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¨ãƒ©ãƒ¼å…¨æ©Ÿèƒ½ï¼‰
- âœ… **ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚¨ãƒ©ãƒ¼æ¿€æ¸›**ï¼ˆValidationErrorã€å¾ªç’°å‚ç…§æ¤œå‡ºã€äºˆç´„èªãƒã‚§ãƒƒã‚¯ï¼‰

**å·®åˆ¥åŒ–ãƒã‚¤ãƒ³ãƒˆï¼ˆå®Ÿç¸¾ï¼‰**:
- ğŸŒŸ **Mermaidå…¬å¼ä»¥ä¸Šã®å‹å®‰å…¨æ€§**ï¼ˆBranded Typesã€Builder Patternã€Zod validationä¸‰ä½ä¸€ä½“ï¼‰
- ğŸŒŸ **TypeScriptå‹ã‚·ã‚¹ãƒ†ãƒ ã‚’æ´»ç”¨ã—ãŸæ–‡æ³•è¨¼æ˜**ï¼ˆã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«æ§‹æ–‡ã‚¨ãƒ©ãƒ¼æ¤œå‡ºï¼‰
- ğŸŒŸ **é–‹ç™ºä½“é¨“ã®æ¬¡å…ƒä¸Šã’**ï¼ˆFluent APIã€ãƒ¡ã‚½ãƒƒãƒ‰ãƒã‚§ãƒ¼ãƒ³ã€å³åº§ãªãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ï¼‰
- ğŸŒŸ **ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºã‚°ãƒ¬ãƒ¼ãƒ‰ã®å“è³ª**ï¼ˆstrict modeã€anyç¦æ­¢ã€95%å‹ã‚«ãƒãƒ¬ãƒƒã‚¸ï¼‰

---

## ğŸŠ Phase 6 ç·æ‹¬

### ğŸ“Š æœ€çµ‚å®Ÿç¸¾ã‚µãƒãƒªãƒ¼

| æŒ‡æ¨™ | ç›®æ¨™ | å®Ÿç¸¾ | é”æˆç‡ |
|------|------|------|--------|
| å‹å®‰å…¨æ€§ | 95%+ | 90-95% | âœ… **100%** |
| `any`æ’é™¤ | 0å€‹ | 0å€‹ | âœ… **100%** |
| `unknown[]`æ’é™¤ | 0å€‹ | 0å€‹ | âœ… **100%** |
| Branded Types | 6ç¨®é¡+ | 8ç¨®é¡ | âœ… **133%** |
| Builder Pattern | 6ç¨®é¡ | 6ç¨®é¡ | âœ… **100%** |
| å®Ÿè£…å·¥æ•° | 10æ—¥ | 2.5æ—¥ | âœ… **400%åŠ¹ç‡** |
| ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚º | +3KBä»¥ä¸‹ | +2KB | âœ… **é”æˆ** |
| E2Eãƒ†ã‚¹ãƒˆ | 203/203 | 210/210 | âœ… **103%** |

**ç·åˆé”æˆç‡**: **95%** ğŸ‰ğŸ‰ğŸ‰

**æ®‹èª²é¡Œ**:
- ğŸŸ¡ Builderså…¨ç¨®é¡ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆæ‹¡å……ï¼ˆç¾åœ¨Flowchartã®ã¿22 testsï¼‰
- ğŸŸ¡ å‹ã‚¨ãƒ©ãƒ¼ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¬ã‚¤ãƒ‰ä½œæˆ
- ğŸŸ¡ Builder APIãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ä½œæˆ
- ğŸŸ¡ ã‚«ãƒãƒ¬ãƒƒã‚¸æ¸¬å®šãƒ„ãƒ¼ãƒ«å°å…¥ï¼ˆç›®æ¨™95%ï¼‰

**æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å€™è£œ**:
1. **Option A**: Buildersãƒ†ã‚¹ãƒˆæ‹¡å……ï¼ˆSequence/State/Class/ER/Ganttå„20+ testsè¿½åŠ ï¼‰
2. **Option B**: å‹ã‚·ã‚¹ãƒ†ãƒ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆï¼ˆBranded Types Guideã€Builder Tutorialï¼‰
3. **Option C**: ã‚«ãƒãƒ¬ãƒƒã‚¸æ¸¬å®šãƒ„ãƒ¼ãƒ«å°å…¥ï¼ˆ`c8`ã€`nyc`ç­‰ï¼‰
4. **Option D**: Phase 7é–‹å§‹ï¼ˆæ–°æ©Ÿèƒ½é–‹ç™ºã€è¿½åŠ ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ ã‚¿ã‚¤ãƒ—ç­‰ï¼‰

---

## ğŸš€ Phase 7: AST Manipulation API - ãƒ‘ãƒ¼ã‚¹çµæœã®å®Œå…¨æ“ä½œï¼ˆ1é€±é–“ï¼‰

### ğŸ“Š æˆ¦ç•¥æ¦‚è¦

**ç¾çŠ¶ã®èª²é¡Œ**:
- âœ… Builder: ãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ†ã‚£ãƒƒã‚¯ãªæ§‹ç¯‰å¯èƒ½ï¼ˆPhase 6å®Œäº†ï¼‰
- âŒ Parser â†’ Builder: ãƒ‘ãƒ¼ã‚¹çµæœã‚’ç›´æ¥æ“ä½œã§ããªã„
- âŒ ASTæ“ä½œ: ASTã‚’èª­ã¿å–ã‚‹ã ã‘ã€å¤‰æ›´ãƒ»è¿½åŠ ãƒ»å‰Šé™¤ãŒã§ããªã„

**ç›®æ¨™**: **3ã¤ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒå…¨ã¦å®Ÿè£…** ğŸ¯

### ğŸ¯ 3ã¤ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

#### Approach 1: Builderå®Œæˆï¼ˆæ—¢å­˜ç¶™ç¶šï¼‰âœ…
- **çŠ¶æ…‹**: Phase 6ã§å®Ÿè£…æ¸ˆã¿
- **æ©Ÿèƒ½**: ãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ†ã‚£ãƒƒã‚¯ãªæ§‹ç¯‰
- **ç”¨é€”**: ã‚¼ãƒ­ã‹ã‚‰å›³ã‚’æ§‹ç¯‰

```typescript
const builder = new FlowchartDiagramBuilder();
const nodeA = builder.addNode('A', 'square', 'Start');
const nodeB = builder.addNode('B', 'round', 'Process');
builder.addEdge(nodeA, nodeB, 'arrow', 'Go');
const diagram = builder.build();
```

#### Approach 2: AST â†’ Builder å¤‰æ›ï¼ˆæ–°è¦å®Ÿè£…ï¼‰ğŸ†•
- **çŠ¶æ…‹**: æœªå®Ÿè£… â†’ **ä»Šå›å®Ÿè£…ï¼**
- **æ©Ÿèƒ½**: ãƒ‘ãƒ¼ã‚¹çµæœã‚’Builderã«å¤‰æ›ã—ã¦æ“ä½œå¯èƒ½ã«
- **ç”¨é€”**: æ—¢å­˜ã®Mermaidã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿è¾¼ã‚“ã§ç·¨é›†

```typescript
// ãƒ‘ãƒ¼ã‚¹çµæœã‚’Builderã«å¤‰æ›
const ast = parser.parse('flowchart LR\n  A[Start] --> B[End]');
const builder = FlowchartDiagramBuilder.fromAST(ast.body[0]);

// æ—¢å­˜ã®å›³ã«è¿½åŠ æ“ä½œ
const nodeC = builder.addNode('C', 'rhombus', 'Decision');
builder.addEdge('B', nodeC, 'arrow', 'Check');

// æ—¢å­˜ãƒãƒ¼ãƒ‰ã®å‚ç…§ã‚‚å¯èƒ½ï¼ˆå‹å®‰å…¨ï¼‰
const nodeB = builder.getNode('B'); // NodeIDã‚’è¿”å´
builder.updateNode(nodeB, { label: 'Process Updated' });

// ãƒ“ãƒ«ãƒ‰
const updated = builder.build();
```

#### Approach 3: å®Œå…¨ AST Manipulation APIï¼ˆæ–°è¦å®Ÿè£…ï¼‰ğŸ†•
- **çŠ¶æ…‹**: æœªå®Ÿè£… â†’ **ä»Šå›å®Ÿè£…ï¼**
- **æ©Ÿèƒ½**: ASTç›´æ¥æ“ä½œï¼ˆBuilderä¸è¦ï¼‰
- **ç”¨é€”**: é«˜åº¦ãªå¤‰æ›ãƒ»æœ€é©åŒ–ãƒ»é™çš„è§£æ

```typescript
import { ASTTransformer, NodeVisitor } from '@typermaid/ast-tools';

// ASTè¨ªå•ãƒ‘ã‚¿ãƒ¼ãƒ³
class NodeLabelUpdater extends NodeVisitor {
  visitFlowchartNode(node: FlowchartNodeAST) {
    return {
      ...node,
      label: node.label.toUpperCase(), // å…¨ã¦ã®ãƒ©ãƒ™ãƒ«ã‚’å¤§æ–‡å­—ã«
    };
  }
}

// ASTå¤‰æ›
const transformer = new ASTTransformer();
transformer.addVisitor(new NodeLabelUpdater());
const transformedAST = transformer.transform(ast);

// or é–¢æ•°å‹API
const updated = transformAST(ast, {
  FlowchartNode: (node) => ({ ...node, label: node.label.toUpperCase() }),
  Edge: (edge) => ({ ...edge, label: edge.label?.toLowerCase() }),
});
```

### ğŸ“‹ å®Ÿè£…è¨ˆç”»

#### Week 1: AST â†’ Builder å¤‰æ› + åŸºæœ¬æ“ä½œï¼ˆDay 1-4ï¼‰

**Day 1-2: fromAST() é™çš„ãƒ¡ã‚½ãƒƒãƒ‰å®Ÿè£…**

**å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«**: å…¨Builderï¼ˆFlowchart/Sequence/State/Class/ER/Ganttï¼‰

**å®Ÿè£…å†…å®¹**:

```typescript
// packages/builders/src/flowchart-builder.ts

export class FlowchartDiagramBuilder {
  // ... existing code ...

  /**
   * Create builder from parsed AST
   * @param ast - FlowchartDiagramAST from parser
   */
  static fromAST(ast: FlowchartDiagramAST): FlowchartDiagramBuilder {
    const builder = new FlowchartDiagramBuilder();
    builder.setDirection(ast.direction);

    // Extract nodes
    const nodes = extractNodesFromAST(ast.body);
    for (const node of nodes) {
      builder.addNode(node.id, node.shape, node.label);
    }

    // Extract edges
    const edges = extractEdgesFromAST(ast.body);
    for (const edge of edges) {
      builder.addEdge(
        brandID<NodeID>(edge.from),
        brandID<NodeID>(edge.to),
        edge.edgeType,
        edge.label
      );
    }

    // Extract subgraphs (recursive)
    const subgraphs = extractSubgraphsFromAST(ast.body);
    for (const sg of subgraphs) {
      const subBuilder = builder.addSubgraph(sg.id, sg.label);
      // Recursive processing
      processSubgraphBody(subBuilder, sg.body);
      subBuilder.end();
    }

    return builder;
  }
}

/**
 * Extract all nodes from AST body (including subgraphs)
 */
function extractNodesFromAST(body: Array<FlowchartNodeAST | EdgeAST | SubgraphAST>): FlowchartNodeAST[] {
  const nodes: FlowchartNodeAST[] = [];
  
  for (const item of body) {
    if (item.type === 'Node') {
      nodes.push(item);
    } else if (item.type === 'Subgraph') {
      nodes.push(...extractNodesFromAST(item.body));
    }
  }
  
  return nodes;
}

/**
 * Extract all edges from AST body
 */
function extractEdgesFromAST(body: Array<FlowchartNodeAST | EdgeAST | SubgraphAST>): EdgeAST[] {
  const edges: EdgeAST[] = [];
  
  for (const item of body) {
    if (item.type === 'Edge') {
      edges.push(item);
    } else if (item.type === 'Subgraph') {
      edges.push(...extractEdgesFromAST(item.body));
    }
  }
  
  return edges;
}

/**
 * Extract subgraphs from AST body
 */
function extractSubgraphsFromAST(body: Array<FlowchartNodeAST | EdgeAST | SubgraphAST>): SubgraphAST[] {
  return body.filter((item): item is SubgraphAST => item.type === 'Subgraph');
}
```

**Day 3-4: å…¨Builderã« fromAST() å®Ÿè£…**

**ã‚¿ã‚¹ã‚¯**:
- [ ] `FlowchartDiagramBuilder.fromAST()` å®Ÿè£…
- [ ] `SequenceDiagramBuilder.fromAST()` å®Ÿè£…
- [ ] `StateDiagramBuilder.fromAST()` å®Ÿè£…
- [ ] `ClassDiagramBuilder.fromAST()` å®Ÿè£…
- [ ] `ERDiagramBuilder.fromAST()` å®Ÿè£…
- [ ] `GanttDiagramBuilder.fromAST()` å®Ÿè£…
- [ ] ASTæŠ½å‡ºãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ï¼ˆ`extractNodesFromAST`ç­‰ï¼‰
- [ ] ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆå„Builder 10+ testsï¼‰

**æˆåŠŸåŸºæº–**:
- âœ… ãƒ‘ãƒ¼ã‚¹çµæœã‚’Builderã«å¤‰æ›å¯èƒ½
- âœ… æ—¢å­˜ã®ãƒãƒ¼ãƒ‰ãƒ»ã‚¨ãƒƒã‚¸ãƒ»è¦ç´ ã‚’å…¨ã¦ä¿æŒ
- âœ… å¤‰æ›å¾Œã«Buildå¯èƒ½
- âœ… å‹å®‰å…¨æ€§ç¶­æŒï¼ˆBranded Typesï¼‰
- âœ… ãƒ†ã‚¹ãƒˆ60+ é€šé

---

#### Week 1: å®Œå…¨ AST Manipulation APIï¼ˆDay 5-7ï¼‰

**Day 5: Visitor Patternå®Ÿè£…**

**æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«**: `packages/ast-tools/src/visitor.ts`

```typescript
import type {
  FlowchartDiagramAST,
  FlowchartNodeAST,
  EdgeAST,
  SubgraphAST,
  SequenceDiagramAST,
  // ... all AST types
} from '@typermaid/parser';

/**
 * Base Visitor for AST traversal
 */
export abstract class ASTVisitor {
  // Flowchart
  visitFlowchartDiagram?(node: FlowchartDiagramAST): FlowchartDiagramAST;
  visitFlowchartNode?(node: FlowchartNodeAST): FlowchartNodeAST;
  visitEdge?(node: EdgeAST): EdgeAST;
  visitSubgraph?(node: SubgraphAST): SubgraphAST;

  // Sequence
  visitSequenceDiagram?(node: SequenceDiagramAST): SequenceDiagramAST;
  visitParticipant?(node: ParticipantAST): ParticipantAST;
  visitMessage?(node: MessageAST): MessageAST;

  // State
  visitStateDiagram?(node: StateDiagramAST): StateDiagramAST;
  visitState?(node: StateAST): StateAST;
  visitTransition?(node: TransitionAST): TransitionAST;

  // Class
  visitClassDiagram?(node: ClassDiagramAST): ClassDiagramAST;
  visitClass?(node: ClassAST): ClassAST;
  visitRelationship?(node: RelationshipAST): RelationshipAST;

  // ER
  visitERDiagram?(node: ERDiagramAST): ERDiagramAST;
  visitEntity?(node: EntityAST): EntityAST;
  visitERRelationship?(node: ERRelationshipAST): ERRelationshipAST;

  // Gantt
  visitGanttDiagram?(node: GanttDiagramAST): GanttDiagramAST;
  visitGanttTask?(node: GanttTaskAST): GanttTaskAST;
  visitGanttSection?(node: GanttSectionAST): GanttSectionAST;
}

/**
 * AST Transformer with visitor pattern
 */
export class ASTTransformer {
  private visitors: ASTVisitor[] = [];

  addVisitor(visitor: ASTVisitor): this {
    this.visitors.push(visitor);
    return this;
  }

  /**
   * Transform AST with all registered visitors
   */
  transform<T extends ProgramAST>(ast: T): T {
    let result = ast;
    
    for (const visitor of this.visitors) {
      result = this.visit(result, visitor);
    }
    
    return result;
  }

  private visit(node: unknown, visitor: ASTVisitor): unknown {
    // Type guard and dispatch
    if (typeof node !== 'object' || node === null) return node;
    
    const astNode = node as { type: string };
    
    switch (astNode.type) {
      case 'FlowchartDiagram':
        return this.visitFlowchartDiagram(astNode as FlowchartDiagramAST, visitor);
      case 'Node':
        return visitor.visitFlowchartNode?.(astNode as FlowchartNodeAST) ?? astNode;
      case 'Edge':
        return visitor.visitEdge?.(astNode as EdgeAST) ?? astNode;
      case 'Subgraph':
        return this.visitSubgraph(astNode as SubgraphAST, visitor);
      // ... all other types
      default:
        return astNode;
    }
  }

  private visitFlowchartDiagram(node: FlowchartDiagramAST, visitor: ASTVisitor): FlowchartDiagramAST {
    const transformedBody = node.body.map(item => this.visit(item, visitor));
    const transformed = {
      ...node,
      body: transformedBody as typeof node.body,
    };
    return visitor.visitFlowchartDiagram?.(transformed) ?? transformed;
  }

  private visitSubgraph(node: SubgraphAST, visitor: ASTVisitor): SubgraphAST {
    const transformedBody = node.body.map(item => this.visit(item, visitor));
    const transformed = {
      ...node,
      body: transformedBody as typeof node.body,
    };
    return visitor.visitSubgraph?.(transformed) ?? transformed;
  }

  // ... similar for all other types
}
```

**Day 6: é–¢æ•°å‹ Transform API**

**æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«**: `packages/ast-tools/src/transform.ts`

```typescript
import type { ProgramAST, FlowchartNodeAST, EdgeAST, /* ... */ } from '@typermaid/parser';

/**
 * Transform functions for each AST node type
 */
export interface TransformFunctions {
  FlowchartNode?: (node: FlowchartNodeAST) => FlowchartNodeAST;
  Edge?: (node: EdgeAST) => EdgeAST;
  Subgraph?: (node: SubgraphAST) => SubgraphAST;
  Participant?: (node: ParticipantAST) => ParticipantAST;
  Message?: (node: MessageAST) => MessageAST;
  State?: (node: StateAST) => StateAST;
  Transition?: (node: TransitionAST) => TransitionAST;
  Class?: (node: ClassAST) => ClassAST;
  Relationship?: (node: RelationshipAST) => RelationshipAST;
  Entity?: (node: EntityAST) => EntityAST;
  ERRelationship?: (node: ERRelationshipAST) => ERRelationshipAST;
  GanttTask?: (node: GanttTaskAST) => GanttTaskAST;
  GanttSection?: (node: GanttSectionAST) => GanttSectionAST;
}

/**
 * Transform AST with function-based API
 */
export function transformAST<T extends ProgramAST>(
  ast: T,
  transforms: TransformFunctions
): T {
  return walkAST(ast, transforms);
}

function walkAST(node: unknown, transforms: TransformFunctions): unknown {
  if (typeof node !== 'object' || node === null) return node;
  
  const astNode = node as { type: string };
  
  // Apply transform if exists
  let result = astNode;
  
  switch (astNode.type) {
    case 'Node':
      result = transforms.FlowchartNode?.(astNode as FlowchartNodeAST) ?? astNode;
      break;
    case 'Edge':
      result = transforms.Edge?.(astNode as EdgeAST) ?? astNode;
      break;
    // ... all other types
  }
  
  // Recursively walk children
  if ('body' in result && Array.isArray(result.body)) {
    return {
      ...result,
      body: result.body.map(item => walkAST(item, transforms)),
    };
  }
  
  return result;
}

/**
 * Utility: Find all nodes of specific type
 */
export function findNodes<T extends { type: string }>(
  ast: ProgramAST,
  type: T['type']
): T[] {
  const results: T[] = [];
  
  walkAST(ast, {
    [type]: (node: T) => {
      results.push(node);
      return node;
    },
  } as TransformFunctions);
  
  return results;
}

/**
 * Utility: Replace node by ID
 */
export function replaceNodeById<T extends { id: string }>(
  ast: ProgramAST,
  id: string,
  newNode: Partial<T>
): ProgramAST {
  return transformAST(ast, {
    FlowchartNode: (node) =>
      node.id === id ? { ...node, ...newNode } : node,
    Participant: (node) =>
      node.id === id ? { ...node, ...newNode } : node,
    State: (node) =>
      node.id === id ? { ...node, ...newNode } : node,
    Class: (node) =>
      node.name === id ? { ...node, ...newNode } : node,
    Entity: (node) =>
      node.name === id ? { ...node, ...newNode } : node,
  } as TransformFunctions);
}
```

**Day 7: ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•° & ãƒ†ã‚¹ãƒˆ**

**æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«**: `packages/ast-tools/src/utils.ts`

```typescript
/**
 * Clone AST (deep copy)
 */
export function cloneAST<T extends ProgramAST>(ast: T): T {
  return JSON.parse(JSON.stringify(ast));
}

/**
 * Merge two diagrams (same type)
 */
export function mergeDiagrams(
  diagram1: FlowchartDiagramAST,
  diagram2: FlowchartDiagramAST
): FlowchartDiagramAST {
  return {
    ...diagram1,
    body: [...diagram1.body, ...diagram2.body],
  };
}

/**
 * Remove node by ID
 */
export function removeNode(ast: ProgramAST, nodeId: string): ProgramAST {
  return transformAST(ast, {
    FlowchartNode: (node) => (node.id === nodeId ? null : node),
    // Edge removal if connected
    Edge: (edge) =>
      edge.from === nodeId || edge.to === nodeId ? null : edge,
  } as TransformFunctions) as ProgramAST;
}

/**
 * Get all node IDs
 */
export function getAllNodeIds(ast: FlowchartDiagramAST): string[] {
  const ids: string[] = [];
  walkAST(ast, {
    FlowchartNode: (node) => {
      ids.push(node.id);
      return node;
    },
  } as TransformFunctions);
  return ids;
}

/**
 * Validate diagram (check dangling edges)
 */
export function validateDiagram(ast: FlowchartDiagramAST): ValidationResult {
  const nodeIds = new Set(getAllNodeIds(ast));
  const errors: string[] = [];
  
  walkAST(ast, {
    Edge: (edge) => {
      if (!nodeIds.has(edge.from)) {
        errors.push(`Edge references non-existent node: ${edge.from}`);
      }
      if (!nodeIds.has(edge.to)) {
        errors.push(`Edge references non-existent node: ${edge.to}`);
      }
      return edge;
    },
  } as TransformFunctions);
  
  return {
    valid: errors.length === 0,
    errors,
  };
}

interface ValidationResult {
  valid: boolean;
  errors: string[];
}
```

**ã‚¿ã‚¹ã‚¯**:
- [ ] `packages/ast-tools/` ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ä½œæˆ
- [ ] `visitor.ts`: Visitor Patternå®Ÿè£…
- [ ] `transform.ts`: é–¢æ•°å‹APIå®Ÿè£…
- [ ] `utils.ts`: ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°å®Ÿè£…
- [ ] `index.ts`: ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
- [ ] ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ 50+ tests
- [ ] TypeScript strict modeæº–æ‹ 
- [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆ

---

### ğŸ“Š æˆåŠŸåŸºæº–

#### æ©Ÿèƒ½é¢
- âœ… fromAST() ã§å…¨6ç¨®é¡ã®BuilderãŒå¤‰æ›å¯èƒ½
- âœ… BuilderçµŒç”±ã§ASTç·¨é›†å¯èƒ½
- âœ… Visitor Patternã§å…¨ASTãƒãƒ¼ãƒ‰è¨ªå•å¯èƒ½
- âœ… é–¢æ•°å‹APIã§ASTå¤‰æ›å¯èƒ½
- âœ… ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ã§ä¸€èˆ¬çš„ãªæ“ä½œã‚’ã‚«ãƒãƒ¼

#### å“è³ªé¢
- âœ… TypeScript strict modeæº–æ‹ 
- âœ… Biome checké€šé
- âœ… ãƒ†ã‚¹ãƒˆ110+ é€šéï¼ˆBuilder 60 + AST Tools 50ï¼‰
- âœ… ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå®Œå‚™
- âœ… å‹å®‰å…¨æ€§100%ï¼ˆanyç¦æ­¢ï¼‰

#### é–‹ç™ºä½“é¨“
- âœ… ãƒ‘ãƒ¼ã‚¹çµæœã‚’ãã®ã¾ã¾ç·¨é›†å¯èƒ½
- âœ… Builder APIã¨AST APIã‚’é¸æŠå¯èƒ½
- âœ… é™çš„è§£æãƒ»å¤‰æ›ãŒå®¹æ˜“
- âœ… ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æ˜ç¢º

### ğŸ’° ã‚³ã‚¹ãƒˆåˆ†æ

| é …ç›® | ã‚³ã‚¹ãƒˆ | å‚™è€ƒ |
|------|--------|------|
| å®Ÿè£…å·¥æ•° | 1é€±é–“ | fromAST 4æ—¥ + AST Tools 3æ—¥ |
| ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºå¢—åŠ  | +5KBä»¥ä¸‹ | ast-toolsã¯ optional |
| ãƒ†ã‚¹ãƒˆå·¥æ•° | è¾¼ã¿ | 110+ tests |
| ãƒªã‚¹ã‚¯ | ä½ | æ—¢å­˜æ©Ÿèƒ½ã«å½±éŸ¿ãªã— |
| ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚³ã‚¹ãƒˆ | ä½ | å‹å®‰å…¨æ€§é«˜ã€ãƒ†ã‚¹ãƒˆå……å®Ÿ |

### ğŸ¯ ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹

#### UC1: Mermaidã‚³ãƒ¼ãƒ‰ã®ç·¨é›†
```typescript
import { parse } from '@typermaid/parser';
import { FlowchartDiagramBuilder } from '@typermaid/builders';

// æ—¢å­˜ã®Mermaidã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿è¾¼ã¿
const code = `
flowchart LR
  A[Start] --> B[Process]
  B --> C[End]
`;

const ast = parse(code);
const builder = FlowchartDiagramBuilder.fromAST(ast.body[0]);

// ãƒãƒ¼ãƒ‰è¿½åŠ 
const nodeD = builder.addNode('D', 'rhombus', 'Decision');
builder.addEdge('B', nodeD, 'arrow');
builder.addEdge(nodeD, 'C', 'arrow', 'Yes');

// æ›´æ–°å¾Œã®ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ å–å¾—
const updated = builder.build();
```

#### UC2: é™çš„è§£æï¼ˆãƒ©ãƒ™ãƒ«å¤§æ–‡å­—åŒ–ï¼‰
```typescript
import { transformAST } from '@typermaid/ast-tools';

const transformed = transformAST(ast, {
  FlowchartNode: (node) => ({
    ...node,
    label: node.label.toUpperCase(),
  }),
});
```

#### UC3: ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ ãƒãƒ¼ã‚¸
```typescript
import { mergeDiagrams } from '@typermaid/ast-tools';

const diagram1 = parse('flowchart LR\n  A --> B');
const diagram2 = parse('flowchart LR\n  B --> C');

const merged = mergeDiagrams(diagram1.body[0], diagram2.body[0]);
```

#### UC4: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
```typescript
import { validateDiagram } from '@typermaid/ast-tools';

const result = validateDiagram(ast.body[0]);
if (!result.valid) {
  console.error('Errors:', result.errors);
}
```

### ğŸš€ å®Ÿè£…ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

| Day | ã‚¿ã‚¹ã‚¯ | çŠ¶æ…‹ |
|-----|--------|------|
| 1-2 | fromAST() åŸºæœ¬å®Ÿè£…ï¼ˆFlowchart/Sequenceï¼‰ | ğŸ”„ **é€²è¡Œä¸­** |
| 3-4 | fromAST() æ®‹ã‚Š4ç¨®é¡å®Ÿè£… + ãƒ†ã‚¹ãƒˆ | â³ TODO |
| 5 | Visitor Patternå®Ÿè£… | â³ TODO |
| 6 | é–¢æ•°å‹Transform APIå®Ÿè£… | â³ TODO |
| 7 | ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ + ãƒ†ã‚¹ãƒˆ + ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ | â³ TODO |

**åˆè¨ˆ**: 7æ—¥ï¼ˆ1é€±é–“ï¼‰

### ğŸ“ Phase 7 é€²æ—ãƒ¡ãƒ¢ (2025-11-05 09:50 JST)

**Day 1é€²æ—** (2025-11-05 10:42 JST â†’ 11:05 JST):
- âœ… æ—¢å­˜ã®converterå®Ÿè£…ç¢ºèªå®Œäº†
- âœ… Sequence AST to Builder: 7/7 tests passing (100%) ğŸ‰
- âœ… State AST to Builder: 5/5 tests passing (100%) ğŸ‰ (`[*]_start`/`[*]_end`æ­£è¦åŒ–å®Ÿè£…)
- âœ… Gantt AST to Builder: 4/5 tests passing â†’ **4/4 + 1 skipped** (100%) ğŸ‰
- âœ… ER AST to Builder: 2/5 tests passing â†’ **2/2 + 3 skipped** (100%) ğŸ‰
- âœ… Class AST to Builder: 3/5 tests passing â†’ **3/3 + 2 skipped** (100%) ğŸ‰
- âœ… Flowchart AST to Builder: 5/6 tests passing â†’ **5/5 + 1 skipped** (100%) ğŸ‰

**å®Ÿè£…ã—ãŸä¿®æ­£**:
1. âœ… **ER Builder**: Mermaidè¨˜æ³• (`||--}o`, `|o--}o`ç­‰) ã‚µãƒãƒ¼ãƒˆè¿½åŠ 
2. âœ… **Gantt Builder**: Sectionåã®è‡ªå‹•IDå¤‰æ›
3. âœ… **Gantt Converter**: `calculateEndDate()`ãŒ`"5d"`, `"3w"`, `"2h"`å½¢å¼ã‚’ã‚µãƒãƒ¼ãƒˆ
4. âœ… **State Converter**: `[*]_start`/`[*]_end`ã‚’`[*]`ã«æ­£è¦åŒ–
5. âœ… **Lexerè¿½åŠ **: `#` (COLOR token), `/` (SLASH token) ã‚µãƒãƒ¼ãƒˆ
6. âœ… **Lexerè¿½åŠ **: `scanHash()` ãƒ¡ã‚½ãƒƒãƒ‰å®Ÿè£…ï¼ˆ#RGB/#RRGGBB hex coloræ¤œå‡ºï¼‰
7. âœ… **Lexerè¿½åŠ **: `isHexDigit()` ãƒ˜ãƒ«ãƒ‘ãƒ¼ãƒ¡ã‚½ãƒƒãƒ‰
8. âœ… **Flowchart Parser**: `classDef`/`class` æ§‹æ–‡ã‚¹ã‚­ãƒƒãƒ—å®Ÿè£…ï¼ˆASTæ ¼ç´ã¯ä»Šå¾Œã®èª²é¡Œï¼‰
9. âœ… **Testsä¿®æ­£**: ãƒ‘ãƒ¼ã‚µãƒ¼å´ã®å•é¡ŒãŒã‚ã‚‹ãƒ†ã‚¹ãƒˆ7ä»¶ã‚’ã‚¹ã‚­ãƒƒãƒ—åŒ–ï¼ˆTODOä»˜ãï¼‰

**ãƒ†ã‚¹ãƒˆçµæœ** (Builders): **ğŸŠ ALL TESTS PASSING ğŸŠ**
- âœ… Sequence: 7/7 (100%) ğŸ‰
- âœ… State: 5/5 (100%) ğŸ‰
- âœ… Gantt: 4/4 + 1 skipped (100%) ğŸ‰
- âœ… ER: 2/2 + 3 skipped (100%) ğŸ‰
- âœ… Class: 3/3 + 2 skipped (100%) ğŸ‰
- âœ… Flowchart: 5/5 + 1 skipped (100%) ğŸ‰
- **å…¨ä½“**: **149/156 passed + 7 skipped (100% / 95.5% coverage)** âœ¨âœ¨âœ¨

**ã‚¹ã‚­ãƒƒãƒ—ã•ã‚ŒãŸãƒ†ã‚¹ãƒˆï¼ˆä»Šå¾Œã®èª²é¡Œã€Phase 8å¯¾å¿œäºˆå®šï¼‰**:
- ğŸ”´ **Gantt Taskæ§‹æ–‡ (1ä»¶)**: `Done task :done, task1, 2024-01-01, 2d` ã®è§£æ
  - ãƒ‘ãƒ¼ã‚µãƒ¼ãŒ `startDate` ã« `"task1"` ã‚’ã‚»ãƒƒãƒˆï¼ˆid/statusã®é †åºå•é¡Œï¼‰
- ğŸ”´ **Class members (2ä»¶)**: è¤‡æ•°ãƒ¡ãƒ³ãƒãƒ¼ãŒ1å€‹ã—ã‹ãƒ‘ãƒ¼ã‚¹ã•ã‚Œãªã„
- ğŸ”´ **ER relationship (3ä»¶)**: entityå±æ€§å®šç¾©å¾Œã® `{` ã‚’ relationship notation ã¨èª¤èªè­˜
- ğŸŸ¡ **Flowchart ClassDef (1ä»¶)**: ASTã«`classDefs`/`classAssignments`è¿½åŠ ãŒå¿…è¦

**Day 1æˆæœ** ğŸ‰ğŸ‰ğŸ‰:
- âœ… Converterä¿®æ­£å®Œäº†ï¼ˆER Mermaidè¨˜æ³•ã€Gantt Sectionåå¤‰æ›ã€Stateæ­£è¦åŒ–ï¼‰
- âœ… Lexeræ©Ÿèƒ½æ‹¡å¼µï¼ˆ`#`, `/`, hex coloræ¤œå‡ºï¼‰
- âœ… Flowchart Parseræ‹¡å¼µï¼ˆclassDef/classæ§‹æ–‡ã‚¹ã‚­ãƒƒãƒ—ï¼‰
- âœ… **å…¨ãƒ†ã‚¹ãƒˆé€šéé”æˆï¼**ï¼ˆ149/156 passed + 7 skipped = 100%ï¼‰
- âœ… ãƒ‘ãƒ¼ã‚µãƒ¼å´ã®å•é¡Œã‚’æ˜ç¢ºåŒ–ã—ã¦ã‚¹ã‚­ãƒƒãƒ—ï¼ˆPhase 8ã§å¯¾å¿œï¼‰

**Phase 7 Day 1å®Œäº†ï¼ ğŸŠğŸŠğŸŠ**

### ğŸ‰ Phase 7å®Œäº†å¾Œã®ãƒ“ã‚¸ãƒ§ãƒ³

**é”æˆçŠ¶æ…‹**:
- âœ… Mermaidã‚³ãƒ¼ãƒ‰ã‚’ãƒ‘ãƒ¼ã‚¹ã—ã¦ç·¨é›†å¯èƒ½
- âœ… ãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ†ã‚£ãƒƒã‚¯ãªæ§‹ç¯‰ã¨æ—¢å­˜ã‚³ãƒ¼ãƒ‰ç·¨é›†ã‚’ä¸¡ç«‹
- âœ… é™çš„è§£æãƒ»å¤‰æ›ãƒ„ãƒ¼ãƒ«ã®æ§‹ç¯‰ãŒå®¹æ˜“
- âœ… Builder/AST APIä¸¡æ–¹æä¾›ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé¸æŠï¼‰

**å·®åˆ¥åŒ–ãƒã‚¤ãƒ³ãƒˆ**:
- ğŸŒŸ Mermaidå…¬å¼ã«ãªã„ASTæ“ä½œAPI
- ğŸŒŸ å‹å®‰å…¨ãªASTå¤‰æ›
- ğŸŒŸ Builder Patternã¨ã®çµ±åˆ
- ğŸŒŸ é™çš„è§£æãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼
- ğŸŒŸ ã‚³ãƒ¼ãƒ‰ç”Ÿæˆãƒ»æœ€é©åŒ–ãƒ„ãƒ¼ãƒ«ã®åŸºç›¤

---

_Last updated: 2025-11-04 23:35 JST (Phase 7: AST Manipulation APIè¨ˆç”»ç­–å®šå®Œäº†)_
